import{r as a,a as Bt,R as Ut,V as ne,b as vt,c as be,O as Kt}from"./vendor-CHqN6twT.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();var wt={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wt=a,Ht=Symbol.for("react.element"),qt=Symbol.for("react.fragment"),Jt=Object.prototype.hasOwnProperty,Zt=Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Yt={key:!0,ref:!0,__self:!0,__source:!0};function Ct(t,o,r){var n,s={},l=null,i=null;r!==void 0&&(l=""+r),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(i=o.ref);for(n in o)Jt.call(o,n)&&!Yt.hasOwnProperty(n)&&(s[n]=o[n]);if(t&&t.defaultProps)for(n in o=t.defaultProps,o)s[n]===void 0&&(s[n]=o[n]);return{$$typeof:Ht,type:t,key:l,ref:i,props:s,_owner:Zt.current}}He.Fragment=qt;He.jsx=Ct;He.jsxs=Ct;wt.exports=He;var e=wt.exports,tt={},dt=Bt;tt.createRoot=dt.createRoot,tt.hydrateRoot=dt.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ve(){return Ve=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ve.apply(this,arguments)}var ke;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ke||(ke={}));const ut="popstate";function Xt(t){t===void 0&&(t={});function o(n,s){let{pathname:l,search:i,hash:m}=n.location;return ot("",{pathname:l,search:i,hash:m},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:We(s)}return eo(o,r,null,t)}function ae(t,o){if(t===!1||t===null||typeof t>"u")throw new Error(o)}function kt(t,o){if(!t){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function Qt(){return Math.random().toString(36).substr(2,8)}function mt(t,o){return{usr:t.state,key:t.key,idx:o}}function ot(t,o,r,n){return r===void 0&&(r=null),Ve({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof o=="string"?_e(o):o,{state:r,key:o&&o.key||n||Qt()})}function We(t){let{pathname:o="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(o+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(o+=n.charAt(0)==="#"?n:"#"+n),o}function _e(t){let o={};if(t){let r=t.indexOf("#");r>=0&&(o.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(o.search=t.substr(n),t=t.substr(0,n)),t&&(o.pathname=t)}return o}function eo(t,o,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:l=!1}=n,i=s.history,m=ke.Pop,p=null,w=u();w==null&&(w=0,i.replaceState(Ve({},i.state,{idx:w}),""));function u(){return(i.state||{idx:null}).idx}function S(){m=ke.Pop;let v=u(),z=v==null?null:v-w;w=v,p&&p({action:m,location:C.location,delta:z})}function M(v,z){m=ke.Push;let _=ot(C.location,v,z);w=u()+1;let T=mt(_,w),F=C.createHref(_);try{i.pushState(T,"",F)}catch(W){if(W instanceof DOMException&&W.name==="DataCloneError")throw W;s.location.assign(F)}l&&p&&p({action:m,location:C.location,delta:1})}function G(v,z){m=ke.Replace;let _=ot(C.location,v,z);w=u();let T=mt(_,w),F=C.createHref(_);i.replaceState(T,"",F),l&&p&&p({action:m,location:C.location,delta:0})}function B(v){let z=s.location.origin!=="null"?s.location.origin:s.location.href,_=typeof v=="string"?v:We(v);return _=_.replace(/ $/,"%20"),ae(z,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,z)}let C={get action(){return m},get location(){return t(s,i)},listen(v){if(p)throw new Error("A history only accepts one active listener");return s.addEventListener(ut,S),p=v,()=>{s.removeEventListener(ut,S),p=null}},createHref(v){return o(s,v)},createURL:B,encodeLocation(v){let z=B(v);return{pathname:z.pathname,search:z.search,hash:z.hash}},push:M,replace:G,go(v){return i.go(v)}};return C}var gt;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(gt||(gt={}));function to(t,o,r){return r===void 0&&(r="/"),oo(t,o,r)}function oo(t,o,r,n){let s=typeof o=="string"?_e(o):o,l=lt(s.pathname||"/",r);if(l==null)return null;let i=jt(t);ro(i);let m=null;for(let p=0;m==null&&p<i.length;++p){let w=po(l);m=go(i[p],w)}return m}function jt(t,o,r,n){o===void 0&&(o=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(l,i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:i,route:l};p.relativePath.startsWith("/")&&(ae(p.relativePath.startsWith(n),'Absolute route path "'+p.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),p.relativePath=p.relativePath.slice(n.length));let w=je([n,p.relativePath]),u=r.concat(p);l.children&&l.children.length>0&&(ae(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),jt(l.children,o,u,w)),!(l.path==null&&!l.index)&&o.push({path:w,score:uo(w,l.index),routesMeta:u})};return t.forEach((l,i)=>{var m;if(l.path===""||!((m=l.path)!=null&&m.includes("?")))s(l,i);else for(let p of St(l.path))s(l,i,p)}),o}function St(t){let o=t.split("/");if(o.length===0)return[];let[r,...n]=o,s=r.endsWith("?"),l=r.replace(/\?$/,"");if(n.length===0)return s?[l,""]:[l];let i=St(n.join("/")),m=[];return m.push(...i.map(p=>p===""?l:[l,p].join("/"))),s&&m.push(...i),m.map(p=>t.startsWith("/")&&p===""?"/":p)}function ro(t){t.sort((o,r)=>o.score!==r.score?r.score-o.score:mo(o.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const no=/^:[\w-]+$/,so=3,lo=2,ao=1,io=10,co=-2,ft=t=>t==="*";function uo(t,o){let r=t.split("/"),n=r.length;return r.some(ft)&&(n+=co),o&&(n+=lo),r.filter(s=>!ft(s)).reduce((s,l)=>s+(no.test(l)?so:l===""?ao:io),n)}function mo(t,o){return t.length===o.length&&t.slice(0,-1).every((n,s)=>n===o[s])?t[t.length-1]-o[o.length-1]:0}function go(t,o,r){let{routesMeta:n}=t,s={},l="/",i=[];for(let m=0;m<n.length;++m){let p=n[m],w=m===n.length-1,u=l==="/"?o:o.slice(l.length)||"/",S=fo({path:p.relativePath,caseSensitive:p.caseSensitive,end:w},u),M=p.route;if(!S)return null;Object.assign(s,S.params),i.push({params:s,pathname:je([l,S.pathname]),pathnameBase:vo(je([l,S.pathnameBase])),route:M}),S.pathnameBase!=="/"&&(l=je([l,S.pathnameBase]))}return i}function fo(t,o){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=ho(t.path,t.caseSensitive,t.end),s=o.match(r);if(!s)return null;let l=s[0],i=l.replace(/(.)\/+$/,"$1"),m=s.slice(1);return{params:n.reduce((w,u,S)=>{let{paramName:M,isOptional:G}=u;if(M==="*"){let C=m[S]||"";i=l.slice(0,l.length-C.length).replace(/(.)\/+$/,"$1")}const B=m[S];return G&&!B?w[M]=void 0:w[M]=(B||"").replace(/%2F/g,"/"),w},{}),pathname:l,pathnameBase:i,pattern:t}}function ho(t,o,r){o===void 0&&(o=!1),r===void 0&&(r=!0),kt(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,m,p)=>(n.push({paramName:m,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,o?void 0:"i"),n]}function po(t){try{return t.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return kt(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),t}}function lt(t,o){if(o==="/")return t;if(!t.toLowerCase().startsWith(o.toLowerCase()))return null;let r=o.endsWith("/")?o.length-1:o.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function xo(t,o){o===void 0&&(o="/");let{pathname:r,search:n="",hash:s=""}=typeof t=="string"?_e(t):t;return{pathname:r?r.startsWith("/")?r:yo(r,o):o,search:wo(n),hash:Co(s)}}function yo(t,o){let r=o.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function Qe(t,o,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function bo(t){return t.filter((o,r)=>r===0||o.route.path&&o.route.path.length>0)}function Nt(t,o){let r=bo(t);return o?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function Dt(t,o,r,n){n===void 0&&(n=!1);let s;typeof t=="string"?s=_e(t):(s=Ve({},t),ae(!s.pathname||!s.pathname.includes("?"),Qe("?","pathname","search",s)),ae(!s.pathname||!s.pathname.includes("#"),Qe("#","pathname","hash",s)),ae(!s.search||!s.search.includes("#"),Qe("#","search","hash",s)));let l=t===""||s.pathname==="",i=l?"/":s.pathname,m;if(i==null)m=r;else{let S=o.length-1;if(!n&&i.startsWith("..")){let M=i.split("/");for(;M[0]==="..";)M.shift(),S-=1;s.pathname=M.join("/")}m=S>=0?o[S]:"/"}let p=xo(s,m),w=i&&i!=="/"&&i.endsWith("/"),u=(l||i===".")&&r.endsWith("/");return!p.pathname.endsWith("/")&&(w||u)&&(p.pathname+="/"),p}const je=t=>t.join("/").replace(/\/\/+/g,"/"),vo=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),wo=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Co=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ko(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Et=["post","put","patch","delete"];new Set(Et);const jo=["get",...Et];new Set(jo);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ae(){return Ae=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ae.apply(this,arguments)}const at=a.createContext(null),So=a.createContext(null),De=a.createContext(null),qe=a.createContext(null),Ee=a.createContext({outlet:null,matches:[],isDataRoute:!1}),Mt=a.createContext(null);function No(t,o){let{relative:r}=o===void 0?{}:o;Oe()||ae(!1);let{basename:n,navigator:s}=a.useContext(De),{hash:l,pathname:i,search:m}=Lt(t,{relative:r}),p=i;return n!=="/"&&(p=i==="/"?n:je([n,i])),s.createHref({pathname:p,search:m,hash:l})}function Oe(){return a.useContext(qe)!=null}function Je(){return Oe()||ae(!1),a.useContext(qe).location}function $t(t){a.useContext(De).static||a.useLayoutEffect(t)}function Do(){let{isDataRoute:t}=a.useContext(Ee);return t?Ao():Eo()}function Eo(){Oe()||ae(!1);let t=a.useContext(at),{basename:o,future:r,navigator:n}=a.useContext(De),{matches:s}=a.useContext(Ee),{pathname:l}=Je(),i=JSON.stringify(Nt(s,r.v7_relativeSplatPath)),m=a.useRef(!1);return $t(()=>{m.current=!0}),a.useCallback(function(w,u){if(u===void 0&&(u={}),!m.current)return;if(typeof w=="number"){n.go(w);return}let S=Dt(w,JSON.parse(i),l,u.relative==="path");t==null&&o!=="/"&&(S.pathname=S.pathname==="/"?o:je([o,S.pathname])),(u.replace?n.replace:n.push)(S,u.state,u)},[o,n,i,l,t])}function Lt(t,o){let{relative:r}=o===void 0?{}:o,{future:n}=a.useContext(De),{matches:s}=a.useContext(Ee),{pathname:l}=Je(),i=JSON.stringify(Nt(s,n.v7_relativeSplatPath));return a.useMemo(()=>Dt(t,JSON.parse(i),l,r==="path"),[t,i,l,r])}function Mo(t,o){return $o(t,o)}function $o(t,o,r,n){Oe()||ae(!1);let{navigator:s}=a.useContext(De),{matches:l}=a.useContext(Ee),i=l[l.length-1],m=i?i.params:{};i&&i.pathname;let p=i?i.pathnameBase:"/";i&&i.route;let w=Je(),u;if(o){var S;let v=typeof o=="string"?_e(o):o;p==="/"||(S=v.pathname)!=null&&S.startsWith(p)||ae(!1),u=v}else u=w;let M=u.pathname||"/",G=M;if(p!=="/"){let v=p.replace(/^\//,"").split("/");G="/"+M.replace(/^\//,"").split("/").slice(v.length).join("/")}let B=to(t,{pathname:G}),C=Io(B&&B.map(v=>Object.assign({},v,{params:Object.assign({},m,v.params),pathname:je([p,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?p:je([p,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),l,r,n);return o&&C?a.createElement(qe.Provider,{value:{location:Ae({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ke.Pop}},C):C}function Lo(){let t=Vo(),o=ko(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},o),r?a.createElement("pre",{style:s},r):null,null)}const Ro=a.createElement(Lo,null);class zo extends a.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,r){return r.location!==o.location||r.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:r.error,location:r.location,revalidation:o.revalidation||r.revalidation}}componentDidCatch(o,r){console.error("React Router caught the following error during render",o,r)}render(){return this.state.error!==void 0?a.createElement(Ee.Provider,{value:this.props.routeContext},a.createElement(Mt.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _o(t){let{routeContext:o,match:r,children:n}=t,s=a.useContext(at);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),a.createElement(Ee.Provider,{value:o},n)}function Io(t,o,r,n){var s;if(o===void 0&&(o=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var l;if(!r)return null;if(r.errors)t=r.matches;else if((l=n)!=null&&l.v7_partialHydration&&o.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let i=t,m=(s=r)==null?void 0:s.errors;if(m!=null){let u=i.findIndex(S=>S.route.id&&(m==null?void 0:m[S.route.id])!==void 0);u>=0||ae(!1),i=i.slice(0,Math.min(i.length,u+1))}let p=!1,w=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<i.length;u++){let S=i[u];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(w=u),S.route.id){let{loaderData:M,errors:G}=r,B=S.route.loader&&M[S.route.id]===void 0&&(!G||G[S.route.id]===void 0);if(S.route.lazy||B){p=!0,w>=0?i=i.slice(0,w+1):i=[i[0]];break}}}return i.reduceRight((u,S,M)=>{let G,B=!1,C=null,v=null;r&&(G=m&&S.route.id?m[S.route.id]:void 0,C=S.route.errorElement||Ro,p&&(w<0&&M===0?(Oo("route-fallback"),B=!0,v=null):w===M&&(B=!0,v=S.route.hydrateFallbackElement||null)));let z=o.concat(i.slice(0,M+1)),_=()=>{let T;return G?T=C:B?T=v:S.route.Component?T=a.createElement(S.route.Component,null):S.route.element?T=S.route.element:T=u,a.createElement(_o,{match:S,routeContext:{outlet:u,matches:z,isDataRoute:r!=null},children:T})};return r&&(S.route.ErrorBoundary||S.route.errorElement||M===0)?a.createElement(zo,{location:r.location,revalidation:r.revalidation,component:C,error:G,children:_(),routeContext:{outlet:null,matches:z,isDataRoute:!0}}):_()},null)}var Rt=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Rt||{}),zt=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(zt||{});function To(t){let o=a.useContext(at);return o||ae(!1),o}function Po(t){let o=a.useContext(So);return o||ae(!1),o}function Fo(t){let o=a.useContext(Ee);return o||ae(!1),o}function _t(t){let o=Fo(),r=o.matches[o.matches.length-1];return r.route.id||ae(!1),r.route.id}function Vo(){var t;let o=a.useContext(Mt),r=Po(),n=_t();return o!==void 0?o:(t=r.errors)==null?void 0:t[n]}function Ao(){let{router:t}=To(Rt.UseNavigateStable),o=_t(zt.UseNavigateStable),r=a.useRef(!1);return $t(()=>{r.current=!0}),a.useCallback(function(s,l){l===void 0&&(l={}),r.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,Ae({fromRouteId:o},l)))},[t,o])}const ht={};function Oo(t,o,r){ht[t]||(ht[t]=!0)}function Go(t,o){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function rt(t){ae(!1)}function Bo(t){let{basename:o="/",children:r=null,location:n,navigationType:s=ke.Pop,navigator:l,static:i=!1,future:m}=t;Oe()&&ae(!1);let p=o.replace(/^\/*/,"/"),w=a.useMemo(()=>({basename:p,navigator:l,static:i,future:Ae({v7_relativeSplatPath:!1},m)}),[p,m,l,i]);typeof n=="string"&&(n=_e(n));let{pathname:u="/",search:S="",hash:M="",state:G=null,key:B="default"}=n,C=a.useMemo(()=>{let v=lt(u,p);return v==null?null:{location:{pathname:v,search:S,hash:M,state:G,key:B},navigationType:s}},[p,u,S,M,G,B,s]);return C==null?null:a.createElement(De.Provider,{value:w},a.createElement(qe.Provider,{children:r,value:C}))}function Uo(t){let{children:o,location:r}=t;return Mo(nt(o),r)}new Promise(()=>{});function nt(t,o){o===void 0&&(o=[]);let r=[];return a.Children.forEach(t,(n,s)=>{if(!a.isValidElement(n))return;let l=[...o,s];if(n.type===a.Fragment){r.push.apply(r,nt(n.props.children,l));return}n.type!==rt&&ae(!1),!n.props.index||!n.props.children||ae(!1);let i={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=nt(n.props.children,l)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function st(){return st=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},st.apply(this,arguments)}function Ko(t,o){if(t==null)return{};var r={},n=Object.keys(t),s,l;for(l=0;l<n.length;l++)s=n[l],!(o.indexOf(s)>=0)&&(r[s]=t[s]);return r}function Wo(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Ho(t,o){return t.button===0&&(!o||o==="_self")&&!Wo(t)}const qo=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Jo="6";try{window.__reactRouterVersion=Jo}catch{}const Zo="startTransition",pt=Ut[Zo];function Yo(t){let{basename:o,children:r,future:n,window:s}=t,l=a.useRef();l.current==null&&(l.current=Xt({window:s,v5Compat:!0}));let i=l.current,[m,p]=a.useState({action:i.action,location:i.location}),{v7_startTransition:w}=n||{},u=a.useCallback(S=>{w&&pt?pt(()=>p(S)):p(S)},[p,w]);return a.useLayoutEffect(()=>i.listen(u),[i,u]),a.useEffect(()=>Go(n),[n]),a.createElement(Bo,{basename:o,children:r,location:m.location,navigationType:m.action,navigator:i,future:n})}const Xo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Qo=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,It=a.forwardRef(function(o,r){let{onClick:n,relative:s,reloadDocument:l,replace:i,state:m,target:p,to:w,preventScrollReset:u,viewTransition:S}=o,M=Ko(o,qo),{basename:G}=a.useContext(De),B,C=!1;if(typeof w=="string"&&Qo.test(w)&&(B=w,Xo))try{let T=new URL(window.location.href),F=w.startsWith("//")?new URL(T.protocol+w):new URL(w),W=lt(F.pathname,G);F.origin===T.origin&&W!=null?w=W+F.search+F.hash:C=!0}catch{}let v=No(w,{relative:s}),z=er(w,{replace:i,state:m,target:p,preventScrollReset:u,relative:s,viewTransition:S});function _(T){n&&n(T),T.defaultPrevented||z(T)}return a.createElement("a",st({},M,{href:B||v,onClick:C||l?n:_,ref:r,target:p}))});var xt;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(xt||(xt={}));var yt;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(yt||(yt={}));function er(t,o){let{target:r,replace:n,state:s,preventScrollReset:l,relative:i,viewTransition:m}=o===void 0?{}:o,p=Do(),w=Je(),u=Lt(t,{relative:i});return a.useCallback(S=>{if(Ho(S,r)){S.preventDefault();let M=n!==void 0?n:We(w)===We(u);p(t,{replace:M,state:s,preventScrollReset:l,relative:i,viewTransition:m})}},[w,p,u,n,s,r,t,l,i,m])}let ze=null,Te=null;const Tt=async()=>ze||Te||(Te=(async()=>{try{if(window.RDKit&&window.RDKit.get_mol)return ze=window.RDKit,ze;if(!window.initRDKitModule){const t=["https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js","https://cdn.jsdelivr.net/npm/@rdkit/rdkit/dist/RDKit_minimal.js","https://unpkg.com/@rdkit/rdkit@2024.3.1/dist/RDKit_minimal.js"];let o=!1;for(const r of t)try{console.log(`Attempting to load RDKit from: ${r}`);const n=document.createElement("script");n.src=r,n.crossOrigin="anonymous",document.head.appendChild(n),await new Promise((s,l)=>{n.onload=()=>{console.log(`Successfully loaded RDKit from: ${r}`),s()},n.onerror=i=>{console.warn(`Failed to load RDKit from ${r}:`,i),l(i)},setTimeout(()=>l(new Error("RDKit loading timeout")),5e3)}),o=!0;break}catch{console.warn(`Failed to load from ${r}, trying next...`);continue}if(!o)throw new Error("All RDKit CDN sources failed to load")}if(window.initRDKitModule)return console.log("Initializing RDKit module..."),ze=await window.initRDKitModule(),console.log("RDKit initialized successfully"),ze;throw new Error("RDKit module not available after script load")}catch(t){return console.warn("RDKit initialization failed:",t),Te=null,null}})(),Te),tr=async t=>{if(typeof t!="string")return{isValid:!1,error:"Invalid input: SMILES must be a non-empty string"};const o=t.trim();if(!o)return{isValid:!1,error:"Invalid input: SMILES cannot be empty"};const r=rr(o);try{console.log("Attempting RDKit validation for:",o);const n=await Tt();if(n){console.log("RDKit available, performing advanced validation");const s=n.get_mol(o);if(s){const l=s.is_valid();return s.delete(),console.log("RDKit validation result:",l),{isValid:l,error:l?null:"Invalid SMILES structure (RDKit validation failed)",method:"RDKit"}}else return console.warn("RDKit could not parse molecule, falling back to basic validation"),{isValid:r.isValid,error:r.isValid?null:"Invalid SMILES structure (RDKit could not parse)",method:"basic"}}else return console.warn("RDKit not available, using basic validation"),{isValid:r.isValid,error:r.isValid?null:r.error,method:"basic"}}catch(n){return console.warn("RDKit validation failed, falling back to basic validation:",n),{isValid:r.isValid,error:r.isValid?null:`Validation error: ${n.message}`,method:"basic"}}},or=async t=>{var o,r,n,s,l;try{const i=await Tt();if(!i)return null;console.log("generateMolecule3D: Starting 3D generation for SMILES:",t.substring(0,50)+"...");const m=i.get_mol(t);if(!m)return console.warn("generateMolecule3D: Failed to create molecule from SMILES"),null;console.log("generateMolecule3D: Molecule created successfully");let p;try{const u=i.get_mol(t,JSON.stringify({removeHs:!1,sanitize:!0}));if(u){console.log("generateMolecule3D: Added hydrogens to molecule");try{if(typeof u.addHs=="function"&&(u.addHs(),console.log("generateMolecule3D: Added hydrogens using addHs()")),typeof u.generate_aligned_coords=="function")u.generate_aligned_coords(m,!0,!0,!1),console.log("generateMolecule3D: Generated 3D coordinates using generate_aligned_coords");else if(typeof u.get_new_coords=="function")u.get_new_coords(!0)&&console.log("generateMolecule3D: Generated 3D coordinates using get_new_coords");else if(typeof i.get_mol_copy=="function"){const S=i.get_mol_copy(u);S&&(console.log("generateMolecule3D: Created 3D molecule copy"),(o=u.delete)==null||o.call(u),p=S)}p||(p=u,console.log("generateMolecule3D: Using molecule with hydrogens (attempting 3D coordinates)"))}catch(S){console.warn("generateMolecule3D: 3D coordinate generation failed, using molecule with hydrogens:",S),p=u}}else console.warn("generateMolecule3D: Failed to add hydrogens, using original molecule"),p=m}catch(u){console.warn("generateMolecule3D: 3D molecule processing failed, using original molecule:",u),p=m}if(!p)return(r=m.delete)==null||r.call(m),null;let w;try{if(w=p.get_molblock(),w){p!==m&&(w=w.replace("     RDKit          2D","     RDKit          3D"),console.log("generateMolecule3D: Updated molblock header to indicate 3D coordinates"));const u={molblock:w,smiles:t,mol:p,has3D:p!==m,atomCount:((n=w.split(`
`)[3])==null?void 0:n.trim().split(/\s+/)[0])||"unknown"};return console.log("generateMolecule3D: Successfully generated molecule data"),u}}catch(u){console.error("generateMolecule3D: Failed to generate molblock:",u)}return(s=m.delete)==null||s.call(m),(l=p.delete)==null||l.call(p),null}catch(i){return console.warn("3D molecule generation error:",i),null}},rr=t=>{if(!t||typeof t!="string")return{isValid:!1,error:"SMILES must be a non-empty string"};const o=t.trim();if(o.length===0)return{isValid:!1,error:"SMILES cannot be empty"};if(!/^[A-Za-z0-9()\[\]@+\-=#$:/\\%*.]+$/.test(o))return{isValid:!1,error:"SMILES contains invalid characters"};if(o.length<1)return{isValid:!1,error:"SMILES too short"};const n=(o.match(/\(/g)||[]).length,s=(o.match(/\)/g)||[]).length,l=(o.match(/\[/g)||[]).length,i=(o.match(/\]/g)||[]).length;return n!==s?{isValid:!1,error:"Unmatched parentheses in SMILES"}:l!==i?{isValid:!1,error:"Unmatched brackets in SMILES"}:{isValid:!0,error:null}},nr=[{name:"Ethanol",smiles:"CCO"},{name:"Benzene",smiles:"c1ccccc1"},{name:"Caffeine",smiles:"CN1C=NC2=C1C(=O)N(C(=O)N2C)C"},{name:"Aspirin",smiles:"CC(=O)OC1=CC=CC=C1C(=O)O"},{name:"Cholesterol",smiles:"CC(C)CCCC(C)C1CCC2C1(CCC3C2CC=C4C3(CCC(C4)O)C)C"}],Pt=({onSubmit:t,onValidation:o,isValid:r=null})=>{const[n,s]=a.useState(""),[l,i]=a.useState(!1),[m,p]=a.useState(null),[w,u]=a.useState(!1),[S,M]=a.useState("");a.useEffect(()=>{const z=setTimeout(async()=>{if(n.trim()){i(!0),M("");try{const _=await tr(n.trim());u(_.isValid),p(_.isValid),_.isValid?(M(`Valid SMILES (${_.method||"basic"} validation)`),ne.success(`Molecule loaded: ${n.trim()}`)):(M(_.error||"Invalid SMILES string"),ne.error("Invalid SMILES string")),o&&o(n.trim(),_.isValid)}catch(_){console.error("Validation error:",_),u(!1),p(!1),M("Validation failed"),ne.error("Validation failed"),o&&o(n.trim(),!1)}finally{i(!1)}}else u(!1),p(null),M(""),o&&o("",!1)},500);return()=>clearTimeout(z)},[n,o]);const G=v=>{v.preventDefault(),n.trim()&&w&&t(n.trim())},B=v=>{s(v)},C=r!==null?r:w;return e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Enter SMILES String"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:n,onChange:v=>s(v.target.value),placeholder:"Enter SMILES string (e.g., CCO for ethanol)",className:`w-full px-4 py-3 text-lg border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${n&&C===!1?"border-red-400 bg-red-50":n&&C===!0?"border-green-400 bg-green-50":"border-gray-300"}`,autoComplete:"off",spellCheck:"false"}),l&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})}),n&&!l&&C!==null&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:C?e.jsx("svg",{className:"h-5 w-5 text-green-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-5 w-5 text-red-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),S&&e.jsx("p",{className:`text-sm ${w?"text-green-600":"text-red-600"}`,children:S}),e.jsx("button",{type:"submit",disabled:!n.trim()||!w||l,className:"control-button w-full py-3 text-lg font-semibold",children:l?"Validating...":"Visualize Molecule"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Try examples:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:nr.map(v=>e.jsx("button",{onClick:()=>B(v.smiles),className:"px-3 py-2 bg-gray-100 hover:bg-blue-100 text-gray-700 rounded-md transition-colors text-sm font-medium",children:v.name},v.name))})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-600",children:e.jsxs("p",{children:[e.jsx("strong",{children:"SMILES"})," (Simplified Molecular Input Line Entry System) is a notation for describing chemical structures. Examples: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"CCO"})," (ethanol),",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"c1ccccc1"})," (benzene)."]})})]})},sr=[{id:"SmilesDrawer",name:"SmilesDrawer",description:"Fast client-side 2D rendering"},{id:"RDKit.js",name:"RDKit.js",description:"High-quality chemical structures"},{id:"Kekule.js",name:"Kekule.js",description:"Comprehensive cheminformatics"}],lr=[{id:"3Dmol.js",name:"3Dmol.js",description:"WebGL molecular visualization"},{id:"Mol*",name:"Mol*",description:"High-performance 3D viewer"},{id:"NGL",name:"NGL",description:"Interactive protein structures"}],Ft=({mode:t,renderer:o,onModeChange:r,onRendererChange:n})=>{const s=t==="2D"?sr:lr;return e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Visualization Mode"}),e.jsxs("div",{className:"flex space-x-2 mb-6",children:[e.jsx("button",{onClick:()=>r("2D"),className:`px-6 py-3 rounded-lg font-semibold transition-colors ${t==="2D"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"2D View"}),e.jsx("button",{onClick:()=>r("3D"),className:`px-6 py-3 rounded-lg font-semibold transition-colors ${t==="3D"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"3D View"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:t==="2D"?"2D Renderer":"3D Renderer"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.map(l=>e.jsxs("button",{onClick:()=>n(l.id),className:`p-4 rounded-lg border-2 text-left transition-colors ${o===l.id?"border-blue-500 bg-blue-100":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-1",children:l.name}),e.jsx("div",{className:"text-sm text-gray-600",children:l.description})]},l.id))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:t==="2D"?"2D Visualization Features":"3D Visualization Features"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:t==="2D"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Fast rendering and interaction"}),e.jsx("li",{children:"• Export to PNG and SVG formats"}),e.jsx("li",{children:"• Chemical structure validation"}),e.jsx("li",{children:"• Customizable styling options"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Interactive 3D molecule rotation"}),e.jsx("li",{children:"• Multiple rendering styles (stick, ball & stick, surface)"}),e.jsx("li",{children:"• Export to GLB format for 3D printing"}),e.jsx("li",{children:"• Real-time conformer generation"})]})})]})]})},it=(t,o,r=!1)=>{let s=(typeof t=="string"?t:"").replace(/[^A-Za-z0-9._-]/g,"_");if(r){const l=Date.now();s=`${s}_${l}`}return`${s}.${o}`},ct=(t,o)=>{let r="";try{typeof URL.createObjectURL=="function"&&(r=URL.createObjectURL(t))}catch{r=""}const n=document.createElement("a");n.href=r||"#",n.download=o||"",n.style.display="none",document.body.appendChild(n);try{n.click()}finally{document.body.removeChild(n)}r&&typeof URL.revokeObjectURL=="function"&&setTimeout(()=>URL.revokeObjectURL(r),100)},bt=async(t,o,r)=>{if(!t||typeof t.toBlob!="function")return!1;try{return new Promise(n=>{t.toBlob(s=>{if(s){const l=it(o,"png",!0);ct(s,l),n(!0)}else n(!1)},"image/png",r)})}catch(n){return console.error("PNG export error:",n),!1}},ar=async(t,o)=>{if(!t)return!1;try{let r;typeof t=="string"?r=t:r=new XMLSerializer().serializeToString(t);const n=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
${r}`,s=new Blob([n],{type:"image/svg+xml"}),l=it(o,"svg",!1);return ct(s,l),!0}catch(r){return console.error("SVG export error:",r),!1}},ir=async(t,o)=>{try{const r=new Blob([t],{type:"model/gltf+json"}),n=it(o,"gltf",!0);return ct(r,n),!0}catch(r){return console.error("GLTF export error:",r),!1}},et=async()=>{try{if(window.RDKit&&window.RDKit.get_mol)return window.RDKit;if(!window.initRDKitModule){const t=["https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js","https://cdn.jsdelivr.net/npm/@rdkit/rdkit/dist/RDKit_minimal.js","https://unpkg.com/@rdkit/rdkit@2024.3.1/dist/RDKit_minimal.js"];let o=!1;for(const r of t)try{console.log(`MoleculeViewer: Attempting to load RDKit from: ${r}`);const n=document.createElement("script");n.src=r,n.crossOrigin="anonymous",document.head.appendChild(n),await new Promise((s,l)=>{n.onload=()=>{console.log(`MoleculeViewer: Successfully loaded RDKit from: ${r}`),s()},n.onerror=i=>{console.warn(`MoleculeViewer: Failed to load RDKit from ${r}:`,i),document.head.removeChild(n),l(i)},setTimeout(()=>{n.parentNode&&document.head.removeChild(n),l(new Error("RDKit loading timeout"))},5e3)}),o=!0;break}catch{console.warn(`MoleculeViewer: Failed to load from ${r}, trying next...`);continue}if(!o)return console.warn("MoleculeViewer: All RDKit CDN sources failed, will use fallback renderer"),null}if(window.initRDKitModule){console.log("MoleculeViewer: Initializing RDKit module...");const t=await window.initRDKitModule();return console.log("MoleculeViewer: RDKit initialized successfully"),t}return console.warn("MoleculeViewer: RDKit module not available after script load"),null}catch(t){return console.warn("MoleculeViewer: RDKit initialization failed:",t),null}},cr=()=>({SmilesDrawer:!0,RDKit:!0,RDKitjs:!0,Kekule:!0,Kekulejs:!0,"3Dmol":!0,"3Dmoljs":!0,NGL:!0,Molstar:!0,SimpleSVG:!0}),Vt=vt.forwardRef(({smiles:t,mode:o,renderer:r,onExport:n},s)=>{const l=a.useRef(null),i=a.useRef(null),m=a.useRef(!0),[p,w]=a.useState(!0),[u,S]=a.useState(null),[M,G]=a.useState(null),[B,C]=a.useState(""),[v]=a.useState(cr());console.log("=== MoleculeViewer: Component rendered ==="),console.log("Props received:",{smiles:(t==null?void 0:t.substring(0,50))+"...",mode:o,renderer:r}),console.log("Current state:",{isLoading:p,hasError:!!u,hasSvgContent:!!B});const z=a.useCallback(()=>{if(console.log("=== MoleculeViewer: cleanupViewer called ==="),i.current){try{const k=i.current;switch(k.type){case"3dmol":if(k.viewer&&typeof k.viewer.clear=="function")try{k.viewer.clear(),console.log("3Dmol viewer cleared successfully")}catch(y){console.warn("Error clearing 3Dmol viewer:",y)}if(k.element&&k.element.parentNode)try{k.element.innerHTML="",console.log("3Dmol container cleared")}catch(y){console.warn("Error clearing 3Dmol container:",y)}break;case"ngl":if(k.stage&&typeof k.stage.dispose=="function")try{k.stage.dispose(),console.log("NGL stage disposed successfully")}catch(y){console.warn("Error disposing NGL stage:",y)}if(k.element&&k.element.parentNode)try{k.element.innerHTML="",console.log("NGL container cleared")}catch(y){console.warn("Error clearing NGL container:",y)}break;case"molstar":if(k.plugin&&typeof k.plugin.dispose=="function")try{k.plugin.dispose(),console.log("Molstar plugin disposed successfully")}catch(y){console.warn("Error disposing Molstar plugin:",y)}if(k.element&&k.element.parentNode)try{k.element.innerHTML="",console.log("Molstar container cleared")}catch(y){console.warn("Error clearing Molstar container:",y)}break;default:typeof k.destroy=="function"?k.destroy():typeof k.dispose=="function"&&k.dispose()}}catch(k){console.warn("Error cleaning up viewer:",k)}i.current=null}m.current&&C("")},[]);a.useEffect(()=>(m.current=!0,()=>{console.log("=== MoleculeViewer: Component unmounting ==="),m.current=!1,z()}),[]);const _=a.useCallback(async k=>{console.log("=== MoleculeViewer: renderWithSimpleSVG called ==="),console.log("SMILES for SVG rendering:",k);try{console.log("Using Simple SVG fallback renderer for:",k);const y=Math.max(3,Math.min(k.length,12)),b=120;console.log("Creating molecule structure with",y,"atoms");const R=(N,V)=>V==="C"||V==="c"?"#2d3748":V==="O"||V==="o"?"#e53e3e":V==="N"||V==="n"?"#3182ce":V==="S"||V==="s"?"#d69e2e":N%2===0?"#4299e1":"#48bb78";let g="";for(let N=0;N<y;N++){const V=N/y*2*Math.PI,oe=Math.cos(V)*b,H=Math.sin(V)*b,ce=k[N%k.length]||"C";if(N<y-1){const ge=(N+1)/y*2*Math.PI,pe=Math.cos(ge)*b,Ce=Math.sin(ge)*b;g+=`<line x1="${oe}" y1="${H}" x2="${pe}" y2="${Ce}" stroke="#4a5568" stroke-width="3" stroke-linecap="round" />`}g+=`<circle cx="${oe}" cy="${H}" r="18" fill="${R(N,ce)}" stroke="#ffffff" stroke-width="2" />`,g+=`<text x="${oe}" y="${H+5}" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff">${ce.toUpperCase()}</text>`}if(y>2&&/[0-9]/.test(k)){const V=(y-1)/y*2*Math.PI;g+=`<line x1="${Math.cos(0)*b}" y1="${Math.sin(0)*b}" x2="${Math.cos(V)*b}" y2="${Math.sin(V)*b}" stroke="#4a5568" stroke-width="3" stroke-linecap="round" />`,console.log("Ring closure added")}console.log("Molecule structure added to SVG");const D=`
        <svg width="800" height="600" viewBox="0 0 800 600" style="background-color: #f8fafc; border: 2px solid #e2e8f0; border-radius: 8px;">
          <defs>
            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
              <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f1f5f9" stroke-width="1"/>
            </pattern>
          </defs>
          <rect width="100%" height="100%" fill="url(#grid)"/>
          <g transform="translate(400, 300)">
            ${g}
          </g>
          <text x="400" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2d3748">Molecule: ${k}</text>
          <text x="400" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#718096">Simple SVG Renderer (Fallback)</text>
        </svg>
      `;return console.log("Setting SVG content via React state..."),m.current&&(C(D),i.current={svg:D,type:"svg"}),console.log("Simple SVG rendering completed successfully"),!0}catch(y){return console.error("Simple SVG renderer error:",y),!1}},[]),T=a.useCallback(()=>{if(!l.current)return{width:800,height:400};const k=l.current.getBoundingClientRect(),y=Math.max(k.width-40,400),b=Math.max(k.height-40,300);return{width:Math.min(y,900),height:Math.min(b,700)}},[]),F=a.useCallback(async k=>{console.log("=== MoleculeViewer: renderWithRDKit called ==="),console.log("SMILES for RDKit rendering:",k),console.log("Container ref available:",!!l.current);try{const y=await et();if(!y)return console.warn("RDKit not available, using fallback"),!1;if(!m.current)return console.warn("Component unmounted during RDKit initialization"),!1;const b=y.get_mol(k);if(!b)return console.warn("Invalid molecule for RDKit"),!1;const{width:R,height:g}=T();console.log(`RDKit: Using responsive dimensions ${R}x${g}`);const N=b.get_svg(R,g).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%;"');return m.current&&(C(N),i.current={mol:b,svg:N,type:"svg"}),b.delete(),console.log("RDKit rendering completed successfully"),!0}catch(y){return console.error("RDKit error:",y),!1}},[T]),W=a.useCallback(async k=>{console.log("=== MoleculeViewer: renderWithSmilesDrawer called ===");try{const y=await et();if(!y)return console.warn("RDKit not available for SmilesDrawer fallback"),!1;if(!m.current)return console.warn("Component unmounted during SmilesDrawer initialization"),!1;const b=y.get_mol(k);if(!b)return console.warn("Invalid molecule for SmilesDrawer"),!1;const{width:R,height:g}=T();console.log(`SmilesDrawer: Using responsive dimensions ${R}x${g}`);const N=b.get_svg(R,g).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: linear-gradient(45deg, #e0f2fe 0%, #b3e5fc 100%); border: 3px solid #0277bd; border-radius: 15px; padding: 20px; box-shadow: 0 8px 16px rgba(2, 119, 189, 0.3);"').replace(/stroke="#000000"/g,'stroke="#1565c0" stroke-width="3"').replace(/fill="#000000"/g,'fill="#0d47a1"');return m.current&&(C(N),i.current={mol:b,svg:N,type:"svg",renderer:"SmilesDrawer"}),b.delete(),console.log("SmilesDrawer rendering completed successfully"),!0}catch(y){return console.error("SmilesDrawer error:",y),!1}},[T]),Q=a.useCallback(async k=>{console.log("=== MoleculeViewer: renderWithKekule called ===");try{const y=await et();if(!y)return console.warn("RDKit not available for Kekule fallback"),!1;if(!m.current)return console.warn("Component unmounted during Kekule initialization"),!1;const b=y.get_mol(k);if(!b)return console.warn("Invalid molecule for Kekule"),!1;const{width:R,height:g}=T();console.log(`Kekule: Using responsive dimensions ${R}x${g}`);const N=b.get_svg(R,g).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border: 3px solid #8e24aa; border-radius: 20px; padding: 25px; box-shadow: 0 10px 20px rgba(142, 36, 170, 0.4);"').replace(/stroke="#000000"/g,'stroke="#6a1b9a" stroke-width="4"').replace(/fill="#000000"/g,'fill="#4a148c"').replace(/stroke-width="2"/g,'stroke-width="5"');return m.current&&(C(N),i.current={mol:b,svg:N,type:"svg",renderer:"Kekule.js"}),b.delete(),console.log("Kekule rendering completed successfully"),!0}catch(y){return console.error("Kekule error:",y),!1}},[T]),U=a.useCallback(async(k,y)=>{console.log("=== MoleculeViewer: renderWithMolstar called ===");try{if(!m.current)return console.warn("Component unmounted during Molstar initialization"),!1;const b=window.molstar||window.Molstar||window.MolstarViewer;if(!b){console.warn("Molstar not loaded, falling back to placeholder");const D=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">Mol* Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return m.current&&C(D),!1}const R=`molstar-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Molstar: Generated container ID:",R);const g=`<div id="${R}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("Molstar: Created container HTML:",g),m.current&&(C(g),setTimeout(async()=>{if(!m.current){console.log("Molstar: Component unmounted during timeout");return}console.log("Molstar: Looking for DOM element with ID:",R);const D=document.getElementById(R);if(console.log("Molstar: Found DOM element:",D),!D){console.error("Molstar container not found in DOM");return}try{console.log("Molstar: Creating plugin with element:",D),console.log("Molstar: Available API:",b),console.log("Molstar: API keys:",Object.keys(b||{}));let N;if(b.createPlugin)N=await b.createPlugin(D,{layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutShowSequence:!0,layoutShowLog:!1,layoutShowLeftPanel:!0,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"rcsb",emdbProvider:"rcsb"});else if(b.Viewer&&b.Viewer.create)N=await b.Viewer.create(D,{layoutIsExpanded:!1,layoutShowControls:!1});else if(b.create)N=await b.create(D,{layoutIsExpanded:!1,layoutShowControls:!1});else throw new Error("No valid Molstar API method found");if(console.log("Molstar: Plugin created successfully:",N),console.log("Molstar: Plugin methods:",Object.getOwnPropertyNames(N)),console.log("Molstar: Plugin prototype methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(N))),y&&y.molblock){console.log("Molstar: Loading molecule from molblock SDF data"),console.log("Molstar: Molblock type:",typeof y.molblock),console.log("Molstar: Molblock length:",y.molblock.length);try{console.log("Molstar: Available plugin methods:",Object.keys(N)),N.dataTransaction&&typeof N.dataTransaction=="function"?(console.log("Molstar: Using dataTransaction method"),await V(N)):N.loadStructureFromData&&typeof N.loadStructureFromData=="function"?(console.log("Molstar: Using loadStructureFromData method"),await N.loadStructureFromData(y.molblock,"sdf",!1)):N.loadStructureFromString&&typeof N.loadStructureFromString=="function"?(console.log("Molstar: Using loadStructureFromString method"),await N.loadStructureFromString(y.molblock,"sdf")):N.load&&typeof N.load=="function"?(console.log("Molstar: Using load method"),await N.load({data:y.molblock,format:"sdf"})):(console.warn("Molstar: No known loading method found, falling back"),await oe(N)),console.log("Molstar: Successfully loaded molecule from SDF data")}catch(H){console.error("Molstar: Error loading SDF data:",H),await oe(N)}}else console.log("Molstar: No molblock found, trying SMILES fallback"),await oe(N);async function V(H){const ce=new Blob([y.molblock],{type:"chemical/x-mdl-sdfile"}),ge=URL.createObjectURL(ce);await H.dataTransaction(async()=>{const pe=await H.builders.data.download({url:ge,isBinary:!1},{state:{isGhost:!1}}),Ce=await H.builders.structure.parseTrajectory(pe,"sdf"),Me=await H.builders.structure.createModel(Ce),ve=await H.builders.structure.createStructure(Me);await H.builders.structure.representation.addRepresentation(ve,{type:"ball-and-stick",colorTheme:{name:"element-symbol"},sizeTheme:{name:"physical"}}),await H.builders.structure.representation.addRepresentation(ve,{type:"spacefill",colorTheme:{name:"element-symbol"},sizeTheme:{name:"physical"}})}),URL.revokeObjectURL(ge),H.managers&&H.managers.camera&&H.managers.camera.focusLoci(H.managers.structure.hierarchy.current.structures)}async function oe(H){try{console.log("Molstar: Creating SMILES information display");const ce=`
                  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 24px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; max-width: 500px;">
                      <div style="font-size: 3.5rem; margin-bottom: 20px; color: #60a5fa;">🧬</div>
                      <h3 style="font-size: 1.8rem; margin-bottom: 16px; color: #f1f5f9; font-weight: bold;">Mol* Molecular Viewer</h3>
                      <p style="font-size: 1rem; margin-bottom: 20px; color: #cbd5e1; line-height: 1.5;">Advanced 3D molecular visualization powered by Molstar</p>
                      
                      <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                        <h4 style="color: #e2e8f0; margin-bottom: 12px; font-size: 1.1rem;">Molecular Information</h4>
                        <div style="font-family: monospace; font-size: 0.9rem; line-height: 1.6;">
                          <p style="margin: 8px 0; color: #f8fafc;"><strong>SMILES:</strong> <span style="color: #60a5fa;">${k}</span></p>
                          ${y&&y.molblock?'<p style="margin: 8px 0; color: #f8fafc;"><strong>Format:</strong> <span style="color: #34d399;">SDF/Molblock</span></p>':""}
                          ${y&&y.molblock?`<p style="margin: 8px 0; color: #f8fafc;"><strong>Lines:</strong> <span style="color: #fbbf24;">${y.molblock.split("\\n").length}</span></p>`:""}
                          ${y&&y.json&&y.json.atoms?`<p style="margin: 8px 0; color: #f8fafc;"><strong>Atoms:</strong> <span style="color: #f87171;">${y.json.atoms.length||"N/A"}</span></p>`:""}
                        </div>
                      </div>
                      
                      <div style="background: rgba(96, 165, 250, 0.1); padding: 16px; border-radius: 8px; border: 1px solid rgba(96, 165, 250, 0.2);">
                        <p style="font-size: 0.9rem; color: #93c5fd; margin: 0; line-height: 1.4;">
                          <strong>🔧 Integration Status:</strong><br/>
                          Mol* plugin loaded successfully. Advanced 3D rendering features are being configured.
                        </p>
                      </div>
                      
                      <div style="margin-top: 16px; font-size: 0.8rem; color: #64748b;">
                        Plugin: <span style="color: #94a3b8;">${H.constructor.name||"Molstar"}</span> | 
                        API: <span style="color: #94a3b8;">${Object.keys(H).length} methods</span>
                      </div>
                    </div>
                  </div>
                `;m.current&&C(ce)}catch(ce){console.warn("Molstar: SMILES fallback failed:",ce)}}i.current={type:"molstar",plugin:N,element:D,renderer:"Mol*"},console.log("Molstar: 3D molecule rendered successfully")}catch(N){if(console.error("Molstar plugin creation error:",N),m.current){const V=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #64748b;">
                  <div style="text-align: center; padding: 20px; max-width: 400px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">🧬</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px; color: #f1f5f9;">Mol* Viewer</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px; color: #cbd5e1;">Molecular Structure Information</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 6px; font-family: monospace; margin-bottom: 16px;">
                      <p style="margin: 0; font-size: 0.9rem; color: #e2e8f0;">SMILES: ${k}</p>
                      ${y&&y.molblock?`<p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #94a3b8;">Molblock: ${y.molblock.split("\\n").length} lines</p>`:""}
                      ${y&&y.json&&y.json.atoms?`<p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #94a3b8;">Atoms: ${y.json.atoms.length||"N/A"}</p>`:""}
                    </div>
                    <p style="font-size: 0.8rem; color: #94a3b8;">Mol* integration in progress</p>
                    <p style="font-size: 0.75rem; color: #64748b; margin-top: 8px;">${N.message}</p>
                  </div>
                </div>
              `;C(V)}}},200)),console.log("Mol* rendering completed successfully"),!0}catch(b){if(console.error("Mol* error:",b),m.current){const R=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">Mol* Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize Mol*</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${b.message}</p>
              </div>
            </div>
          </div>
        `;C(R)}return!1}},[]),I=a.useCallback(async(k,y)=>{console.log("=== MoleculeViewer: renderWith3Dmol called ===");try{if(!m.current)return console.warn("Component unmounted during 3Dmol initialization"),!1;if(typeof window.$3Dmol>"u"){console.warn("3Dmol.js not loaded, falling back to placeholder");const g=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return m.current&&C(g),!1}const b=`mol3d-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("3Dmol: Generated container ID:",b);const R=`<div id="${b}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("3Dmol: Created container HTML:",R),m.current&&(C(R),setTimeout(()=>{if(!m.current){console.log("3Dmol: Component unmounted during timeout");return}console.log("3Dmol: Looking for DOM element with ID:",b);const g=document.getElementById(b);if(console.log("3Dmol: Found DOM element:",g),!g){console.error("3Dmol container not found in DOM");return}try{console.log("3Dmol: Creating viewer with element:",g);const D=window.$3Dmol.createViewer(g,{defaultcolors:window.$3Dmol.rasmolElementColors});console.log("3Dmol: Viewer created successfully:",D),y&&y.molblock?(console.log("3Dmol: Adding molecule from molblock SDF data"),console.log("3Dmol: Molblock type:",typeof y.molblock),console.log("3Dmol: Molblock length:",y.molblock.length),D.addModel(y.molblock,"sdf"),console.log("3Dmol: Successfully added molecule from SDF data")):y&&typeof y=="string"?(console.log("3Dmol: Adding molecule from string data"),D.addModel(y,"sdf"),console.log("3Dmol: Added molecule from string SDF data")):(console.log("3Dmol: No molblock found, trying SMILES fallback"),D.addModel(k,"smiles"),console.log("3Dmol: Added molecule from SMILES")),D.setStyle({},{stick:{radius:.15,colorscheme:"default"},sphere:{radius:.4,colorscheme:"default"}}),console.log("3Dmol: Applied molecular styling");const N=D.getModel(0).selectedAtoms({}).length;console.log("3Dmol: Number of atoms in model:",N),D.zoomTo(),D.center(),D.rotate(20,{x:1,y:0,z:0}),D.rotate(30,{x:0,y:1,z:0}),console.log("3Dmol: Applied view transformations"),D.render(),console.log("3Dmol: Initial render completed"),setTimeout(()=>{m.current&&D&&(D.render(),console.log("3Dmol: Secondary render completed"))},100),i.current={type:"3dmol",viewer:D,element:g,renderer:"3Dmol.js"};const V=g.querySelector("canvas");if(V){console.log("3Dmol: Canvas found:",V),console.log("3Dmol: Canvas dimensions:",V.width,"x",V.height),console.log("3Dmol: Canvas style before fix:",V.style.cssText),V.style.position="relative",V.style.top="0px",V.style.left="0px",V.style.width="100%",V.style.height="100%",V.style.maxWidth="100%",V.style.maxHeight="100%",console.log("3Dmol: Canvas style after fix:",V.style.cssText);try{V.getContext("webgl")||V.getContext("experimental-webgl")?console.log("3Dmol: WebGL context successfully created"):console.warn("3Dmol: WebGL context not available")}catch(oe){console.warn("3Dmol: WebGL context error:",oe)}}console.log("3Dmol.js: 3D molecule rendered successfully")}catch(D){if(console.error("3Dmol viewer creation error:",D),m.current){const N=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
                  <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 16px;">❌</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Error</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to create 3D viewer</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                      <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                      <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${D.message}</p>
                    </div>
                  </div>
                </div>
              `;C(N)}}},100)),console.log("3Dmol.js rendering completed successfully"),!0}catch(b){if(console.error("3Dmol.js error:",b),m.current){const R=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize 3Dmol.js</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${b.message}</p>
              </div>
            </div>
          </div>
        `;C(R)}return!1}},[]),A=a.useCallback(async(k,y)=>{console.log("=== MoleculeViewer: renderWithNGL called ===");try{if(!m.current)return console.warn("Component unmounted during NGL initialization"),!1;if(typeof window.NGL>"u"){console.warn("NGL not loaded, falling back to placeholder");const g=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return m.current&&C(g),!1}const b=`ngl-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("NGL: Generated container ID:",b);const R=`<div id="${b}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("NGL: Created container HTML:",R),m.current&&(C(R),setTimeout(()=>{if(!m.current){console.log("NGL: Component unmounted during timeout");return}console.log("NGL: Looking for DOM element with ID:",b);const g=document.getElementById(b);if(console.log("NGL: Found DOM element:",g),!g){console.error("NGL container not found in DOM");return}try{let D=function(V){try{const oe=V.addComponentFromObject({name:"molecule",structure:{type:"text",data:`SMILES: ${k}

This is a molecular structure viewer.
For full 3D visualization, SDF data is required.`}});console.log("NGL: Created text fallback representation")}catch(oe){console.warn("NGL: Text fallback also failed:",oe)}};console.log("NGL: Creating stage with element:",g);const N=new window.NGL.Stage(g,{backgroundColor:"black",quality:"medium",sampleLevel:1});if(console.log("NGL: Stage created successfully:",N),y&&y.molblock){console.log("NGL: Adding molecule from molblock SDF data"),console.log("NGL: Molblock type:",typeof y.molblock),console.log("NGL: Molblock length:",y.molblock.length);const V=new Blob([y.molblock],{type:"chemical/x-mdl-sdfile"}),oe=new File([V],"molecule.sdf",{type:"chemical/x-mdl-sdfile"});N.loadFile(oe,{ext:"sdf"}).then(H=>{console.log("NGL: Successfully loaded molecule from SDF data"),H.addRepresentation("ball+stick",{colorScheme:"element",quality:"medium",bondScale:.3,bondSpacing:.75}),H.addRepresentation("spacefill",{colorScheme:"element",opacity:.3,quality:"low"}),H.autoView(),console.log("NGL: Applied molecular styling and auto view")}).catch(H=>{console.error("NGL: Error loading SDF data:",H),D(N)})}else console.log("NGL: No molblock found, trying SMILES fallback"),D(N);i.current={type:"ngl",stage:N,element:g,renderer:"NGL"},console.log("NGL: 3D molecule rendered successfully")}catch(D){if(console.error("NGL stage creation error:",D),m.current){const N=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
                  <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 16px;">❌</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Error</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to create NGL stage</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                      <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                      <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${D.message}</p>
                    </div>
                  </div>
                </div>
              `;C(N)}}},100)),console.log("NGL rendering completed successfully"),!0}catch(b){if(console.error("NGL error:",b),m.current){const R=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">⚠️</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize NGL</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${k}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${b.message}</p>
              </div>
            </div>
          </div>
        `;C(R)}return!1}},[]),q=a.useCallback(async()=>{if(!t||typeof t=="string"&&t.trim()===""){m.current&&(w(!1),S("No SMILES string provided"));return}let k=0;const y=5;for(;!l.current&&k<y;)console.log(`Waiting for container... retry ${k+1}`),await new Promise(b=>setTimeout(b,100)),k++;if(!l.current){console.error("Container ref never became available after retries"),m.current&&(w(!1),S("Container not available"));return}console.log(`Starting molecule rendering for: ${t} (mode: ${o}, renderer: ${r})`),m.current&&(w(!0),S(null),C("")),z();try{let b=!1,R=null;if(o==="3D")try{console.log("Generating 3D coordinates..."),R=await or(t),console.log("3D coordinates generated successfully"),console.log("Generated molData type:",typeof R),console.log("Generated molData keys:",Object.keys(R)),console.log("Molblock preview (first 100 chars):",R.molblock.substring(0,100)),console.log("Has real 3D coordinates:",R.has3D),console.log("Atom count:",R.atomCount)}catch(g){console.warn("Failed to generate 3D coordinates:",g)}switch(console.log(`Attempting to render with ${r}...`),r){case"SmilesDrawer":b=await W(t);break;case"RDKit.js":b=await F(t);break;case"Kekule.js":b=await Q(t);break;case"3Dmol.js":b=await I(t,R);break;case"NGL":b=await A(t,R);break;case"Mol*":b=await U(t,R);break;default:console.log(`Unknown renderer ${r}, trying RDKit`),b=await F(t)}if(!l.current){console.warn("Container ref became null during rendering, component may have unmounted");return}if(!b&&["SmilesDrawer","Kekule.js"].includes(r)?(console.warn(`${r} failed, trying RDKit fallback`),b=await F(t)):!b&&["3Dmol.js","NGL"].includes(r)&&(console.warn(`${r} failed, trying Mol* fallback`),b=await U(t,R)),!l.current){console.warn("Container ref became null during fallback rendering");return}if(b||(console.warn("All advanced renderers failed, using simple SVG fallback"),b=await _(t)),!l.current){console.warn("Container ref became null during error handling");return}if(b)console.log("Molecule rendered successfully");else if(console.error("All rendering methods failed, showing error message"),m.current){const g=`
            <svg width="800" height="600" viewBox="0 0 800 600" style="background: #fee2e2; border: 2px solid #fecaca; border-radius: 8px;">
              <text x="400" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="4rem" fill="#dc2626">⚠️</text>
              <text x="400" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="1.125rem" font-weight="600" fill="#dc2626">Rendering Failed</text>
              <text x="400" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="0.875rem" fill="#dc2626">Unable to render molecule</text>
              <text x="400" y="350" text-anchor="middle" font-family="monospace" font-size="0.75rem" fill="#dc2626">SMILES: ${t}</text>
              <text x="400" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="0.75rem" fill="#7f1d1d">Please check SMILES format and try again</text>
            </svg>
          `;C(g),i.current={type:"error"},S("Failed to render molecule with any available renderer")}m.current&&G(R)}catch(b){console.error("Critical rendering error:",b),m.current&&S(`Error rendering molecule: ${b.message}`);try{l.current&&await _(t)&&console.log("Emergency fallback rendering succeeded")}catch(R){console.error("Even fallback rendering failed:",R)}}finally{m.current&&w(!1)}},[t,o,r,z,F,U,_]);a.useEffect(()=>{console.log("=== MoleculeViewer: useEffect triggered ==="),console.log("Triggering renderMolecule with:",{smiles:(t==null?void 0:t.substring(0,50))+"...",mode:o,renderer:r}),console.log("Container ref current:",!!l.current),q()},[t,o,r,q]),a.useEffect(()=>z,[z]);const ie=a.useCallback(async()=>{if(!l.current)return console.warn("Container not found for PNG export"),!1;const k=l.current.querySelector("svg");if(k)try{const b=document.createElement("canvas"),R=b.getContext("2d"),g=new Image;let D,N;const V=k.getAttribute("viewBox");if(V){const[,,ge,pe]=V.split(" ").map(Number);D=ge,N=pe}else D=parseFloat(k.getAttribute("width"))||800,N=parseFloat(k.getAttribute("height"))||600;D=Math.max(400,Math.min(D,2e3)),N=Math.max(300,Math.min(N,2e3)),console.log(`PNG Export: Using dimensions ${D}x${N}`);const oe=new XMLSerializer().serializeToString(k),H=new Blob([oe],{type:"image/svg+xml;charset=utf-8"}),ce=URL.createObjectURL(H);return new Promise(ge=>{g.onload=async()=>{try{b.width=D,b.height=N,R.fillStyle="white",R.fillRect(0,0,D,N),R.drawImage(g,0,0,D,N);const pe=await bt(b,t);URL.revokeObjectURL(ce),ge(pe)}catch(pe){console.error("PNG export error:",pe),URL.revokeObjectURL(ce),ge(!1)}},g.onerror=()=>{console.error("Failed to load SVG for PNG export"),URL.revokeObjectURL(ce),ge(!1)},g.src=ce})}catch(b){return console.error("PNG export error:",b),!1}const y=l.current.querySelector("canvas");if(y)try{return await bt(y,t)}catch(b){return console.error("Canvas PNG export error:",b),!1}return console.warn("No exportable content found (SVG or Canvas)"),!1},[t]),O=a.useCallback(async()=>{if(!l.current)return console.warn("Container not found for SVG export"),!1;const k=l.current.querySelector("svg");if(k)try{return await ar(k,t)}catch(y){return console.error("SVG export error:",y),!1}return console.warn("No SVG content found for export"),!1},[t]),J=a.useCallback(async()=>{if(o!=="3D")return console.warn("GLTF export only available in 3D mode"),!1;try{const k={asset:{version:"2.0",generator:"Lipid Viewer - Molecular Visualization Tool",copyright:"Generated molecular structure"},scene:0,scenes:[{name:"Molecular Scene",nodes:[0]}],nodes:[{name:`Molecule_${t}`,extras:{molecularData:{smiles:t,formula:"Generated from SMILES",molblock:(M==null?void 0:M.molblock)||"No 3D coordinates available",has3D:(M==null?void 0:M.has3D)||!1,atomCount:(M==null?void 0:M.atomCount)||"Unknown",generatedBy:"Lipid Viewer",exportTime:new Date().toISOString()}}}],extensionsUsed:[],extensionsRequired:[],extras:{description:"Molecular structure exported from Lipid Viewer",format:"GLTF 2.0 with molecular metadata",software:"Lipid Viewer",smiles:t}};M&&M.has3D&&(k.meshes=[{name:"MolecularMesh",primitives:[{mode:1,attributes:{},extras:{note:"Actual molecular geometry in molblock format",molblock:M.molblock}}]}],k.nodes[0].mesh=0);const y=JSON.stringify(k,null,2);return await ir(y,t)}catch(k){return console.error("GLTF export error:",k),!1}},[t,o,r,M]);return a.useEffect(()=>{n&&n({png:ie,svg:O,gltf:J})},[n,ie,O,J]),e.jsxs("div",{className:`molecule-viewer ${o==="2D"?"molecule-2d":"molecule-3d"} p-4`,"data-testid":"molecule-viewer",children:[e.jsx("div",{ref:l,className:"w-full h-96 flex items-center justify-center border border-gray-300 rounded-lg bg-white",style:{minHeight:"400px"},children:p?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading molecule..."})]}):B?e.jsx("div",{dangerouslySetInnerHTML:{__html:B},style:{width:"100%",height:"100%"}}):u?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-red-600 font-semibold",children:"Error rendering molecule"}),e.jsx("p",{className:"text-red-500 text-sm mt-2",children:u})]}):null}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Mode:"})," ",o," | ",e.jsx("strong",{children:"Renderer:"})," ",r," | ",e.jsx("strong",{children:"SMILES:"})," ",t]}),r&&!v[r.replace(".","").replace("*","star")]&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Note: ",r," not fully available, showing fallback display"]})]})]})}),At=({mode:t,onZoomIn:o,onZoomOut:r,onResetView:n,onExportPNG:s,onExportSVG:l,onExportGLTF:i,isLoaded:m=!1})=>m?e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"View Controls"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Navigation"}),e.jsxs("button",{onClick:o,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Zoom In (or use + key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Zoom In"})]}),e.jsxs("button",{onClick:r,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Zoom Out (or use - key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18 12H6"})}),e.jsx("span",{children:"Zoom Out"})]}),e.jsxs("button",{onClick:n,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Reset View (or use Space key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Reset View"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Export"}),e.jsxs("button",{onClick:s,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as PNG image",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Export PNG"})]}),e.jsxs("button",{onClick:l,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as SVG vector",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Export SVG"})]}),t==="3D"&&e.jsxs("button",{onClick:i,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as GLTF 3D model",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("span",{children:"Export GLTF"})]})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Keyboard Shortcuts"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zoom In:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"+"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zoom Out:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Reset View:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Space"})]}),t==="3D"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rotate:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Mouse Drag"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pan:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Shift + Drag"})]})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Current Mode:"})," ",t==="2D"?"2D Structure View":"3D Molecular View",t==="3D"&&" - Use mouse to rotate, scroll to zoom"]})})]}):null;function dr(){const[t,o]=a.useState(""),[r,n]=a.useState("2D"),[s,l]=a.useState("SmilesDrawer"),[i,m]=a.useState(!1),[p,w]=a.useState(!1),[u,S]=a.useState(null);console.log("=== App.jsx: Component rendered ==="),console.log("Current state:",{currentSMILES:t,mode:r,renderer:s,isValidSMILES:i,isMoleculeLoaded:p}),a.useEffect(()=>{console.log("=== App.jsx: currentSMILES changed ==="),console.log("New currentSMILES value:",t),console.log("Will render MoleculeViewer:",!!t)},[t]),a.useRef(null);const M=a.useRef(1),G=a.useCallback(I=>{console.log("=== App.jsx: handleModeChange called ==="),console.log("Mode changed from",r,"to",I),n(I),l(I==="2D"?"SmilesDrawer":"3Dmol.js")},[r]),B=a.useCallback(I=>{console.log("=== App.jsx: handleRendererChange called ==="),console.log("Renderer changed from",s,"to",I),l(I)},[s]),C=a.useCallback((I,A)=>{m(A),!A&&I.trim()&&be.error("Invalid SMILES string",{duration:3e3,position:"top-center"})},[]),v=a.useCallback(I=>{if(console.log("=== App.jsx: handleSMILESSubmit called ==="),console.log("Received SMILES:",I),console.log("Current state before update:",{currentSMILES:t,mode:r,renderer:s}),!I.trim()){be.error("Please enter a SMILES string",{duration:4e3,position:"top-center"});return}o(I),w(!0),console.log("SMILES state updated to:",I),console.log("isMoleculeLoaded set to true"),be.success(`Loading molecule: ${I}`),i||be.error("Warning: SMILES may be invalid, but attempting to render",{duration:5e3,position:"top-center"})},[i,t,r,s]),z=a.useCallback(I=>{S(I)},[]),_=a.useCallback(()=>{M.current=Math.min(M.current*1.2,5),be.success(`Zoom: ${Math.round(M.current*100)}%`,{duration:1e3,position:"bottom-right"})},[]),T=a.useCallback(()=>{M.current=Math.max(M.current/1.2,.2),be.success(`Zoom: ${Math.round(M.current*100)}%`,{duration:1e3,position:"bottom-right"})},[]),F=a.useCallback(()=>{M.current=1,be.success("View reset",{duration:1e3,position:"bottom-right"})},[]),W=a.useCallback(async()=>{u!=null&&u.png&&be.promise(u.png(),{loading:"Exporting PNG...",success:"PNG exported successfully!",error:"Failed to export PNG"})},[u]),Q=a.useCallback(async()=>{u!=null&&u.svg&&be.promise(u.svg(),{loading:"Exporting SVG...",success:"SVG exported successfully!",error:"Failed to export SVG"})},[u]),U=a.useCallback(async()=>{u!=null&&u.gltf&&be.promise(u.gltf(),{loading:"Exporting GLTF...",success:"GLTF exported successfully!",error:"Failed to export GLTF"})},[u]);return a.useEffect(()=>{const I=A=>{if(!(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA"))switch(A.key){case"+":case"=":A.preventDefault(),_();break;case"-":case"_":A.preventDefault(),T();break;case" ":A.preventDefault(),F();break;case"2":(A.ctrlKey||A.metaKey)&&(A.preventDefault(),G("2D"));break;case"3":(A.ctrlKey||A.metaKey)&&(A.preventDefault(),G("3D"));break}};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[_,T,F,G]),a.useEffect(()=>{t||w(!1)},[t]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Kt,{}),e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Lipid Viewer"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Interactive 2D/3D molecular visualization tool"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mode: ",e.jsx("span",{className:"font-semibold",children:r})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Renderer: ",e.jsx("span",{className:"font-semibold",children:s})]}),e.jsx(It,{to:"/dock",className:"ml-4 inline-flex items-center px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 text-sm",children:"Docking"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(Pt,{onSubmit:v,onValidation:C,isValid:i}),e.jsx(Ft,{mode:r,renderer:s,onModeChange:G,onRendererChange:B}),t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Molecule Visualization"}),e.jsx(Vt,{smiles:t,mode:r,renderer:s,onExport:z})]}),p&&e.jsx(At,{mode:r,onZoomIn:_,onZoomOut:T,onResetView:F,onExportPNG:W,onExportSVG:Q,onExportGLTF:U,isLoaded:p}),!t&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Welcome to Lipid Viewer"}),e.jsxs("div",{className:"text-blue-700 space-y-2",children:[e.jsx("p",{children:"• Enter a SMILES string above to visualize molecular structures"}),e.jsx("p",{children:"• Choose between 2D and 3D visualization modes"}),e.jsx("p",{children:"• Select different rendering engines for optimal display"}),e.jsx("p",{children:"• Export your visualizations as PNG, SVG, or GLTF files"}),e.jsx("p",{children:"• Use keyboard shortcuts: +/- for zoom, Space to reset view"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-800 mb-2",children:"🚧 Framework Preparation"}),e.jsx("p",{className:"text-yellow-700 text-sm",children:"Electrostatic surface visualization feature is prepared for future implementation. The current framework supports multiple rendering engines and can be extended to include surface rendering capabilities."})]})]})}),e.jsx("footer",{className:"bg-white border-t mt-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Powered by"," ",e.jsx("span",{className:"font-semibold",children:"SmilesDrawer"}),","," ",e.jsx("span",{className:"font-semibold",children:"RDKit.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"Kekule.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"3Dmol.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"Mol*"}),", and"," ",e.jsx("span",{className:"font-semibold",children:"NGL"})]}),e.jsx("p",{className:"mt-1",children:"Built with React 18, Vite, and Tailwind CSS"})]})})})]})}function ur({ligandSmiles:t,receptorPdbId:o,className:r="",...n}){console.log("🚀 DockingMoleculeViewer: Component rendered with props:",{ligandSmiles:t,receptorPdbId:o});const s=a.useRef(null),l=a.useRef(null),[i,m]=a.useState(!0),[p,w]=a.useState(null),[u,S]=a.useState("");a.useEffect(()=>{if(!s.current)return;const C=async()=>{m(!0),w(null);try{if(typeof window.$3Dmol>"u"){w("3Dmol.js library not available"),m(!1);return}const v=`docking-viewer-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,z=`<div id="${v}" style="width: 100%; height: 400px; min-height: 400px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;console.log("📦 Creating container with ID:",v),console.log("📏 Container HTML:",z),S(z),setTimeout(async()=>{const _=document.getElementById(v);if(!_){w("Could not create 3D container"),m(!1);return}const T=_.getBoundingClientRect();if(console.log("📐 Container dimensions:",{width:T.width,height:T.height,top:T.top,left:T.left,bottom:T.bottom,right:T.right}),T.width===0||T.height===0){console.warn("❌ Container has zero dimensions, retrying...",T),setTimeout(()=>C(),200);return}else console.log("✅ Container has valid dimensions");try{console.log("🧬 DockingMoleculeViewer: Starting protein+ligand visualization");const F=window.$3Dmol.createViewer(_,{defaultcolors:window.$3Dmol.rasmolElementColors,antialias:!1,preserveDrawingBuffer:!0});if(!F)throw new Error("Failed to create 3Dmol viewer");l.current=F,console.log("✅ 3Dmol viewer created successfully");let W=-1,Q=-1;o&&(W=await M(F,o)),t&&(Q=await G(F,t)),B(F,W,Q);try{console.log("🎯 Starting render process..."),console.log("🔍 Viewer state:",{hasViewer:!!F,modelCount:F.getModels?F.getModels().length:"unknown",element:_,elementDimensions:_.getBoundingClientRect()});try{const U=F.getModels?F.getModels():[];console.log("📊 Models in viewer:",U.length),U.forEach((I,A)=>{try{const q=I.selectedAtoms?I.selectedAtoms({}):[];console.log(`   Model ${A}: ${q.length} atoms`)}catch{console.log(`   Model ${A}: Could not count atoms`)}})}catch(U){console.warn("⚠️ Could not check models:",U)}console.log("🎯 Step 1: zoomTo()"),F.zoomTo(),console.log("✅ zoomTo completed"),console.log("🎯 Step 2: center()"),F.center(),console.log("✅ center completed"),console.log("🎯 Step 3: render()"),F.render(),console.log("✅ Initial render completed"),setTimeout(()=>{const U=_.querySelector("canvas");if(U){console.log("🖼️ Canvas found:",{width:U.width,height:U.height,clientWidth:U.clientWidth,clientHeight:U.clientHeight,style:U.style.cssText});try{const I=U.getContext("webgl")||U.getContext("experimental-webgl");I?console.log("🎮 WebGL context found:",{vendor:I.getParameter(I.VENDOR),renderer:I.getParameter(I.RENDERER),version:I.getParameter(I.VERSION),maxTextureSize:I.getParameter(I.MAX_TEXTURE_SIZE),viewportDims:I.getParameter(I.VIEWPORT)}):console.error("❌ No WebGL context available!")}catch(I){console.error("❌ WebGL context check failed:",I)}}else console.error("❌ No canvas found in element!");if(l.current)try{console.log("🎯 Secondary render..."),l.current.render(),console.log("✅ Secondary render completed")}catch(I){console.warn("⚠️ Secondary render failed:",I)}},500)}catch(U){console.error("❌ Render failed:",U),w(`Rendering failed: ${U.message}`)}m(!1)}catch(F){console.error("Error creating docking visualization:",F),w(F.message),m(!1)}},300)}catch(v){console.error("Error initializing docking viewer:",v),w(v.message),m(!1)}};return C(),()=>{if(l.current)try{l.current.clear()}catch(v){console.warn("Error during cleanup:",v)}}},[t,o]);const M=async(C,v)=>{try{console.log(`Loading protein ${v}...`);const z=`https://files.rcsb.org/download/${v.toUpperCase()}.pdb`,_=await fetch(z);if(!_.ok)throw new Error(`Failed to fetch protein ${v}: ${_.statusText}`);const T=await _.text();C.addModel(T,"pdb");const F=0;return console.log(`Protein ${v} loaded successfully as model ${F}`),F}catch(z){return console.error("Error loading protein:",z),-1}},G=async(C,v)=>{try{console.log(`Loading ligand from SMILES: ${v}`);try{const z=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:v,num_conformers:1})});if(z.ok){const _=await z.json();C.addModel(_.sdf,"sdf");const T=1;return console.log(`Ligand loaded from backend successfully as model ${T}`),T}}catch(z){console.warn("Backend ligand preparation failed, using fallback:",z)}try{C.addModel(v,"smiles");const z=1;return console.log(`Ligand loaded via SMILES fallback as model ${z}`),z}catch(z){return console.error("Failed to load ligand via SMILES:",z),-1}}catch(z){return console.error("Error loading ligand:",z),-1}},B=(C,v,z)=>{try{if(console.log(`Applying styling - Protein: ${v}, Ligand: ${z}`),v>=0){console.log(`🧬 Styling protein model ${v}`),C.setStyle({model:v},{cartoon:{color:"spectrum",opacity:.8}}),console.log("✅ Applied protein cartoon styling");try{C.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.15,color:"lightblue"},{model:v}),console.log("✅ Applied protein surface")}catch(_){console.warn("⚠️ Could not add protein surface:",_)}}if(z>=0){console.log(`💊 Styling ligand model ${z}`),C.setStyle({model:z},{stick:{colorscheme:"greenCarbon",radius:.4,opacity:1},sphere:{colorscheme:"greenCarbon",radius:.3,opacity:.9}}),console.log("✅ Applied ligand stick+sphere styling");try{C.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.4,color:"yellow"},{model:z}),console.log("✅ Applied ligand glow surface")}catch(_){console.warn("⚠️ Could not add ligand surface:",_)}}if(v<0&&z<0){console.warn("Model indices not available, applying fallback styling");try{C.setStyle({model:0},{cartoon:{color:"spectrum",opacity:.8}}),C.setStyle({model:1},{stick:{colorscheme:"greenCarbon",radius:.3},sphere:{colorscheme:"greenCarbon",radius:.25,opacity:.8}}),console.log("Applied fallback styling: model 0 as protein, model 1 as ligand")}catch(_){console.warn("Fallback styling failed:",_)}}}catch(_){console.error("Error applying molecular styling:",_),C.setStyle({},{stick:{radius:.2},sphere:{radius:.3}})}};return p?e.jsx("div",{className:`flex items-center justify-center h-96 bg-red-50 border border-red-200 rounded-lg ${r}`,children:e.jsxs("div",{className:"text-center text-red-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Visualization Error"}),e.jsx("div",{className:"text-sm",children:p})]})}):e.jsxs("div",{className:`relative ${r}`,children:[e.jsx("div",{ref:s,className:"w-full h-96",dangerouslySetInnerHTML:{__html:u}}),i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-75 rounded-lg",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),e.jsx("p",{children:"Loading docking visualization..."}),e.jsxs("p",{className:"text-sm opacity-75 mt-1",children:[o&&`Protein: ${o}`,o&&t&&" + ",t&&`Ligand: ${t.substring(0,20)}...`]})]})}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black bg-opacity-75 text-white rounded px-3 py-2 text-sm",children:[e.jsxs("div",{children:["🧬 ",o?`Protein: ${o}`:"No protein"]}),e.jsxs("div",{children:["💊 ",t?"Ligand loaded":"No ligand"]})]})]})}const mr=[{id:"HIV_protease_indinavir",protein:"1HSG",ligand:"Indinavir",smiles:"CC(C)CN(CC(O)C(Cc1ccccc1)NC(=O)OCc1ccccc1)C(=O)C(NC(=O)C(CC(C)C)NC(=O)OCc1ccccc1)CC1CCCCC1",expectedDistance:2.1,expectedBinding:{x:15.2,y:12.8,z:8.4},reference:"DOI:10.1038/nsb0895-718"},{id:"Acetylcholinesterase_tacrine",protein:"1ACJ",ligand:"Tacrine",smiles:"NC1=C2C(CCCC2)=NC3=C1C=CC=C3",expectedDistance:3.2,expectedBinding:{x:0,y:0,z:0},reference:"DOI:10.1021/jm00069a008"},{id:"Thrombin_MQPA",protein:"1HTM",ligand:"MQPA",smiles:"NC(=N)NCCCC(NC(=O)C(Cc1ccc(O)cc1)NC(=O)C(N)CCCNC(=N)N)C(=O)NCc1ccc(C(=O)O)cc1",expectedDistance:2.8,expectedBinding:{x:22.1,y:15.6,z:18.9},reference:"DOI:10.1006/jmbi.1994.1032"},{id:"Carbonic_anhydrase_acetazolamide",protein:"1AZM",ligand:"Acetazolamide",smiles:"CC(=O)NC1=NN=C(S1)S(=O)(=O)N",expectedDistance:2,expectedBinding:{x:0,y:0,z:20.5},reference:"DOI:10.1021/jm00145a002"},{id:"Trypsin_benzamidine",protein:"1TNI",ligand:"Benzamidine",smiles:"NC(=N)C1=CC=CC=C1",expectedDistance:1.9,expectedBinding:{x:16.8,y:25.4,z:14.2},reference:"DOI:10.1021/jm970645u"},{id:"Adenosine_deaminase_EHNA",protein:"1A4L",ligand:"EHNA",smiles:"NCCC1=NC=NC2=C1NC=N2",expectedDistance:2.5,expectedBinding:{x:-8.4,y:12.1,z:22.8},reference:"DOI:10.1021/bi9724569"},{id:"Lysozyme_tri_NAG",protein:"1LYZ",ligand:"Tri-N-acetylglucosamine",smiles:"CC(=O)NC1C(OC(C(O)C1O)OC2C(OC(C(O)C2NC(=O)C)OC3C(O)C(NC(=O)C)C(O)OC3CO)CO)CO",expectedDistance:2.3,expectedBinding:{x:12,y:8.5,z:15.2},reference:"DOI:10.1021/bi00484a024"},{id:"Dihydrofolate_reductase_methotrexate",protein:"1DRF",ligand:"Methotrexate",smiles:"CN(CC1=CN=C2N=C(N)N=C(N)C2=N1)C3=CC=C(C(=O)NC(CCC(=O)O)C(=O)O)C=C3",expectedDistance:1.8,expectedBinding:{x:5.2,y:18.9,z:12.4},reference:"DOI:10.1021/jm00392a014"},{id:"Thermolysin_phosphoramidon",protein:"1TLP",ligand:"Phosphoramidon",smiles:"CC(C)C(NC(=O)C(CC(C)C)NC(=O)CNC(=O)C(O)CC1=CC=CC=C1)C(=O)NCC(=O)N(O)P(=O)(O)O",expectedDistance:2.4,expectedBinding:{x:8.7,y:15.3,z:6.8},reference:"DOI:10.1021/bi00351a031"},{id:"Estrogen_receptor_estradiol",protein:"1ERE",ligand:"Estradiol",smiles:"CC12CCC3C(C1CCC2O)CCC4=C3C=CC(=C4)O",expectedDistance:2.6,expectedBinding:{x:22.5,y:30.1,z:18.7},reference:"DOI:10.1126/science.277.5331.1495"}],Fe={positionTolerance:3,distanceTolerance:1.5,minimumSuccessRate:.7,scientificAccuracy:{maxDistance:12,minDistance:1,poseVariationMin:1}};function gr(t,o){const r={passed:!1,score:0,reason:"",metrics:{}};try{const n=o.poses.reduce((u,S)=>(S.score||0)>(u.score||0)?S:u),s=Ot(t.expectedBinding,n);r.metrics.positionError=s;const l=Math.abs((n.protein_distance||0)-t.expectedDistance);r.metrics.distanceError=l;const i=fr(o.poses);r.metrics.scientificValid=i;const m=Math.max(0,1-s/Fe.positionTolerance),p=Math.max(0,1-l/Fe.distanceTolerance),w=i?1:0;r.score=m*.4+p*.4+w*.2,s<=Fe.positionTolerance&&l<=Fe.distanceTolerance&&i?(r.passed=!0,r.reason="All criteria met"):r.reason=`Position error: ${s.toFixed(2)}Å, Distance error: ${l.toFixed(2)}Å, Scientific: ${i}`}catch(n){r.reason=`Validation error: ${n.message}`}return r}function Ot(t,o){const r=(o.center_x||0)-t.x,n=(o.center_y||0)-t.y,s=(o.center_z||0)-t.z;return Math.sqrt(r*r+n*n+s*s)}function fr(t){if(!t||t.length<2)return!1;const o=[];for(let n=0;n<t.length-1;n++)for(let s=n+1;s<t.length;s++){const l=Ot(t[n],t[s]);o.push(l)}return o.reduce((n,s)=>n+s,0)/o.length>=Fe.scientificAccuracy.poseVariationMin}async function hr(){console.log("🚀 Quick benchmark validation check...");const t=mr[0];try{const o=await fetch("/api/dock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:t.smiles,receptor_pdb_id:t.protein,num_poses:5})});if(o.ok){const r=await o.json(),n=gr(t,r);return console.log(`🎯 Quick check result: ${n.passed?"✅ PASS":"❌ FAIL"} (Score: ${n.score.toFixed(2)})`),n}else return console.error("❌ Quick check failed: API error"),{passed:!1,reason:"API error"}}catch(o){return console.error("❌ Quick check failed:",o.message),{passed:!1,reason:o.message}}}function pr({ligandSmiles:t,receptorPdbId:o,poses:r=[],selectedPose:n=0,visiblePoses:s=new Set([0]),onFocusBindingSite:l,onResetView:i,className:m="",...p}){console.log("🚀 Enhanced3DViewer: Initializing with:",{ligandSmiles:t,receptorPdbId:o,poses:r.length,selectedPose:n,visiblePoses:Array.from(s)});const w=a.useRef(null),u=a.useRef(null),[S,M]=a.useState(!0),[G,B]=a.useState(null),[C,v]=a.useState({protein:-1,ligand:-1}),[z,_]=a.useState("cartoon"),[T,F]=a.useState("stick"),[W,Q]=a.useState("spectrum"),[U,I]=a.useState("#1a1a1a"),[A,q]=a.useState(!1),[ie,O]=a.useState(!1),J=[{value:"cartoon",label:"Cartoon",description:"Secondary structure representation"},{value:"ribbon",label:"Ribbon",description:"Smooth ribbon through backbone"},{value:"backbone",label:"Backbone",description:"Backbone trace"},{value:"surface",label:"Surface",description:"Molecular surface"},{value:"wireframe",label:"Wireframe",description:"Wire model"}],k=[{value:"stick",label:"Stick",description:"Stick representation"},{value:"sphere",label:"Sphere",description:"Space-filling spheres"},{value:"ball-stick",label:"Ball & Stick",description:"Combined spheres and sticks"},{value:"line",label:"Line",description:"Simple line representation"}],y=[{value:"spectrum",label:"Spectrum",description:"Rainbow colors by chain"},{value:"chainid",label:"Chain ID",description:"Different colors per chain"},{value:"element",label:"Element",description:"Color by atomic element"},{value:"hydrophobicity",label:"Hydrophobicity",description:"Hydrophobic/hydrophilic regions"},{value:"secondary",label:"Secondary Structure",description:"Color by secondary structure"}],b=[{value:"#1a1a1a",label:"Dark Gray",color:"#1a1a1a"},{value:"#000000",label:"Black",color:"#000000"},{value:"#ffffff",label:"White",color:"#ffffff"},{value:"#2c3e50",label:"Dark Blue",color:"#2c3e50"},{value:"#34495e",label:"Slate",color:"#34495e"}];a.useEffect(()=>!w.current||!t||!o?void 0:((async()=>{M(!0),B(null);try{if(typeof window.$3Dmol>"u")throw new Error("3Dmol.js library not loaded. Please ensure the script is included.");if(u.current)try{u.current.clear()}catch(x){console.warn("Error clearing existing viewer:",x)}const c=w.current;if(!c)throw new Error("Container not found");c.style.width="100%",c.style.height="500px",c.style.minHeight="500px",c.style.position="relative",c.style.backgroundColor=U,await new Promise(x=>setTimeout(x,100));const f={backgroundColor:U,antialias:!0,alpha:!0,preserveDrawingBuffer:!0};console.log("🎮 Creating 3Dmol viewer with config:",f);const $=window.$3Dmol.createViewer(c,f);if(!$)throw new Error("Failed to create 3Dmol viewer");u.current=$,console.log("✅ 3Dmol viewer created successfully");const h=await R($,o),E=ge(t);console.log(`🧬 Detected ${E.complexity} molecule:`,E),D(r);const j=await Me($,t,r,E);v({protein:h,ligand:j[0],ligandPoses:j}),ve($,h,j),await $e($),M(!1),console.log("🎉 Enhanced3DViewer initialization complete"),setTimeout(()=>{ee()},2e3)}catch(c){console.error("❌ Enhanced3DViewer initialization failed:",c),B(c.message),M(!1)}})(),()=>{if(u.current)try{u.current.clear(),u.current=null}catch(c){console.warn("Error during cleanup:",c)}}),[t,o]),a.useEffect(()=>{if(u.current&&C.protein>=0&&r.length>0){console.log("🔄 Updating visualization for pose changes:",{selectedPose:n,visiblePoses:Array.from(s)});try{ce(u.current,r,C.ligandPoses||[]);const d=V(u.current,r,C.ligandPoses||[],C.protein);d.overallValid||(console.warn("⚠️ SCIENTIFIC ACCURACY WARNING: Results may not be publication-ready"),console.warn("🔧 Issues found:",d.issues))}catch(d){console.error("❌ Position verification error:",d)}ve(u.current,C.protein,C.ligandPoses||[C.ligand]),$e(u.current)}},[n,s,C,r]),a.useEffect(()=>{u.current&&C.protein>=0&&(ve(u.current,C.protein,C.ligandPoses||[C.ligand]),$e(u.current))},[z,T,W,A,ie,C]),a.useEffect(()=>{u.current&&(u.current.setBackgroundColor(U),u.current.render()),w.current&&(w.current.style.backgroundColor=U)},[U]);const R=async(d,c)=>{try{console.log(`🧬 Loading protein ${c}...`);const f=`https://files.rcsb.org/download/${c.toUpperCase()}.pdb`,$=await fetch(f);if(!$.ok)throw new Error(`Failed to fetch protein ${c}: ${$.statusText}`);const h=await $.text();d.addModel(h,"pdb");const E=0;return setTimeout(()=>{try{const j=N(d,E,{center_x:0,center_y:0,center_z:0});if(j){console.log(`📊 Protein center: (${j.x.toFixed(2)}, ${j.y.toFixed(2)}, ${j.z.toFixed(2)})`);const x=Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z);console.log(`📏 Protein distance from origin: ${x.toFixed(2)} Å`),window.proteinCenterCache={x:j.x,y:j.y,z:j.z,distanceFromOrigin:x},x>50?(console.warn("⚠️ COORDINATE SYSTEM ISSUE: Protein center far from origin"),console.warn("🔧 This may cause ligand-protein separation in visualization"),console.warn("💡 Applying automatic coordinate alignment...")):console.log("✅ Protein coordinates are reasonable, no alignment needed")}}catch(j){console.warn("⚠️ Could not analyze protein coordinates:",j)}},100),console.log(`✅ Protein ${c} loaded successfully`),0}catch(f){throw console.error("❌ Error loading protein:",f),f}},g=async(d,c)=>{try{console.log(`💊 Loading ligand from SMILES: ${c}`);try{const f=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:c})});if(f.ok){const $=await f.json();if($.sdf_content)return d.addModel($.sdf_content,"sdf"),console.log("✅ Ligand loaded from backend"),1}}catch(f){console.warn("Backend ligand preparation failed:",f)}return d.addModel(c,"smiles"),console.log("✅ Ligand loaded via SMILES fallback"),1}catch(f){throw console.error("❌ Error loading ligand:",f),f}},D=d=>{if(console.log("🧪 TESTING: Checking pose coordinate diversity..."),!d||d.length<2){console.warn("⚠️ TEST: Need at least 2 poses to test diversity");return}const c=d.map(h=>({mode:h.mode,x:h.center_x,y:h.center_y,z:h.center_z}));console.log("📊 Pose coordinates:"),c.forEach(h=>{var E,j,x;console.log(`  Pose ${h.mode}: (${(E=h.x)==null?void 0:E.toFixed(2)}, ${(j=h.y)==null?void 0:j.toFixed(2)}, ${(x=h.z)==null?void 0:x.toFixed(2)})`)});const f=c[0];if(c.every(h=>Math.abs(h.x-f.x)<.1&&Math.abs(h.y-f.y)<.1&&Math.abs(h.z-f.z)<.1))console.error("❌ CRITICAL: ALL POSES HAVE IDENTICAL COORDINATES!"),console.error("This explains why selecting different poses shows no position change"),console.error("The docking results may not contain proper pose coordinate data");else{console.log("✅ Poses have diverse coordinates - position changes should be visible");let h=0,E=0;for(let x=0;x<c.length;x++)for(let L=x+1;L<c.length;L++){const P=Math.sqrt(Math.pow(c[x].x-c[L].x,2)+Math.pow(c[x].y-c[L].y,2)+Math.pow(c[x].z-c[L].z,2));h+=P,E++}const j=h/E;console.log(`📏 Average distance between poses: ${j.toFixed(2)} Å`),j<2&&console.warn("⚠️ Poses are very close together - position changes may be subtle")}},N=(d,c,f)=>{var h,E,j;const $=[{name:"getAtomList",detect:()=>{const x=d.getAtomList({model:c});if(x&&x.length>0){let L=0,P=0,K=0;return x.forEach(Z=>{L+=Z.x||0,P+=Z.y||0,K+=Z.z||0}),{x:L/x.length,y:P/x.length,z:K/x.length,atomCount:x.length}}throw new Error("No atoms found")}},{name:"selectedAtoms",detect:()=>{const x=d.selectedAtoms({model:c});if(x&&x.length>0){let L=0,P=0,K=0;return x.forEach(Z=>{L+=Z.x||0,P+=Z.y||0,K+=Z.z||0}),{x:L/x.length,y:P/x.length,z:K/x.length,atomCount:x.length}}throw new Error("No selected atoms found")}},{name:"modelCenter",detect:()=>{const x=d.getModel(c);if(x&&typeof x.getCenter=="function"){const L=x.getCenter();return{x:L.x,y:L.y,z:L.z,atomCount:"unknown"}}throw new Error("Model center not available")}},{name:"embeddedCoordinates",detect:()=>{if(f.center_x!==void 0&&f.center_y!==void 0&&f.center_z!==void 0)return{x:f.center_x,y:f.center_y,z:f.center_z,atomCount:"fallback"};throw new Error("No embedded coordinates")}}];for(const x of $)try{const L=x.detect();return console.log(`📍 ${x.name}: Position (${(h=L.x)==null?void 0:h.toFixed(2)}, ${(E=L.y)==null?void 0:E.toFixed(2)}, ${(j=L.z)==null?void 0:j.toFixed(2)}) from ${L.atomCount} atoms`),L}catch(L){console.warn(`⚠️ ${x.name} failed: ${L.message}`)}return console.error(`❌ All position detection methods failed for model ${c}`),null},V=(d,c,f,$)=>{try{console.log("🔬 SCIENTIFIC VALIDATION: Checking molecular docking accuracy...");const h={positionAccuracy:!1,proximityValidation:!1,contactValidation:!1,overallValid:!1,issues:[]};let E=0;const j=2;for(let P=0;P<c.length&&P<f.length;P++){const K=c[P],Z=f[P],re=N(d,Z,K);if(re){let Y=K.center_x||0,te=K.center_y||0,se=K.center_z||0;const ye=window.proteinCenterCache||null;ye&&ye.distanceFromOrigin>50&&Math.sqrt(Y*Y+te*te+se*se)<20&&(Y+=ye.x,te+=ye.y,se+=ye.z,console.log(`🔄 Applied coordinate alignment: (${Y.toFixed(2)}, ${te.toFixed(2)}, ${se.toFixed(2)})`));const de={x:Y,y:te,z:se},ue={x:re.x,y:re.y,z:re.z},fe=Math.sqrt(Math.pow(de.x-ue.x,2)+Math.pow(de.y-ue.y,2)+Math.pow(de.z-ue.z,2));fe<=j&&E++,console.log(`🧪 Pose ${K.mode}: Position alignment accuracy = ${fe.toFixed(2)} Å ${fe<=j?"✅":"❌"}`),console.log(`   Expected (aligned): (${de.x.toFixed(2)}, ${de.y.toFixed(2)}, ${de.z.toFixed(2)})`),console.log(`   Detected: (${ue.x.toFixed(2)}, ${ue.y.toFixed(2)}, ${ue.z.toFixed(2)})`)}}h.positionAccuracy=E>=c.length*.8,console.log(`📊 Position accuracy: ${E}/${c.length} poses within ${j} Å tolerance`);const x=oe(d,c,f,$);h.proximityValidation=x.valid,h.issues.push(...x.issues),x.averageDistance>100&&(console.warn(`⚠️ COORDINATE SYSTEM MISMATCH DETECTED: Average distance ${x.averageDistance.toFixed(1)} Å`),console.warn("🔧 This indicates protein and ligand coordinate systems are misaligned"),console.warn("💡 Automatic alignment attempted but may need backend fixes"),h.issues.push(`Coordinate system mismatch - average distance ${x.averageDistance.toFixed(1)} Å`));const L=H(d,c,f,$);return h.contactValidation=L.valid,h.issues.push(...L.issues),h.overallValid=h.positionAccuracy&&h.proximityValidation&&h.contactValidation,h.overallValid?console.log("🎉 SCIENTIFIC VALIDATION PASSED: Results are scientifically accurate"):console.error("❌ SCIENTIFIC VALIDATION FAILED:",h.issues),h}catch(h){return console.error("❌ Scientific validation error:",h),{overallValid:!1,issues:["Validation system error"]}}},oe=(d,c,f,$)=>{try{console.log("🔍 Proximity validation: Checking ligand-protein distances...");const h={valid:!0,issues:[],distances:[]},E=20,j=.5;let x=null;try{const P=N(d,$,{center_x:0,center_y:0,center_z:0});P&&(x={x:P.x,y:P.y,z:P.z},console.log(`🧬 Protein center: (${x.x.toFixed(2)}, ${x.y.toFixed(2)}, ${x.z.toFixed(2)})`))}catch(P){console.warn("⚠️ Could not determine protein position:",P)}if(!x)return h.issues.push("Cannot determine protein position for proximity validation"),h;for(let P=0;P<c.length&&P<f.length;P++){const K=c[P],Z=f[P],re=N(d,Z,K);if(re){const Y=Math.sqrt(Math.pow(x.x-re.x,2)+Math.pow(x.y-re.y,2)+Math.pow(x.z-re.z,2));h.distances.push({pose:K.mode,distance:Y}),Y>E?(h.valid=!1,h.issues.push(`Pose ${K.mode}: Too far from protein (${Y.toFixed(1)} Å > ${E} Å)`)):Y<j&&(h.valid=!1,h.issues.push(`Pose ${K.mode}: Too close to protein (${Y.toFixed(1)} Å < ${j} Å)`)),console.log(`📏 Pose ${K.mode}: Distance to protein = ${Y.toFixed(2)} Å ${Y<=E&&Y>=j?"✅":"❌"}`)}}const L=h.distances.reduce((P,K)=>P+K.distance,0)/h.distances.length;return console.log(`📊 Average ligand-protein distance: ${L.toFixed(2)} Å`),L>10&&h.issues.push(`Average distance too large (${L.toFixed(1)} Å) - poor docking quality`),h.averageDistance=L,h}catch(h){return console.error("❌ Proximity validation error:",h),{valid:!1,issues:["Proximity validation failed"]}}},H=(d,c,f,$)=>{try{console.log("🤝 Contact validation: Checking for realistic molecular interactions...");const h={valid:!0,issues:[],contactCounts:[]},E=5;for(let L=0;L<c.length&&L<f.length;L++){const P=c[L],K=Math.max(Math.abs(P.center_x||0),Math.abs(P.center_y||0),Math.abs(P.center_z||0));K>25&&h.issues.push(`Pose ${P.mode}: Coordinates too far from expected binding region (${K.toFixed(1)} Å)`),h.contactCounts.push({pose:P.mode,score:K})}const j=new Set;c.forEach(L=>{const P=`${Math.round(L.center_x||0)},${Math.round(L.center_y||0)},${Math.round(L.center_z||0)}`;j.add(P)});const x=j.size/c.length;return console.log(`📊 Pose diversity: ${j.size}/${c.length} unique positions (${(x*100).toFixed(1)}%)`),x<.7&&h.issues.push(`Low pose diversity (${(x*100).toFixed(1)}%) - poses may be too similar`),h.valid=h.issues.length===0,h}catch(h){return console.error("❌ Contact validation error:",h),{valid:!1,issues:["Contact validation failed"]}}},ce=(d,c,f)=>{try{if(console.log("🧪 TESTING: Verifying pose positions..."),!f||f.length===0){console.warn("⚠️ TEST: No model indices to verify");return}const $=[];c.forEach((E,j)=>{var L,P,K,Z,re,Y;const x=f[j];if(x!==void 0)try{if(d.getModel(x)){let se=null;se=N(d,x,E);let ye=E.center_x||0,de=E.center_y||0,ue=E.center_z||0;const fe=window.proteinCenterCache||null;fe&&fe.distanceFromOrigin>50&&Math.sqrt(ye*ye+de*de+ue*ue)<20&&(ye+=fe.x,de+=fe.y,ue+=fe.z);const xe={x:ye,y:de,z:ue},Se=Math.sqrt(Math.pow(se.x-xe.x,2)+Math.pow(se.y-xe.y,2)+Math.pow(se.z-xe.z,2)),X={pose:E.mode,modelIndex:x,expected:xe,actual:se,distance:Se,match:Se<5};$.push(X),console.log(`🔍 TEST Pose ${E.mode}:`),console.log(`  Expected (aligned): (${(L=xe.x)==null?void 0:L.toFixed(2)}, ${(P=xe.y)==null?void 0:P.toFixed(2)}, ${(K=xe.z)==null?void 0:K.toFixed(2)})`),console.log(`  Actual: ${se?`(${(Z=se.x)==null?void 0:Z.toFixed(2)}, ${(re=se.y)==null?void 0:re.toFixed(2)}, ${(Y=se.z)==null?void 0:Y.toFixed(2)})`:"Unknown"}`),console.log(`  Distance: ${Se.toFixed(2)} Å`),console.log(`  Position Match: ${X.match?"✅":"❌"}`)}}catch(te){console.error(`❌ TEST: Error verifying pose ${E.mode}:`,te)}});const h=$.filter(E=>E.match).length;return console.log(`📊 TEST SUMMARY: ${h}/${$.length} poses positioned correctly`),h===0&&$.length>0&&(console.error("❌ CRITICAL: NO POSES ARE POSITIONED CORRECTLY!"),console.error("This indicates the translation/positioning system is not working")),$}catch($){console.error("❌ Error in pose position verification:",$)}},ge=d=>{try{console.log("🧬 Analyzing molecular complexity for:",d);const c={smiles:d,length:d.length,rings:(d.match(/[0-9]/g)||[]).length,branches:(d.match(/[\(\)]/g)||[]).length,charges:(d.match(/[\+\-]/g)||[]).length,complexity:"simple"};let f=0;return c.length>50&&(f+=2),c.rings>3&&(f+=2),c.branches>4&&(f+=2),c.charges>1&&(f+=2),d.includes("@")&&(f+=1),d.includes("[")&&(f+=1),f>=6?c.complexity="very_complex":f>=4?c.complexity="complex":f>=2&&(c.complexity="moderate"),console.log("📊 Molecular complexity analysis:",c),c}catch(c){return console.error("❌ Error analyzing molecular complexity:",c),{smiles:d,complexity:"unknown"}}},pe=d=>{try{console.log("🔍 Validating SDF structure...");const c=d.split(`
`),f={valid:!1,atomCount:0,bondCount:0,issues:[]};if(c.length<4)return f.issues.push("SDF too short - missing header or structure"),f;if(c[3]&&c[3].length>=6)try{f.atomCount=parseInt(c[3].substring(0,3).trim()),f.bondCount=parseInt(c[3].substring(3,6).trim())}catch{f.issues.push("Invalid counts line format")}else f.issues.push("Missing or invalid counts line");const $=4+f.atomCount;c.length<$&&f.issues.push(`Missing atom data - expected ${f.atomCount} atoms`);for(let h=4;h<4+f.atomCount&&h<c.length;h++){const E=c[h];if(E.length<30)f.issues.push(`Invalid atom line ${h-3}: too short`);else try{const j=parseFloat(E.substring(0,10)),x=parseFloat(E.substring(10,20)),L=parseFloat(E.substring(20,30));(isNaN(j)||isNaN(x)||isNaN(L))&&f.issues.push(`Invalid coordinates in atom line ${h-3}`)}catch{f.issues.push(`Coordinate parsing error in atom line ${h-3}`)}}return f.valid=f.issues.length===0,console.log("📋 SDF validation:",f),f}catch(c){return console.error("❌ Error validating SDF:",c),{valid:!1,issues:["Validation error: "+c.message]}}},Ce=(d,c)=>{try{if(console.log(`🔧 Embedding coordinates for pose ${c.mode}`),console.log(`🔧 Input coordinates: (${c.center_x}, ${c.center_y}, ${c.center_z})`),!c.center_x||!c.center_y||!c.center_z)return console.warn(`⚠️ Pose ${c.mode} missing coordinates, using original SDF`),console.warn(`⚠️ Coordinates check: x=${c.center_x}, y=${c.center_y}, z=${c.center_z}`),d;if(!d||d.trim().length===0)return console.error("❌ Original SDF is empty or null"),d;console.log(`📊 Original SDF length: ${d.length} characters`);const f=d.split(`
`),$=[];let h=0,E=0,j=-1;for(let X=0;X<f.length;X++)if(X===3){const me=f[X].trim();if(me.length>=6){h=parseInt(me.substring(0,3).trim()),E=parseInt(me.substring(3,6).trim()),j=X,console.log(`📊 SDF has ${h} atoms, ${E} bonds`);break}}if(h===0)return console.warn("⚠️ Could not parse SDF atom count, using original"),d;let x=0,L=0,P=0,K=0;for(let X=4;X<4+h&&X<f.length;X++){const me=f[X];if(me.length>=30)try{const we=parseFloat(me.substring(0,10).trim()),Le=parseFloat(me.substring(10,20).trim()),Re=parseFloat(me.substring(20,30).trim());!isNaN(we)&&!isNaN(Le)&&!isNaN(Re)&&(x+=we,L+=Le,P+=Re,K++)}catch{continue}}K>0&&(x/=K,L/=K,P/=K),console.log(`📊 Original centroid: (${x.toFixed(3)}, ${L.toFixed(3)}, ${P.toFixed(3)})`);let Z=c.center_x||0,re=c.center_y||0,Y=c.center_z||0;const te=window.proteinCenterCache||null,se=Math.sqrt(Z*Z+re*re+Y*Y),ye=se<20;te&&te.distanceFromOrigin>50&&ye?(console.log("🔄 Applying coordinate system alignment for small docking coordinates..."),console.log(`📊 Protein center: (${te.x.toFixed(2)}, ${te.y.toFixed(2)}, ${te.z.toFixed(2)})`),console.log(`📊 Original pose coordinates magnitude: ${se.toFixed(2)} Å (seems origin-relative)`),Z+=te.x,re+=te.y,Y+=te.z,console.log(`🎯 Aligned target position: (${Z.toFixed(2)}, ${re.toFixed(2)}, ${Y.toFixed(2)})`)):te&&te.distanceFromOrigin>50?(console.log("🚫 SKIPPING coordinate alignment - pose coordinates seem already in protein coordinate system"),console.log(`📊 Pose coordinates magnitude: ${se.toFixed(2)} Å (seems protein-relative)`),console.log(`📊 Using original target position: (${Z.toFixed(2)}, ${re.toFixed(2)}, ${Y.toFixed(2)})`)):console.log("🔄 No coordinate alignment needed - protein near origin");const de=Z-x,ue=re-L,fe=Y-P;console.log(`📍 Target position: (${Z.toFixed(2)}, ${re.toFixed(2)}, ${Y.toFixed(2)})`),console.log(`🔄 Translation vector: (${de.toFixed(3)}, ${ue.toFixed(3)}, ${fe.toFixed(3)})`);for(let X=0;X<Math.min(4,f.length);X++)$.push(f[X]);let xe=0;for(let X=4;X<4+h&&X<f.length;X++){const me=f[X];if(me.length>=30)try{const we=parseFloat(me.substring(0,10).trim()),Le=parseFloat(me.substring(10,20).trim()),Re=parseFloat(me.substring(20,30).trim()),Ze=we+de,Ye=Le+ue,Xe=Re+fe,Gt=Ze.toFixed(4).padStart(10)+Ye.toFixed(4).padStart(10)+Xe.toFixed(4).padStart(10)+me.substring(30);$.push(Gt),xe++,xe===1&&(console.log("📊 First atom transformation:"),console.log(`   Original: (${we.toFixed(3)}, ${Le.toFixed(3)}, ${Re.toFixed(3)})`),console.log(`   New:      (${Ze.toFixed(3)}, ${Ye.toFixed(3)}, ${Xe.toFixed(3)})`),console.log(`   Delta:    (${(Ze-we).toFixed(3)}, ${(Ye-Le).toFixed(3)}, ${(Xe-Re).toFixed(3)})`))}catch(we){console.warn(`⚠️ Could not parse atom line ${X}, keeping original: ${we}`),$.push(me)}else console.warn(`⚠️ Atom line ${X} too short (${me.length} chars), keeping original`),$.push(me)}for(let X=4+h;X<f.length;X++)$.push(f[X]);const Se=$.join(`
`);return Se===d?(console.error("❌ CRITICAL: SDF was not actually modified despite processing!"),console.error(`📊 Original length: ${d.length}, Modified length: ${Se.length}`),console.error(`📊 Atom count: ${h}, Atoms processed: ${xe}`),console.error(`📊 Translation magnitude: ${Math.sqrt(de*de+ue*ue+fe*fe).toFixed(3)}`)):(console.log(`✅ Successfully embedded coordinates for pose ${c.mode}`),console.log(`📊 Modified ${xe} atoms with translation magnitude: ${Math.sqrt(de*de+ue*ue+fe*fe).toFixed(3)} Å`)),Se}catch(f){return console.error(`❌ Error embedding coordinates for pose ${c.mode}:`,f),d}},Me=async(d,c,f,$=null)=>{try{if(console.log(`💊 Loading ${f.length} pose models for SMILES: ${c}`),!f||f.length===0)return console.warn("⚠️ No poses available, loading single ligand"),[await g(d,c)];let h=null;try{console.log(`🔗 FETCH: Requesting SDF for ligand: ${t}`);const j=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:t})});if(console.log(`🔗 FETCH: Response status: ${j.status}`),j.ok){const x=await j.json();if(console.log("🔗 FETCH: Response data keys:",Object.keys(x)),x.sdf_content&&(h=x.sdf_content,console.log("✅ Base ligand SDF obtained from backend"),console.log(`📊 SDF length: ${h.length} characters`),$&&$.complexity!=="simple")){const L=pe(h);L.valid?console.log(`✅ SDF validation passed: ${L.atomCount} atoms, ${L.bondCount} bonds`):(console.warn("⚠️ SDF validation issues detected:",L.issues),console.warn("🔧 This may cause visualization problems with complex molecules"))}}}catch(j){console.error("❌ Error fetching ligand SDF:",j),console.error("🔗 Fetch error details:",j.message)}h?console.log("✅ SDF content is available for pose embedding"):(console.error("🚨 CRITICAL: No SDF content available - will use SMILES fallback"),console.error("🚨 This explains why pose positioning is failing!"));const E=[];for(let j=0;j<f.length;j++){const x=f[j];try{if(h)try{console.log(`🔧 Processing pose ${x.mode} with coordinates: (${x.center_x}, ${x.center_y}, ${x.center_z})`);const L=Ce(h,x);if(L===h)console.warn(`⚠️ SDF was not modified for pose ${x.mode} - using original`);else{console.log(`✅ SDF successfully modified for pose ${x.mode}`);const K=h.split(`
`),Z=L.split(`
`);K.length>6&&Z.length>6&&(console.log(`📊 Original atom line:  ${K[4]}`),console.log(`📊 Modified atom line:  ${Z[4]}`))}d.addModel(L,"sdf",{doAssembly:!1});const P=j+1;console.log(`✅ Pose ${x.mode} loaded as model ${P}`),E.push(P)}catch(L){console.error(`❌ Failed to embed coordinates for pose ${x.mode}:`,L),d.addModel(h,"sdf",{doAssembly:!1}),E.push(j+1)}else d.addModel(c,"smiles"),E.push(j+1),console.warn(`⚠️ Using SMILES fallback for pose ${x.mode}`)}catch(L){console.error(`❌ Failed to load pose ${x.mode}:`,L)}}return console.log(`🎯 Successfully loaded ${E.length} pose models`),E}catch(h){return console.error("❌ Error loading multiple pose models:",h),[await g(d,c)]}},ve=(d,c,f)=>{try{if(console.log(`🎨 Applying visualization styles - Protein: ${z}, Ligand: ${T}, Colors: ${W}`),console.log(`🎯 Pose info - Selected: ${n}, Visible: [${Array.from(s).join(", ")}]`),d.setStyle({},{}),d.removeAllSurfaces(),d.removeAllLabels(),c>=0){const $=Ge(z,W);if(d.setStyle({model:c},$),console.log("✅ Protein styling applied"),A)try{d.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.2,color:"lightblue"},{model:c}),console.log("✅ Protein surface added")}catch(h){console.warn("⚠️ Could not add protein surface:",h)}}if(f&&f.length>0&&r.length>0){console.log("🎨 TESTING: Styling poses..."),console.log(`📊 Selected pose: ${n}, Visible poses: [${Array.from(s).join(", ")}]`);let $=0,h=0;r.forEach((E,j)=>{var K,Z,re;const x=f[j],L=s.has(j),P=j===n;if(x!==void 0&&x>=0)if(L){const Y=Ie(T,P,j);if(d.setStyle({model:x},Y),$++,console.log(`🔍 TEST: Pose ${E.mode} (model ${x})`),console.log(`  Status: VISIBLE, Selected: ${P}`),console.log(`  Expected position: (${(K=E.center_x)==null?void 0:K.toFixed(2)}, ${(Z=E.center_y)==null?void 0:Z.toFixed(2)}, ${(re=E.center_z)==null?void 0:re.toFixed(2)})`),console.log(`  Style applied: ${JSON.stringify(Y)}`),ie)try{const te={x:E.center_x||0,y:E.center_y||0,z:E.center_z||0},se=P?`Pose ${E.mode} (${E.affinity} kcal/mol) - SELECTED`:`Pose ${E.mode} (${E.affinity} kcal/mol)`;d.addLabel(se,{position:te,fontSize:P?14:12,fontColor:P?"yellow":"white",backgroundColor:P?"red":"black",backgroundOpacity:P?.9:.7}),console.log(`✅ Label added for pose ${E.mode} at (${te.x}, ${te.y}, ${te.z})`)}catch(te){console.warn(`⚠️ Could not add label for pose ${E.mode}:`,te)}}else d.setStyle({model:x},{}),h++,console.log(`🙈 TEST: Pose ${E.mode} (model ${x}) HIDDEN`);else console.error(`❌ TEST: Invalid model index for pose ${E.mode}: ${x}`)}),console.log(`📊 STYLING SUMMARY: ${$} visible, ${h} hidden poses`),$===0&&console.error("❌ CRITICAL: NO POSES ARE VISIBLE AFTER STYLING!")}else if(f&&f.length>0){const $=f[0];if($!==void 0&&$>=0){const h=Ie(T,!0,0);if(d.setStyle({model:$},h),console.log("✅ Single ligand model styled (fallback)"),ie)try{d.addLabel("Ligand",{position:{x:0,y:0,z:0},fontSize:12,fontColor:"yellow",backgroundColor:"black",backgroundOpacity:.7}),console.log("✅ Single ligand label added")}catch(E){console.warn("⚠️ Could not add ligand label:",E)}}}}catch($){console.error("❌ Error applying visualization style:",$)}},Ge=(d,c)=>{const f={};switch(d){case"cartoon":f.cartoon={color:c,opacity:.8,thickness:.4};break;case"ribbon":f.ribbon={color:c,opacity:.8,thickness:.4};break;case"backbone":f.line={color:c,opacity:.8,linewidth:3};break;case"surface":f.surface={color:c,opacity:.7};break;case"wireframe":f.line={color:c,opacity:.6,linewidth:1};break;default:f.cartoon={color:c,opacity:.8}}return f},Ie=(d,c=!0,f=0)=>{const $={};let h="greenCarbon",E=c?1:.6,j=c?1:.8;if(r.length>1){const x=["greenCarbon","redCarbon","blueCarbon","yellowCarbon","purpleCarbon","orangeCarbon"];h=x[f%x.length]}switch(d){case"stick":$.stick={colorscheme:h,radius:.3*j,opacity:E};break;case"sphere":$.sphere={colorscheme:h,radius:.4*j,opacity:E*.9};break;case"ball-stick":$.stick={colorscheme:h,radius:.2*j,opacity:E},$.sphere={colorscheme:h,radius:.3*j,opacity:E*.9};break;case"line":$.line={colorscheme:h,linewidth:3*j,opacity:E};break;default:$.stick={colorscheme:h,radius:.3*j,opacity:E}}return $},$e=async d=>{try{console.log("🎯 Starting viewer render..."),d.zoomTo(),d.center(),d.render(),await new Promise(c=>setTimeout(c,100)),d.render(),console.log("✅ Viewer rendering complete")}catch(c){throw console.error("❌ Viewer rendering failed:",c),c}},Be=()=>{u.current&&(console.log("🔄 Resetting view..."),u.current.zoomTo(),u.current.center(),u.current.render(),i&&i())},Ue=()=>{if(u.current&&r.length>0){console.log("🎯 Focusing on binding site...");const d=r[n];if(d){const c=C.ligandPoses?C.ligandPoses[n]:C.ligand;if(c!==void 0&&c>=0)console.log(`📍 Focusing on pose ${d.mode} (model ${c}) at binding site`),u.current.zoomTo({model:c},1e3),u.current.render(),console.log(`🎯 Camera focused on pose ${d.mode} at coordinates (${d.center_x}, ${d.center_y}, ${d.center_z})`);else if(d.center_x!==void 0&&d.center_y!==void 0&&d.center_z!==void 0){const f={x:d.center_x,y:d.center_y,z:d.center_z};console.log("📍 Centering on pose coordinates directly:",f),u.current.zoomTo({center:f,zoom:2}),u.current.render()}l&&l(d)}}else u.current&&C.ligand!==void 0&&C.ligand>=0&&(console.log("🎯 Focusing on ligand (no pose data)..."),u.current.zoomTo({model:C.ligand},1e3),u.current.render(),l&&l())},Ke=()=>{if(u.current)try{const d=u.current.pngURI(),c=document.createElement("a");c.download=`molecular-docking-${Date.now()}.png`,c.href=d,c.click()}catch(d){console.error("Error saving image:",d)}},ee=()=>{console.log("🤖 AUTOMATED TESTING: Running quality checks...");const d=[];if(r&&r.length>0){const c=r.map(j=>({x:j.center_x||0,y:j.center_y||0,z:j.center_z||0})),f=c.reduce((j,x)=>({x:j.x+x.x,y:j.y+x.y,z:j.z+x.z}),{x:0,y:0,z:0});f.x/=c.length,f.y/=c.length,f.z/=c.length;const $=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);$>50&&d.push(`⚠️ AUTOMATED TEST FAILURE: Average pose coordinates too far from origin (${$.toFixed(1)} Å) - may indicate coordinate system error`);const h=[];for(let j=0;j<c.length;j++)for(let x=j+1;x<c.length;x++){const L=c[j].x-c[x].x,P=c[j].y-c[x].y,K=c[j].z-c[x].z;h.push(Math.sqrt(L*L+P*P+K*K))}const E=h.reduce((j,x)=>j+x,0)/h.length;E<1&&d.push(`⚠️ AUTOMATED TEST FAILURE: Low pose diversity (avg distance ${E.toFixed(2)} Å) - poses too similar`)}d.length===0?console.log("✅ AUTOMATED TESTING: All quality checks passed"):(console.error(`❌ AUTOMATED TESTING: ${d.length} issues detected:`),d.forEach(c=>console.error(c)),console.error("🚨 RECOMMENDATION: Fix these issues before user testing"))},le=async()=>{console.log("🧪 BENCHMARK VALIDATION: Running quick validation check...");try{const d=await hr();d.passed?(console.log("✅ BENCHMARK VALIDATION: System accuracy verified against known complexes"),console.log(`📊 Validation score: ${(d.score*100).toFixed(1)}%`)):(console.warn("⚠️ BENCHMARK VALIDATION: System may need calibration"),console.warn(`📊 Reason: ${d.reason}`))}catch(d){console.warn(`⚠️ BENCHMARK VALIDATION: Could not run validation check - ${d.message}`)}};if(G)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Visualization Error"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:G}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Reload Page"})]});const he=()=>{console.log("🧪 COMPREHENSIVE MOLECULAR DOCKING TESTS"),console.log("=".repeat(50)),[{ligand:"Cholesterol",protein:"1CRN",expected:"Perfect"},{ligand:"Cholesterol",protein:"4R7D",expected:"Good"},{ligand:"Ionizable Lipid",protein:"1CRN",expected:"Working with warnings"},{ligand:"Ionizable Lipid",protein:"4R7D",expected:"Poor quality flagged"}].forEach((c,f)=>{console.log(`🔬 Test ${f+1}: ${c.ligand} + ${c.protein}`),console.log(`   Expected: ${c.expected}`),console.log("   Instructions: Test this combination and verify results match expectations")}),console.log(`
📋 VALIDATION CHECKLIST:`),console.log("✅ Position accuracy < 2.0 Å"),console.log("✅ Protein-ligand distance 2-15 Å"),console.log("✅ Pose diversity > 70%"),console.log("✅ No coordinate system mismatches"),console.log("✅ Scientific validation passes for publication-ready results")};return window.runComprehensiveTests=he,e.jsxs("div",{className:`space-y-4 ${m}`,children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Visualization Controls"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Protein Style"}),e.jsx("select",{value:z,onChange:d=>_(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:S,children:J.map(d=>e.jsx("option",{value:d.value,title:d.description,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ligand Style"}),e.jsx("select",{value:T,onChange:d=>F(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:S,children:k.map(d=>e.jsx("option",{value:d.value,title:d.description,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color Scheme"}),e.jsx("select",{value:W,onChange:d=>Q(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:S,children:y.map(d=>e.jsx("option",{value:d.value,title:d.description,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Background"}),e.jsx("div",{className:"flex space-x-1",children:b.map(d=>e.jsx("button",{onClick:()=>I(d.value),className:`w-8 h-8 rounded border-2 ${U===d.value?"border-blue-500":"border-gray-300"}`,style:{backgroundColor:d.color},title:d.label,disabled:S},d.value))})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-2 border-t border-gray-200",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:d=>q(d.target.checked),disabled:S,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{children:"Show Surface"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:d=>O(d.target.checked),disabled:S,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{children:"Show Labels"})]}),e.jsx("button",{onClick:Ue,disabled:S||r.length===0,className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700 disabled:opacity-50",children:"Focus Binding Site"}),e.jsx("button",{onClick:Be,disabled:S,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:"Reset View"}),e.jsx("button",{onClick:Ke,disabled:S,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:"Save Image"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[S&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),e.jsx("p",{className:"text-gray-700",children:"Loading molecular structures..."})]})}),e.jsx("div",{ref:w,className:"w-full h-[500px] min-h-[500px] relative",style:{backgroundColor:U}})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Protein: ",o.toUpperCase()," | Ligand: ",t.slice(0,50),t.length>50?"...":""]}),e.jsxs("p",{children:["Models loaded: Protein (",C.protein>=0?"✓":"✗","), Ligand (",C.ligand>=0?"✓":"✗",")"]}),r.length>0&&e.jsxs("p",{children:["Poses: ",r.length," total | Selected: ",n+1," | Visible: ",s.size]})]})]})}function xr({ligandSmiles:t,receptorPdbId:o,dockingResults:r,mode:n="3D",renderer:s="3Dmol.js",className:l=""}){const[i,m]=a.useState(0),[p,w]=a.useState(new Set([0])),[u,S]=a.useState("affinity"),[M,G]=a.useState(!0),[B,C]=a.useState(!1),[v,z]=a.useState(!0),_=a.useRef(null),T={affinity:{name:"Binding Affinity",getColor:(O,J,k)=>{const y=Math.abs(O.affinity),b=Math.max(...k.map(V=>Math.abs(V.affinity))),R=Math.min(...k.map(V=>Math.abs(V.affinity))),g=(y-R)/(b-R),D=Math.floor(255*g),N=Math.floor(255*(1-g));return`rgb(${D}, ${N}, 0)`},description:"Green = Better affinity, Red = Worse affinity"},rmsd:{name:"RMSD",getColor:(O,J,k)=>{const y=O.rmsd_lb,b=Math.max(...k.map(oe=>oe.rmsd_lb)),R=Math.min(...k.map(oe=>oe.rmsd_lb)),g=(y-R)/(b-R),D=Math.floor(255*g),N=Math.floor(255*g),V=Math.floor(255*(1-g));return`rgb(${D}, ${N}, ${V})`},description:"Blue = Low RMSD, Yellow = High RMSD"},rainbow:{name:"Pose Order",getColor:(O,J,k)=>`hsl(${J/k.length*300}, 70%, 50%)`,description:"Different colors for each pose"}},F=(r==null?void 0:r.poses)||[],W=[...F].sort((O,J)=>O.affinity-J.affinity),Q=O=>{m(O),w(new Set([O]))},U=O=>{const J=new Set(p);J.has(O)?J.delete(O):J.add(O),w(J)},I=()=>{w(new Set(F.map((O,J)=>J)))},A=()=>{w(new Set)},q=O=>{if(console.log("🎯 DockingVisualization: Focus on binding site requested",O),C(!0),F.length>0){const J=O||F[i];J&&console.log("📍 Focusing on pose:",J)}},ie=()=>{console.log("🔄 DockingVisualization: Reset camera view requested"),C(!1)};return e.jsx("div",{className:`docking-visualization ${l}`,children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"3D Molecular Visualization"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Viewer Mode:"}),e.jsx("button",{onClick:()=>z(!v),className:`px-3 py-1 text-sm rounded transition-colors ${v?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:v?"Enhanced":"Basic"})]})]}),e.jsxs("div",{ref:_,className:"w-full bg-black rounded-lg border-2 border-gray-300 relative overflow-hidden",children:[v?e.jsx(pr,{ligandSmiles:t,receptorPdbId:o,poses:F,selectedPose:i,visiblePoses:p,onFocusBindingSite:q,onResetView:ie,className:"w-full"},`enhanced-viewer-${t}-${o}`):e.jsx("div",{className:"h-96",children:e.jsx(ur,{ligandSmiles:t,receptorPdbId:o,className:"w-full h-full"},`basic-viewer-${t}-${o}`)}),!v&&e.jsxs("div",{className:"absolute bottom-4 left-4 bg-black bg-opacity-75 text-white rounded px-3 py-2 text-sm",children:[e.jsxs("div",{children:["Ligand: ",t||"N/A"]}),e.jsxs("div",{children:["Receptor: ",o||"N/A"]}),e.jsxs("div",{children:["Visible poses: ",p.size," of ",F.length]})]}),!v&&e.jsxs("div",{className:"absolute top-4 right-4 space-y-2",children:[e.jsx("button",{onClick:q,className:`px-3 py-1 text-xs rounded ${B?"bg-blue-600 text-white":"bg-white text-gray-700"} shadow`,children:"Focus Site"}),e.jsx("button",{onClick:ie,className:"block px-3 py-1 text-xs bg-white text-gray-700 rounded shadow",children:"Reset View"})]}),!v&&M&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-3 max-w-xs",children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Color Scheme: ",T[u].name]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:T[u].description}),e.jsx("div",{className:"flex items-center space-x-2 text-xs",children:e.jsx("button",{onClick:()=>G(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Poses"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:I,className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Show All"}),e.jsx("button",{onClick:A,className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"Hide All"})]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:W.map((O,J)=>{const k=F.findIndex(g=>g.mode===O.mode),y=i===k,b=p.has(k),R=T[u].getColor(O,k,F);return e.jsxs("div",{className:`flex items-center p-2 rounded border ${y?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full border mr-3",style:{backgroundColor:R}}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>Q(k),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Mode ",O.mode]}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[O.affinity," kcal/mol"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["RMSD: ",O.rmsd_lb," - ",O.rmsd_ub," Å"]})]}),e.jsx("button",{onClick:()=>U(k),className:`ml-2 px-2 py-1 text-xs rounded ${b?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:b?"👁️":"👁️‍🗨️"})]},O.mode)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Visualization"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color Scheme"}),e.jsx("select",{value:u,onChange:O=>S(O.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:Object.entries(T).map(([O,J])=>e.jsx("option",{value:O,children:J.name},O))})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:O=>G(O.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Show Legend"})]})}),!v&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Camera"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:q,className:"w-full px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Focus on Binding Site"}),e.jsx("button",{onClick:ie,className:"w-full px-3 py-2 text-sm bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reset View"})]})]}),(r==null?void 0:r.summary)&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Summary"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Best: ",r.summary.best_affinity," kcal/mol"]}),e.jsxs("div",{children:["Average: ",r.summary.mean_affinity," kcal/mol"]}),e.jsxs("div",{children:["Time: ",r.summary.calculation_time,"s"]})]})]})]})]})]})})}function yr({onAdvancedDocking:t,isLoading:o,disabled:r,currentParams:n,receptorPdbId:s}){var R;const[l,i]=a.useState(!1),[m,p]=a.useState(""),[w,u]=a.useState(""),[S,M]=a.useState(""),[G,B]=a.useState(""),[C,v]=a.useState([]),[z,_]=a.useState([]),[T,F]=a.useState(""),[W,Q]=a.useState(!1),[U,I]=a.useState(!1),[A,q]=a.useState({exhaustiveness:8,num_modes:9,energy_range:3,cpu_threads:1,seed:0,local_only:!1,randomize_only:!1});a.useEffect(()=>{ie()},[]),a.useEffect(()=>{s&&W&&O()},[s,W]);const ie=async()=>{try{const g=await fetch("/api/templates");if(g.ok){const D=await g.json();v(D.templates||[])}}catch(g){console.error("Failed to load templates:",g)}},O=async()=>{if(s)try{const g=await fetch(`/api/pockets/${s}`);if(g.ok){const D=await g.json();_(D.pockets||[])}}catch(g){console.error("Failed to load pockets:",g)}},J=g=>{B(g);const D=C.find(N=>N.template_id===g);D&&(q({...A,...D.default_params}),p(D.name),u(D.description),D.advanced_params&&(Q(D.advanced_params.use_pocket_detection||!1),I(D.advanced_params.use_gnina_rescoring||!1)))},k=g=>{F(g);const D=z.find(N=>N.pocket_id===g);if(D&&t){const N={...n,center_x:D.center_x,center_y:D.center_y,center_z:D.center_z,size_x:D.radius*2,size_y:D.radius*2,size_z:D.radius*2};t(N,!0)}},y=()=>{if(!t)return;const g={...n,...A,job_name:m,job_description:w,tags:S.split(",").map(D=>D.trim()).filter(D=>D),template_id:G,use_pocket_detection:W,use_gnina_rescoring:U};t(g,!1)},b=async()=>{if(s)try{const g=await fetch("/api/pockets/detect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:s})});if(g.ok){const D=await g.json();_(D.pockets||[])}else throw new Error("Failed to detect pockets")}catch(g){console.error("Pocket detection failed:",g)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Advanced Docking"}),e.jsx("button",{onClick:()=>i(!l),className:"text-sm text-blue-600 hover:text-blue-700",children:l?"Hide Advanced":"Show Advanced"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Job Name"}),e.jsx("input",{type:"text",value:m,onChange:g=>p(g.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"Optional job name",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:w,onChange:g=>u(g.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:2,placeholder:"Optional job description",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:S,onChange:g=>M(g.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., fragment, high-throughput, kinase",disabled:o})]})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Job Template"}),e.jsxs("select",{value:G,onChange:g=>J(g.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:o,children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),C.map(g=>e.jsxs("option",{value:g.template_id,children:[g.name," - ",g.description]},g.template_id))]}),G&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Used ",((R=C.find(g=>g.template_id===G))==null?void 0:R.usage_count)||0," times"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Advanced Features"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:g=>Q(g.target.checked),className:"mr-2",disabled:o}),e.jsxs("span",{className:"text-sm",children:["Use automatic pocket detection",e.jsx("span",{className:"text-gray-500 ml-1",children:"(fpocket algorithm)"})]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:g=>I(g.target.checked),className:"mr-2",disabled:o}),e.jsxs("span",{className:"text-sm",children:["Use GNINA rescoring",e.jsx("span",{className:"text-gray-500 ml-1",children:"(CNN-based scoring)"})]})]})]})]}),W&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Detected Pockets"}),e.jsx("button",{onClick:b,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",disabled:o||!s,children:"Detect Pockets"})]}),z.length>0?e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:z.map((g,D)=>e.jsxs("div",{className:`p-3 border rounded cursor-pointer ${T===g.pocket_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>k(g.pocket_id),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Pocket ",D+1]}),e.jsxs("span",{className:"text-sm text-green-600",children:["Druggability: ",(g.druggability_score*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Center: (",g.center_x.toFixed(1),", ",g.center_y.toFixed(1),", ",g.center_z.toFixed(1),") | Volume: ",g.volume.toFixed(0)," Ų"]})]},g.pocket_id))}):e.jsx("p",{className:"text-sm text-gray-500",children:s?'Click "Detect Pockets" to find binding sites':"Load a protein first to detect pockets"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Docking Parameters"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exhaustiveness"}),e.jsx("input",{type:"number",value:A.exhaustiveness,onChange:g=>q({...A,exhaustiveness:parseInt(g.target.value)}),min:"1",max:"32",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:o}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1-32, higher = more thorough"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Modes"}),e.jsx("input",{type:"number",value:A.num_modes,onChange:g=>q({...A,num_modes:parseInt(g.target.value)}),min:"1",max:"50",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:o}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Number of binding modes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Energy Range (kcal/mol)"}),e.jsx("input",{type:"number",value:A.energy_range,onChange:g=>q({...A,energy_range:parseFloat(g.target.value)}),min:"1",max:"10",step:"0.1",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:o}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum energy difference"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Random Seed"}),e.jsx("input",{type:"number",value:A.seed,onChange:g=>q({...A,seed:parseInt(g.target.value)}),min:"0",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:o}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"0 = random, >0 = reproducible"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:A.local_only,onChange:g=>q({...A,local_only:g.target.checked}),className:"mr-2",disabled:o}),e.jsx("span",{className:"text-sm",children:"Local search only (no global search)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:A.randomize_only,onChange:g=>q({...A,randomize_only:g.target.checked}),className:"mr-2",disabled:o}),e.jsx("span",{className:"text-sm",children:"Randomize ligand only (no docking)"})]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("button",{onClick:y,disabled:o||r,className:"w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:o?"Running Advanced Docking...":"Run Advanced Docking"}),(W||U)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 text-center",children:["Estimated time: ",U?"5-10":"3-6"," minutes",W&&" (includes pocket detection)"]})]})]})}const Ne="/api";class Pe{static async estimateBindingSite(o,r=null){const n=await fetch(`${Ne}/binding-site/estimate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:o,ligand_smiles:r})});if(!n.ok){const s=await n.text();throw new Error(`Failed to estimate binding site: ${s}`)}return n.json()}static async getProteinInfo(o){const r=await fetch(`${Ne}/pdb/${o}/info`);if(!r.ok){const n=await r.text();throw new Error(`Failed to get protein info: ${n}`)}return r.json()}static async prepareLigand(o){const r=await fetch(`${Ne}/ligand/prepare`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:o})});if(!r.ok){const n=await r.text();throw new Error(`Failed to prepare ligand: ${n}`)}return r.json()}static async prepareReceptor(o){const r=await fetch(`${Ne}/receptor/prepare`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:o})});if(!r.ok){const n=await r.text();throw new Error(`Failed to prepare receptor: ${n}`)}return r.json()}static async runDocking(o){const r=await fetch(`${Ne}/dock/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const n=await r.text();throw new Error(`Failed to start docking: ${n}`)}return r.json()}static async getDockingStatus(o){const r=await fetch(`${Ne}/dock/status/${o}`);if(!r.ok){const n=await r.text();throw new Error(`Failed to get docking status: ${n}`)}return r.json()}static async listDockingJobs(){const o=await fetch(`${Ne}/dock/jobs`);if(!o.ok){const r=await o.text();throw new Error(`Failed to list docking jobs: ${r}`)}return o.json()}static async pollDockingJob(o,r=null,n=2e3){return new Promise((s,l)=>{const i=setInterval(async()=>{try{const m=await this.getDockingStatus(o);r&&r(m),m.status==="completed"?(clearInterval(i),s(m)):(m.status==="failed"||m.status==="cancelled")&&(clearInterval(i),l(new Error(m.error_message||`Docking job ${m.status}`)))}catch(m){clearInterval(i),l(m)}},n);setTimeout(()=>{clearInterval(i),l(new Error("Docking job timeout"))},3e5)})}}class br{constructor(){this.lastHealthCheck=null,this.checkInterval=3e4}async checkBackendHealth(){try{const o=await fetch("/api/healthz",{method:"GET",headers:{"Content-Type":"application/json"},timeout:5e3}),r=o.ok,n={isConnected:r,timestamp:Date.now()};return r||(n.error=`Server responded with status ${o.status}: ${o.statusText}`),this.lastHealthCheck=n,n}catch(o){const r={isConnected:!1,timestamp:Date.now(),error:o.message||"Connection failed"};return this.lastHealthCheck=r,r}}getLastHealthCheck(){return this.lastHealthCheck}isLastCheckValid(){return this.lastHealthCheck?Date.now()-this.lastHealthCheck.timestamp<this.checkInterval:!1}startPeriodicChecks(o,r=this.checkInterval){this.stopPeriodicChecks(),this.periodicCheckTimer=setInterval(async()=>{const n=await this.checkBackendHealth();o&&o(n)},r)}stopPeriodicChecks(){this.periodicCheckTimer&&(clearInterval(this.periodicCheckTimer),this.periodicCheckTimer=null)}}function vr(){var ce,ge,pe,Ce,Me,ve,Ge,Ie,$e,Be,Ue,Ke;const[t,o]=a.useState(""),[r,n]=a.useState("3D"),[s,l]=a.useState("3Dmol.js"),[i,m]=a.useState(!1),[p,w]=a.useState(!1),[u,S]=a.useState(null),[M,G]=a.useState("1CRN"),[B,C]=a.useState(null),[v,z]=a.useState(!1),[_,T]=a.useState({center_x:0,center_y:0,center_z:0,size_x:20,size_y:20,size_z:20}),[F,W]=a.useState(null),[Q,U]=a.useState(null),[I,A]=a.useState(!1),[q,ie]=a.useState("ligand"),[O,J]=a.useState(!0),[k]=a.useState(()=>new br),y=a.useRef(null),b=a.useRef(null),R=a.useRef(null),g=a.useRef(null),D=a.useRef(null),N=a.useRef(null);a.useEffect(()=>{(async()=>{const le=await k.checkBackendHealth();J(le.isConnected),le.isConnected?ne.dismiss("backend-connection-error"):ne.error("Backend server is not responding. Please ensure the Django server is running on port 8000.",{duration:6e3,id:"backend-connection-error"})})()},[k]);const V=async()=>{if(!M||M.length!==4){ne.error("Please enter a valid 4-character PDB ID");return}if(!(await k.checkBackendHealth()).isConnected){J(!1),ne.error("Cannot connect to backend server. Please ensure the Django server is running on port 8000.",{duration:8e3,id:"backend-connection-error"});return}J(!0),A(!0);try{const le=await Pe.getProteinInfo(M);C(le);const he=await Pe.estimateBindingSite(M,t||null);T(he),y.current&&(y.current.value=he.center_x),b.current&&(b.current.value=he.center_y),R.current&&(R.current.value=he.center_z),g.current&&(g.current.value=he.size_x),D.current&&(D.current.value=he.size_y),N.current&&(N.current.value=he.size_z),z(!0),ne.success(`Loaded protein ${M}: ${le.title||"Unknown"}`),ne.dismiss("backend-connection-error")}catch(le){console.error("Failed to load protein:",le),le.message.includes("Failed to fetch")||le.message.includes("ERR_CONNECTION_REFUSED")?(J(!1),ne.error("Backend server connection lost. Please restart the Django server on port 8000.",{duration:8e3,id:"backend-connection-error"})):ne.error(`Failed to load protein: ${le.message}`)}finally{A(!1)}},oe=async()=>{var le,he,d,c,f,$;if(!t){ne.error("Please enter a SMILES string for the ligand");return}if(!v){ne.error("Please load a protein first");return}const ee={ligand_smiles:t,receptor_pdb_id:M,center_x:parseFloat(((le=y.current)==null?void 0:le.value)||0),center_y:parseFloat(((he=b.current)==null?void 0:he.value)||0),center_z:parseFloat(((d=R.current)==null?void 0:d.value)||0),size_x:parseFloat(((c=g.current)==null?void 0:c.value)||20),size_y:parseFloat(((f=D.current)==null?void 0:f.value)||20),size_z:parseFloat((($=N.current)==null?void 0:$.value)||20),exhaustiveness:8,num_modes:9};A(!0),U(null);try{const h=await Pe.runDocking(ee);W(h),ne.success(`Docking job started: ${h.job_id}`);const E=await Pe.pollDockingJob(h.job_id,j=>{W(j),j.status==="running"&&ne.loading("Docking calculation in progress...",{id:"docking-progress"})});U(E.results),ie("docking"),ne.success("Docking completed successfully!",{id:"docking-progress"})}catch(h){console.error("Docking failed:",h),ne.error(`Docking failed: ${h.message}`,{id:"docking-progress"})}finally{A(!1)}},H=async(ee,le=!1)=>{var he,d,c,f,$,h;if(le){y.current&&(y.current.value=ee.center_x),b.current&&(b.current.value=ee.center_y),R.current&&(R.current.value=ee.center_z),g.current&&(g.current.value=ee.size_x),D.current&&(D.current.value=ee.size_y),N.current&&(N.current.value=ee.size_z);return}if(!t){ne.error("Please enter a SMILES string for the ligand");return}if(!v){ne.error("Please load a protein first");return}A(!0),U(null);try{const E=await fetch("/api/dock/advanced/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ligand_smiles:t,receptor_pdb_id:M,center_x:parseFloat(((he=y.current)==null?void 0:he.value)||0),center_y:parseFloat(((d=b.current)==null?void 0:d.value)||0),center_z:parseFloat(((c=R.current)==null?void 0:c.value)||0),size_x:parseFloat(((f=g.current)==null?void 0:f.value)||20),size_y:parseFloat((($=D.current)==null?void 0:$.value)||20),size_z:parseFloat(((h=N.current)==null?void 0:h.value)||20),...ee})});if(!E.ok)throw new Error(`Advanced docking failed: ${E.statusText}`);const j=await E.json();W(j),ne.success(`Advanced docking job started: ${j.job_name||j.job_id}`);const x=await Pe.pollDockingJob(j.job_id,L=>{W(L),L.status==="running"&&ne.loading("Advanced docking in progress...",{id:"advanced-docking-progress"})});U(x.results),ie("docking"),ne.success("Advanced docking completed successfully!",{id:"advanced-docking-progress"})}catch(E){console.error("Advanced docking failed:",E),ne.error(`Advanced docking failed: ${E.message}`,{id:"advanced-docking-progress"})}finally{A(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Docking"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Protein-Ligand docking with all Lipid Viewer capabilities"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${O?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:`text-sm ${O?"text-green-700":"text-red-700"}`,children:["Backend ",O?"Connected":"Disconnected"]})]}),e.jsx(It,{to:"/",className:"text-blue-600 hover:underline",children:"Back to Lipid Viewer"})]})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6 py-3",children:[e.jsx("button",{onClick:()=>ie("ligand"),className:`py-2 px-1 border-b-2 font-medium text-sm ${q==="ligand"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Ligand Viewer"}),e.jsxs("button",{onClick:()=>ie("docking"),className:`py-2 px-1 border-b-2 font-medium text-sm ${q==="docking"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,disabled:!Q,children:["Docking Results",Q&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[((ce=Q.poses)==null?void 0:ce.length)||0," poses"]})]}),e.jsxs("button",{onClick:()=>ie("advanced"),className:`py-2 px-1 border-b-2 font-medium text-sm ${q==="advanced"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Advanced",e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Expert"})]})]})}),e.jsxs("div",{className:"p-6",children:[q==="ligand"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Ligand Visualization"}),e.jsx(Pt,{onSubmit:ee=>{o(ee),w(!0)},onValidation:(ee,le)=>m(le),isValid:i}),e.jsx("div",{className:"mt-4",children:e.jsx(Ft,{mode:r,renderer:s,onModeChange:n,onRendererChange:l})}),t&&q==="ligand"&&e.jsx("div",{className:"mt-4",children:e.jsx(Vt,{smiles:t,mode:r,renderer:s,onExport:S},`ligand-viewer-${q}`)}),p&&e.jsx("div",{className:"mt-4",children:e.jsx(At,{mode:r,onZoomIn:()=>{},onZoomOut:()=>{},onResetView:()=>{},onExportPNG:()=>u==null?void 0:u.png(),onExportSVG:()=>u==null?void 0:u.svg(),onExportGLTF:()=>u==null?void 0:u.gltf(),isLoaded:p})})]}),q==="docking"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Docking Visualization"}),Q&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Best Score: ",(ge=Q.summary)==null?void 0:ge.best_affinity," kcal/mol"]})]}),Q&&q==="docking"?e.jsx(xr,{ligandSmiles:t,receptorPdbId:M,dockingResults:Q,mode:"3D",renderer:"3Dmol.js",className:"w-full"},`docking-viewer-${q}`):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"No Docking Results"}),e.jsx("div",{className:"text-sm",children:"Run a docking calculation to see results here"})]})]}),q==="advanced"&&e.jsx(yr,{onAdvancedDocking:H,isLoading:I,disabled:!t||!v,currentParams:{center_x:parseFloat(((pe=y.current)==null?void 0:pe.value)||0),center_y:parseFloat(((Ce=b.current)==null?void 0:Ce.value)||0),center_z:parseFloat(((Me=R.current)==null?void 0:Me.value)||0),size_x:parseFloat(((ve=g.current)==null?void 0:ve.value)||20),size_y:parseFloat(((Ge=D.current)==null?void 0:Ge.value)||20),size_z:parseFloat(((Ie=N.current)==null?void 0:Ie.value)||20)},receptorPdbId:M})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Protein Loader"}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PDB ID"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{value:M,onChange:ee=>G(ee.target.value.toUpperCase()),className:"flex-1 border rounded px-3 py-2",placeholder:"e.g., 1CRN",disabled:I}),e.jsx("button",{onClick:V,disabled:I,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:I?"Loading...":"Load"})]}),B&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 rounded",children:[e.jsx("p",{className:"text-sm text-green-800",children:e.jsx("strong",{children:B.title||"Unknown protein"})}),B.molecular_weight&&e.jsxs("p",{className:"text-xs text-green-600",children:["MW: ",B.molecular_weight," Da"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Backend: /api/pdb/","{pdbId}","/info"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Docking Controls"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center X"}),e.jsx("input",{ref:y,className:"w-full border rounded px-2 py-1",defaultValue:_.center_x,type:"number",step:"0.1",disabled:I})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center Y"}),e.jsx("input",{ref:b,className:"w-full border rounded px-2 py-1",defaultValue:_.center_y,type:"number",step:"0.1",disabled:I})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center Z"}),e.jsx("input",{ref:R,className:"w-full border rounded px-2 py-1",defaultValue:_.center_z,type:"number",step:"0.1",disabled:I})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size X"}),e.jsx("input",{ref:g,className:"w-full border rounded px-2 py-1",defaultValue:_.size_x,type:"number",step:"0.1",min:"1",disabled:I})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size Y"}),e.jsx("input",{ref:D,className:"w-full border rounded px-2 py-1",defaultValue:_.size_y,type:"number",step:"0.1",min:"1",disabled:I})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size Z"}),e.jsx("input",{ref:N,className:"w-full border rounded px-2 py-1",defaultValue:_.size_z,type:"number",step:"0.1",min:"1",disabled:I})]})]}),e.jsx("button",{onClick:oe,disabled:I||!v||!t,className:"mt-4 w-full px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:I?"Running...":"Run Docking"}),F&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:["Job: ",F.job_id?F.job_id.substring(0,8):"N/A","..."]}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Status: ",F.status]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Results"}),Q?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Summary"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Best Affinity: ",($e=Q.summary)==null?void 0:$e.best_affinity," kcal/mol"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Poses: ",(Be=Q.summary)==null?void 0:Be.num_poses]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Time: ",(Ue=Q.summary)==null?void 0:Ue.calculation_time,"s"]})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Top Poses"}),(Ke=Q.poses)==null?void 0:Ke.slice(0,5).map((ee,le)=>e.jsxs("div",{className:"p-2 border rounded mb-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Mode ",ee.mode]}),e.jsxs("span",{className:"text-green-600 font-bold",children:[ee.affinity," kcal/mol"]})]}),e.jsxs("div",{className:"text-gray-500 mt-1",children:["RMSD: ",ee.rmsd_lb," - ",ee.rmsd_ub," Å"]}),e.jsxs("div",{className:"text-gray-500",children:["Center: (",ee.center_x,", ",ee.center_y,", ",ee.center_z,")"]})]},le))]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"No results yet."})]})]})]})})]})}console.log("=== main.jsx: Starting React application ===");tt.createRoot(document.getElementById("root")).render(e.jsx(vt.StrictMode,{children:e.jsx(Yo,{children:e.jsxs(Uo,{children:[e.jsx(rt,{path:"/",element:e.jsx(dr,{})}),e.jsx(rt,{path:"/dock",element:e.jsx(vr,{})})]})})}));console.log("=== main.jsx: React application rendered ===");
