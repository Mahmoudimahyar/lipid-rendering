import{r as a,a as yt,R as vt,V as q,b as Xe,c as ne,O as wt}from"./vendor-CHqN6twT.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=o(s);fetch(s.href,l)}})();var Ye={exports:{}},Ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jt=a,kt=Symbol.for("react.element"),St=Symbol.for("react.fragment"),Nt=Object.prototype.hasOwnProperty,Ct=jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dt={key:!0,ref:!0,__self:!0,__source:!0};function Qe(t,r,o){var n,s={},l=null,i=null;o!==void 0&&(l=""+o),r.key!==void 0&&(l=""+r.key),r.ref!==void 0&&(i=r.ref);for(n in r)Nt.call(r,n)&&!Dt.hasOwnProperty(n)&&(s[n]=r[n]);if(t&&t.defaultProps)for(n in r=t.defaultProps,r)s[n]===void 0&&(s[n]=r[n]);return{$$typeof:kt,type:t,key:l,ref:i,props:s,_owner:Ct.current}}Ce.Fragment=St;Ce.jsx=Qe;Ce.jsxs=Qe;Ye.exports=Ce;var e=Ye.exports,Re={},Oe=yt;Re.createRoot=Oe.createRoot,Re.hydrateRoot=Oe.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function je(){return je=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},je.apply(this,arguments)}var de;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(de||(de={}));const Ge="popstate";function Et(t){t===void 0&&(t={});function r(n,s){let{pathname:l,search:i,hash:c}=n.location;return $e("",{pathname:l,search:i,hash:c},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function o(n,s){return typeof s=="string"?s:Ne(s)}return Lt(r,o,null,t)}function X(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function et(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function Mt(){return Math.random().toString(36).substr(2,8)}function Be(t,r){return{usr:t.state,key:t.key,idx:r}}function $e(t,r,o,n){return o===void 0&&(o=null),je({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof r=="string"?be(r):r,{state:o,key:r&&r.key||n||Mt()})}function Ne(t){let{pathname:r="/",search:o="",hash:n=""}=t;return o&&o!=="?"&&(r+=o.charAt(0)==="?"?o:"?"+o),n&&n!=="#"&&(r+=n.charAt(0)==="#"?n:"#"+n),r}function be(t){let r={};if(t){let o=t.indexOf("#");o>=0&&(r.hash=t.substr(o),t=t.substr(0,o));let n=t.indexOf("?");n>=0&&(r.search=t.substr(n),t=t.substr(0,n)),t&&(r.pathname=t)}return r}function Lt(t,r,o,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:l=!1}=n,i=s.history,c=de.Pop,m=null,x=d();x==null&&(x=0,i.replaceState(je({},i.state,{idx:x}),""));function d(){return(i.state||{idx:null}).idx}function y(){c=de.Pop;let h=d(),N=h==null?null:h-x;x=h,m&&m({action:c,location:b.location,delta:N})}function k(h,N){c=de.Push;let C=$e(b.location,h,N);x=d()+1;let E=Be(C,x),L=b.createHref(C);try{i.pushState(E,"",L)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(L)}l&&m&&m({action:c,location:b.location,delta:1})}function P(h,N){c=de.Replace;let C=$e(b.location,h,N);x=d();let E=Be(C,x),L=b.createHref(C);i.replaceState(E,"",L),l&&m&&m({action:c,location:b.location,delta:0})}function I(h){let N=s.location.origin!=="null"?s.location.origin:s.location.href,C=typeof h=="string"?h:Ne(h);return C=C.replace(/ $/,"%20"),X(N,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,N)}let b={get action(){return c},get location(){return t(s,i)},listen(h){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(Ge,y),m=h,()=>{s.removeEventListener(Ge,y),m=null}},createHref(h){return r(s,h)},createURL:I,encodeLocation(h){let N=I(h);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:k,replace:P,go(h){return i.go(h)}};return b}var Ue;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ue||(Ue={}));function Rt(t,r,o){return o===void 0&&(o="/"),$t(t,r,o)}function $t(t,r,o,n){let s=typeof r=="string"?be(r):r,l=Pe(s.pathname||"/",o);if(l==null)return null;let i=tt(t);_t(i);let c=null;for(let m=0;c==null&&m<i.length;++m){let x=Kt(l);c=Gt(i[m],x)}return c}function tt(t,r,o,n){r===void 0&&(r=[]),o===void 0&&(o=[]),n===void 0&&(n="");let s=(l,i,c)=>{let m={relativePath:c===void 0?l.path||"":c,caseSensitive:l.caseSensitive===!0,childrenIndex:i,route:l};m.relativePath.startsWith("/")&&(X(m.relativePath.startsWith(n),'Absolute route path "'+m.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),m.relativePath=m.relativePath.slice(n.length));let x=ue([n,m.relativePath]),d=o.concat(m);l.children&&l.children.length>0&&(X(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),tt(l.children,r,d,x)),!(l.path==null&&!l.index)&&r.push({path:x,score:At(x,l.index),routesMeta:d})};return t.forEach((l,i)=>{var c;if(l.path===""||!((c=l.path)!=null&&c.includes("?")))s(l,i);else for(let m of rt(l.path))s(l,i,m)}),r}function rt(t){let r=t.split("/");if(r.length===0)return[];let[o,...n]=r,s=o.endsWith("?"),l=o.replace(/\?$/,"");if(n.length===0)return s?[l,""]:[l];let i=rt(n.join("/")),c=[];return c.push(...i.map(m=>m===""?l:[l,m].join("/"))),s&&c.push(...i),c.map(m=>t.startsWith("/")&&m===""?"/":m)}function _t(t){t.sort((r,o)=>r.score!==o.score?o.score-r.score:Ot(r.routesMeta.map(n=>n.childrenIndex),o.routesMeta.map(n=>n.childrenIndex)))}const zt=/^:[\w-]+$/,Vt=3,Pt=2,It=1,Tt=10,Ft=-2,Ke=t=>t==="*";function At(t,r){let o=t.split("/"),n=o.length;return o.some(Ke)&&(n+=Ft),r&&(n+=Pt),o.filter(s=>!Ke(s)).reduce((s,l)=>s+(zt.test(l)?Vt:l===""?It:Tt),n)}function Ot(t,r){return t.length===r.length&&t.slice(0,-1).every((n,s)=>n===r[s])?t[t.length-1]-r[r.length-1]:0}function Gt(t,r,o){let{routesMeta:n}=t,s={},l="/",i=[];for(let c=0;c<n.length;++c){let m=n[c],x=c===n.length-1,d=l==="/"?r:r.slice(l.length)||"/",y=Bt({path:m.relativePath,caseSensitive:m.caseSensitive,end:x},d),k=m.route;if(!y)return null;Object.assign(s,y.params),i.push({params:s,pathname:ue([l,y.pathname]),pathnameBase:Zt(ue([l,y.pathnameBase])),route:k}),y.pathnameBase!=="/"&&(l=ue([l,y.pathnameBase]))}return i}function Bt(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[o,n]=Ut(t.path,t.caseSensitive,t.end),s=r.match(o);if(!s)return null;let l=s[0],i=l.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:n.reduce((x,d,y)=>{let{paramName:k,isOptional:P}=d;if(k==="*"){let b=c[y]||"";i=l.slice(0,l.length-b.length).replace(/(.)\/+$/,"$1")}const I=c[y];return P&&!I?x[k]=void 0:x[k]=(I||"").replace(/%2F/g,"/"),x},{}),pathname:l,pathnameBase:i,pattern:t}}function Ut(t,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0),et(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,m)=>(n.push({paramName:c,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,r?void 0:"i"),n]}function Kt(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return et(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),t}}function Pe(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let o=r.endsWith("/")?r.length-1:r.length,n=t.charAt(o);return n&&n!=="/"?null:t.slice(o)||"/"}function Wt(t,r){r===void 0&&(r="/");let{pathname:o,search:n="",hash:s=""}=typeof t=="string"?be(t):t;return{pathname:o?o.startsWith("/")?o:Ht(o,r):r,search:qt(n),hash:Xt(s)}}function Ht(t,r){let o=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?o.length>1&&o.pop():s!=="."&&o.push(s)}),o.length>1?o.join("/"):"/"}function Me(t,r,o,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Jt(t){return t.filter((r,o)=>o===0||r.route.path&&r.route.path.length>0)}function ot(t,r){let o=Jt(t);return r?o.map((n,s)=>s===o.length-1?n.pathname:n.pathnameBase):o.map(n=>n.pathnameBase)}function nt(t,r,o,n){n===void 0&&(n=!1);let s;typeof t=="string"?s=be(t):(s=je({},t),X(!s.pathname||!s.pathname.includes("?"),Me("?","pathname","search",s)),X(!s.pathname||!s.pathname.includes("#"),Me("#","pathname","hash",s)),X(!s.search||!s.search.includes("#"),Me("#","search","hash",s)));let l=t===""||s.pathname==="",i=l?"/":s.pathname,c;if(i==null)c=o;else{let y=r.length-1;if(!n&&i.startsWith("..")){let k=i.split("/");for(;k[0]==="..";)k.shift(),y-=1;s.pathname=k.join("/")}c=y>=0?r[y]:"/"}let m=Wt(s,c),x=i&&i!=="/"&&i.endsWith("/"),d=(l||i===".")&&o.endsWith("/");return!m.pathname.endsWith("/")&&(x||d)&&(m.pathname+="/"),m}const ue=t=>t.join("/").replace(/\/\/+/g,"/"),Zt=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),qt=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Xt=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Yt(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const st=["post","put","patch","delete"];new Set(st);const Qt=["get",...st];new Set(Qt);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ke(){return ke=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},ke.apply(this,arguments)}const Ie=a.createContext(null),er=a.createContext(null),he=a.createContext(null),De=a.createContext(null),pe=a.createContext({outlet:null,matches:[],isDataRoute:!1}),lt=a.createContext(null);function tr(t,r){let{relative:o}=r===void 0?{}:r;Se()||X(!1);let{basename:n,navigator:s}=a.useContext(he),{hash:l,pathname:i,search:c}=it(t,{relative:o}),m=i;return n!=="/"&&(m=i==="/"?n:ue([n,i])),s.createHref({pathname:m,search:c,hash:l})}function Se(){return a.useContext(De)!=null}function Ee(){return Se()||X(!1),a.useContext(De).location}function at(t){a.useContext(he).static||a.useLayoutEffect(t)}function rr(){let{isDataRoute:t}=a.useContext(pe);return t?hr():or()}function or(){Se()||X(!1);let t=a.useContext(Ie),{basename:r,future:o,navigator:n}=a.useContext(he),{matches:s}=a.useContext(pe),{pathname:l}=Ee(),i=JSON.stringify(ot(s,o.v7_relativeSplatPath)),c=a.useRef(!1);return at(()=>{c.current=!0}),a.useCallback(function(x,d){if(d===void 0&&(d={}),!c.current)return;if(typeof x=="number"){n.go(x);return}let y=nt(x,JSON.parse(i),l,d.relative==="path");t==null&&r!=="/"&&(y.pathname=y.pathname==="/"?r:ue([r,y.pathname])),(d.replace?n.replace:n.push)(y,d.state,d)},[r,n,i,l,t])}function it(t,r){let{relative:o}=r===void 0?{}:r,{future:n}=a.useContext(he),{matches:s}=a.useContext(pe),{pathname:l}=Ee(),i=JSON.stringify(ot(s,n.v7_relativeSplatPath));return a.useMemo(()=>nt(t,JSON.parse(i),l,o==="path"),[t,i,l,o])}function nr(t,r){return sr(t,r)}function sr(t,r,o,n){Se()||X(!1);let{navigator:s}=a.useContext(he),{matches:l}=a.useContext(pe),i=l[l.length-1],c=i?i.params:{};i&&i.pathname;let m=i?i.pathnameBase:"/";i&&i.route;let x=Ee(),d;if(r){var y;let h=typeof r=="string"?be(r):r;m==="/"||(y=h.pathname)!=null&&y.startsWith(m)||X(!1),d=h}else d=x;let k=d.pathname||"/",P=k;if(m!=="/"){let h=m.replace(/^\//,"").split("/");P="/"+k.replace(/^\//,"").split("/").slice(h.length).join("/")}let I=Rt(t,{pathname:P}),b=dr(I&&I.map(h=>Object.assign({},h,{params:Object.assign({},c,h.params),pathname:ue([m,s.encodeLocation?s.encodeLocation(h.pathname).pathname:h.pathname]),pathnameBase:h.pathnameBase==="/"?m:ue([m,s.encodeLocation?s.encodeLocation(h.pathnameBase).pathname:h.pathnameBase])})),l,o,n);return r&&b?a.createElement(De.Provider,{value:{location:ke({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:de.Pop}},b):b}function lr(){let t=gr(),r=Yt(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),o=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},r),o?a.createElement("pre",{style:s},o):null,null)}const ar=a.createElement(lr,null);class ir extends a.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,o){return o.location!==r.location||o.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:o.error,location:o.location,revalidation:r.revalidation||o.revalidation}}componentDidCatch(r,o){console.error("React Router caught the following error during render",r,o)}render(){return this.state.error!==void 0?a.createElement(pe.Provider,{value:this.props.routeContext},a.createElement(lt.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function cr(t){let{routeContext:r,match:o,children:n}=t,s=a.useContext(Ie);return s&&s.static&&s.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=o.route.id),a.createElement(pe.Provider,{value:r},n)}function dr(t,r,o,n){var s;if(r===void 0&&(r=[]),o===void 0&&(o=null),n===void 0&&(n=null),t==null){var l;if(!o)return null;if(o.errors)t=o.matches;else if((l=n)!=null&&l.v7_partialHydration&&r.length===0&&!o.initialized&&o.matches.length>0)t=o.matches;else return null}let i=t,c=(s=o)==null?void 0:s.errors;if(c!=null){let d=i.findIndex(y=>y.route.id&&(c==null?void 0:c[y.route.id])!==void 0);d>=0||X(!1),i=i.slice(0,Math.min(i.length,d+1))}let m=!1,x=-1;if(o&&n&&n.v7_partialHydration)for(let d=0;d<i.length;d++){let y=i[d];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(x=d),y.route.id){let{loaderData:k,errors:P}=o,I=y.route.loader&&k[y.route.id]===void 0&&(!P||P[y.route.id]===void 0);if(y.route.lazy||I){m=!0,x>=0?i=i.slice(0,x+1):i=[i[0]];break}}}return i.reduceRight((d,y,k)=>{let P,I=!1,b=null,h=null;o&&(P=c&&y.route.id?c[y.route.id]:void 0,b=y.route.errorElement||ar,m&&(x<0&&k===0?(pr("route-fallback"),I=!0,h=null):x===k&&(I=!0,h=y.route.hydrateFallbackElement||null)));let N=r.concat(i.slice(0,k+1)),C=()=>{let E;return P?E=b:I?E=h:y.route.Component?E=a.createElement(y.route.Component,null):y.route.element?E=y.route.element:E=d,a.createElement(cr,{match:y,routeContext:{outlet:d,matches:N,isDataRoute:o!=null},children:E})};return o&&(y.route.ErrorBoundary||y.route.errorElement||k===0)?a.createElement(ir,{location:o.location,revalidation:o.revalidation,component:b,error:P,children:C(),routeContext:{outlet:null,matches:N,isDataRoute:!0}}):C()},null)}var ct=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(ct||{}),dt=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(dt||{});function ur(t){let r=a.useContext(Ie);return r||X(!1),r}function mr(t){let r=a.useContext(er);return r||X(!1),r}function fr(t){let r=a.useContext(pe);return r||X(!1),r}function ut(t){let r=fr(),o=r.matches[r.matches.length-1];return o.route.id||X(!1),o.route.id}function gr(){var t;let r=a.useContext(lt),o=mr(),n=ut();return r!==void 0?r:(t=o.errors)==null?void 0:t[n]}function hr(){let{router:t}=ur(ct.UseNavigateStable),r=ut(dt.UseNavigateStable),o=a.useRef(!1);return at(()=>{o.current=!0}),a.useCallback(function(s,l){l===void 0&&(l={}),o.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,ke({fromRouteId:r},l)))},[t,r])}const We={};function pr(t,r,o){We[t]||(We[t]=!0)}function xr(t,r){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function _e(t){X(!1)}function br(t){let{basename:r="/",children:o=null,location:n,navigationType:s=de.Pop,navigator:l,static:i=!1,future:c}=t;Se()&&X(!1);let m=r.replace(/^\/*/,"/"),x=a.useMemo(()=>({basename:m,navigator:l,static:i,future:ke({v7_relativeSplatPath:!1},c)}),[m,c,l,i]);typeof n=="string"&&(n=be(n));let{pathname:d="/",search:y="",hash:k="",state:P=null,key:I="default"}=n,b=a.useMemo(()=>{let h=Pe(d,m);return h==null?null:{location:{pathname:h,search:y,hash:k,state:P,key:I},navigationType:s}},[m,d,y,k,P,I,s]);return b==null?null:a.createElement(he.Provider,{value:x},a.createElement(De.Provider,{children:o,value:b}))}function yr(t){let{children:r,location:o}=t;return nr(ze(r),o)}new Promise(()=>{});function ze(t,r){r===void 0&&(r=[]);let o=[];return a.Children.forEach(t,(n,s)=>{if(!a.isValidElement(n))return;let l=[...r,s];if(n.type===a.Fragment){o.push.apply(o,ze(n.props.children,l));return}n.type!==_e&&X(!1),!n.props.index||!n.props.children||X(!1);let i={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=ze(n.props.children,l)),o.push(i)}),o}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ve(){return Ve=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},Ve.apply(this,arguments)}function vr(t,r){if(t==null)return{};var o={},n=Object.keys(t),s,l;for(l=0;l<n.length;l++)s=n[l],!(r.indexOf(s)>=0)&&(o[s]=t[s]);return o}function wr(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function jr(t,r){return t.button===0&&(!r||r==="_self")&&!wr(t)}const kr=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Sr="6";try{window.__reactRouterVersion=Sr}catch{}const Nr="startTransition",He=vt[Nr];function Cr(t){let{basename:r,children:o,future:n,window:s}=t,l=a.useRef();l.current==null&&(l.current=Et({window:s,v5Compat:!0}));let i=l.current,[c,m]=a.useState({action:i.action,location:i.location}),{v7_startTransition:x}=n||{},d=a.useCallback(y=>{x&&He?He(()=>m(y)):m(y)},[m,x]);return a.useLayoutEffect(()=>i.listen(d),[i,d]),a.useEffect(()=>xr(n),[n]),a.createElement(br,{basename:r,children:o,location:c.location,navigationType:c.action,navigator:i,future:n})}const Dr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Er=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mt=a.forwardRef(function(r,o){let{onClick:n,relative:s,reloadDocument:l,replace:i,state:c,target:m,to:x,preventScrollReset:d,viewTransition:y}=r,k=vr(r,kr),{basename:P}=a.useContext(he),I,b=!1;if(typeof x=="string"&&Er.test(x)&&(I=x,Dr))try{let E=new URL(window.location.href),L=x.startsWith("//")?new URL(E.protocol+x):new URL(x),O=Pe(L.pathname,P);L.origin===E.origin&&O!=null?x=O+L.search+L.hash:b=!0}catch{}let h=tr(x,{relative:s}),N=Mr(x,{replace:i,state:c,target:m,preventScrollReset:d,relative:s,viewTransition:y});function C(E){n&&n(E),E.defaultPrevented||N(E)}return a.createElement("a",Ve({},k,{href:I||h,onClick:b||l?n:C,ref:o,target:m}))});var Je;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Je||(Je={}));var Ze;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Ze||(Ze={}));function Mr(t,r){let{target:o,replace:n,state:s,preventScrollReset:l,relative:i,viewTransition:c}=r===void 0?{}:r,m=rr(),x=Ee(),d=it(t,{relative:i});return a.useCallback(y=>{if(jr(y,o)){y.preventDefault();let k=n!==void 0?n:Ne(x)===Ne(d);m(t,{replace:k,state:s,preventScrollReset:l,relative:i,viewTransition:c})}},[x,m,d,n,s,o,t,l,i,c])}let xe=null,ve=null;const ft=async()=>xe||ve||(ve=(async()=>{try{if(window.RDKit&&window.RDKit.get_mol)return xe=window.RDKit,xe;if(!window.initRDKitModule){const t=["https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js","https://cdn.jsdelivr.net/npm/@rdkit/rdkit/dist/RDKit_minimal.js","https://unpkg.com/@rdkit/rdkit@2024.3.1/dist/RDKit_minimal.js"];let r=!1;for(const o of t)try{console.log(`Attempting to load RDKit from: ${o}`);const n=document.createElement("script");n.src=o,n.crossOrigin="anonymous",document.head.appendChild(n),await new Promise((s,l)=>{n.onload=()=>{console.log(`Successfully loaded RDKit from: ${o}`),s()},n.onerror=i=>{console.warn(`Failed to load RDKit from ${o}:`,i),l(i)},setTimeout(()=>l(new Error("RDKit loading timeout")),5e3)}),r=!0;break}catch{console.warn(`Failed to load from ${o}, trying next...`);continue}if(!r)throw new Error("All RDKit CDN sources failed to load")}if(window.initRDKitModule)return console.log("Initializing RDKit module..."),xe=await window.initRDKitModule(),console.log("RDKit initialized successfully"),xe;throw new Error("RDKit module not available after script load")}catch(t){return console.warn("RDKit initialization failed:",t),ve=null,null}})(),ve),Lr=async t=>{if(typeof t!="string")return{isValid:!1,error:"Invalid input: SMILES must be a non-empty string"};const r=t.trim();if(!r)return{isValid:!1,error:"Invalid input: SMILES cannot be empty"};const o=$r(r);try{console.log("Attempting RDKit validation for:",r);const n=await ft();if(n){console.log("RDKit available, performing advanced validation");const s=n.get_mol(r);if(s){const l=s.is_valid();return s.delete(),console.log("RDKit validation result:",l),{isValid:l,error:l?null:"Invalid SMILES structure (RDKit validation failed)",method:"RDKit"}}else return console.warn("RDKit could not parse molecule, falling back to basic validation"),{isValid:o.isValid,error:o.isValid?null:"Invalid SMILES structure (RDKit could not parse)",method:"basic"}}else return console.warn("RDKit not available, using basic validation"),{isValid:o.isValid,error:o.isValid?null:o.error,method:"basic"}}catch(n){return console.warn("RDKit validation failed, falling back to basic validation:",n),{isValid:o.isValid,error:o.isValid?null:`Validation error: ${n.message}`,method:"basic"}}},Rr=async t=>{var r,o,n,s,l;try{const i=await ft();if(!i)return null;console.log("generateMolecule3D: Starting 3D generation for SMILES:",t.substring(0,50)+"...");const c=i.get_mol(t);if(!c)return console.warn("generateMolecule3D: Failed to create molecule from SMILES"),null;console.log("generateMolecule3D: Molecule created successfully");let m;try{const d=i.get_mol(t,JSON.stringify({removeHs:!1,sanitize:!0}));if(d){console.log("generateMolecule3D: Added hydrogens to molecule");try{if(typeof d.addHs=="function"&&(d.addHs(),console.log("generateMolecule3D: Added hydrogens using addHs()")),typeof d.generate_aligned_coords=="function")d.generate_aligned_coords(c,!0,!0,!1),console.log("generateMolecule3D: Generated 3D coordinates using generate_aligned_coords");else if(typeof d.get_new_coords=="function")d.get_new_coords(!0)&&console.log("generateMolecule3D: Generated 3D coordinates using get_new_coords");else if(typeof i.get_mol_copy=="function"){const y=i.get_mol_copy(d);y&&(console.log("generateMolecule3D: Created 3D molecule copy"),(r=d.delete)==null||r.call(d),m=y)}m||(m=d,console.log("generateMolecule3D: Using molecule with hydrogens (attempting 3D coordinates)"))}catch(y){console.warn("generateMolecule3D: 3D coordinate generation failed, using molecule with hydrogens:",y),m=d}}else console.warn("generateMolecule3D: Failed to add hydrogens, using original molecule"),m=c}catch(d){console.warn("generateMolecule3D: 3D molecule processing failed, using original molecule:",d),m=c}if(!m)return(o=c.delete)==null||o.call(c),null;let x;try{if(x=m.get_molblock(),x){m!==c&&(x=x.replace("     RDKit          2D","     RDKit          3D"),console.log("generateMolecule3D: Updated molblock header to indicate 3D coordinates"));const d={molblock:x,smiles:t,mol:m,has3D:m!==c,atomCount:((n=x.split(`
`)[3])==null?void 0:n.trim().split(/\s+/)[0])||"unknown"};return console.log("generateMolecule3D: Successfully generated molecule data"),d}}catch(d){console.error("generateMolecule3D: Failed to generate molblock:",d)}return(s=c.delete)==null||s.call(c),(l=m.delete)==null||l.call(m),null}catch(i){return console.warn("3D molecule generation error:",i),null}},$r=t=>{if(!t||typeof t!="string")return{isValid:!1,error:"SMILES must be a non-empty string"};const r=t.trim();if(r.length===0)return{isValid:!1,error:"SMILES cannot be empty"};if(!/^[A-Za-z0-9()\[\]@+\-=#$:/\\%*.]+$/.test(r))return{isValid:!1,error:"SMILES contains invalid characters"};if(r.length<1)return{isValid:!1,error:"SMILES too short"};const n=(r.match(/\(/g)||[]).length,s=(r.match(/\)/g)||[]).length,l=(r.match(/\[/g)||[]).length,i=(r.match(/\]/g)||[]).length;return n!==s?{isValid:!1,error:"Unmatched parentheses in SMILES"}:l!==i?{isValid:!1,error:"Unmatched brackets in SMILES"}:{isValid:!0,error:null}},_r=[{name:"Ethanol",smiles:"CCO"},{name:"Benzene",smiles:"c1ccccc1"},{name:"Caffeine",smiles:"CN1C=NC2=C1C(=O)N(C(=O)N2C)C"},{name:"Aspirin",smiles:"CC(=O)OC1=CC=CC=C1C(=O)O"},{name:"Cholesterol",smiles:"CC(C)CCCC(C)C1CCC2C1(CCC3C2CC=C4C3(CCC(C4)O)C)C"}],gt=({onSubmit:t,onValidation:r,isValid:o=null})=>{const[n,s]=a.useState(""),[l,i]=a.useState(!1),[c,m]=a.useState(null),[x,d]=a.useState(!1),[y,k]=a.useState("");a.useEffect(()=>{const N=setTimeout(async()=>{if(n.trim()){i(!0),k("");try{const C=await Lr(n.trim());d(C.isValid),m(C.isValid),C.isValid?(k(`Valid SMILES (${C.method||"basic"} validation)`),q.success(`Molecule loaded: ${n.trim()}`)):(k(C.error||"Invalid SMILES string"),q.error("Invalid SMILES string")),r&&r(n.trim(),C.isValid)}catch(C){console.error("Validation error:",C),d(!1),m(!1),k("Validation failed"),q.error("Validation failed"),r&&r(n.trim(),!1)}finally{i(!1)}}else d(!1),m(null),k(""),r&&r("",!1)},500);return()=>clearTimeout(N)},[n,r]);const P=h=>{h.preventDefault(),n.trim()&&x&&t(n.trim())},I=h=>{s(h)},b=o!==null?o:x;return e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Enter SMILES String"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:n,onChange:h=>s(h.target.value),placeholder:"Enter SMILES string (e.g., CCO for ethanol)",className:`w-full px-4 py-3 text-lg border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${n&&b===!1?"border-red-400 bg-red-50":n&&b===!0?"border-green-400 bg-green-50":"border-gray-300"}`,autoComplete:"off",spellCheck:"false"}),l&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})}),n&&!l&&b!==null&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:b?e.jsx("svg",{className:"h-5 w-5 text-green-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-5 w-5 text-red-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),y&&e.jsx("p",{className:`text-sm ${x?"text-green-600":"text-red-600"}`,children:y}),e.jsx("button",{type:"submit",disabled:!n.trim()||!x||l,className:"control-button w-full py-3 text-lg font-semibold",children:l?"Validating...":"Visualize Molecule"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Try examples:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_r.map(h=>e.jsx("button",{onClick:()=>I(h.smiles),className:"px-3 py-2 bg-gray-100 hover:bg-blue-100 text-gray-700 rounded-md transition-colors text-sm font-medium",children:h.name},h.name))})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-600",children:e.jsxs("p",{children:[e.jsx("strong",{children:"SMILES"})," (Simplified Molecular Input Line Entry System) is a notation for describing chemical structures. Examples: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"CCO"})," (ethanol),",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"c1ccccc1"})," (benzene)."]})})]})},zr=[{id:"SmilesDrawer",name:"SmilesDrawer",description:"Fast client-side 2D rendering"},{id:"RDKit.js",name:"RDKit.js",description:"High-quality chemical structures"},{id:"Kekule.js",name:"Kekule.js",description:"Comprehensive cheminformatics"}],Vr=[{id:"3Dmol.js",name:"3Dmol.js",description:"WebGL molecular visualization"},{id:"Mol*",name:"Mol*",description:"High-performance 3D viewer"},{id:"NGL",name:"NGL",description:"Interactive protein structures"}],ht=({mode:t,renderer:r,onModeChange:o,onRendererChange:n})=>{const s=t==="2D"?zr:Vr;return e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Visualization Mode"}),e.jsxs("div",{className:"flex space-x-2 mb-6",children:[e.jsx("button",{onClick:()=>o("2D"),className:`px-6 py-3 rounded-lg font-semibold transition-colors ${t==="2D"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"2D View"}),e.jsx("button",{onClick:()=>o("3D"),className:`px-6 py-3 rounded-lg font-semibold transition-colors ${t==="3D"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"3D View"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:t==="2D"?"2D Renderer":"3D Renderer"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.map(l=>e.jsxs("button",{onClick:()=>n(l.id),className:`p-4 rounded-lg border-2 text-left transition-colors ${r===l.id?"border-blue-500 bg-blue-100":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-1",children:l.name}),e.jsx("div",{className:"text-sm text-gray-600",children:l.description})]},l.id))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:t==="2D"?"2D Visualization Features":"3D Visualization Features"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:t==="2D"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"‚Ä¢ Fast rendering and interaction"}),e.jsx("li",{children:"‚Ä¢ Export to PNG and SVG formats"}),e.jsx("li",{children:"‚Ä¢ Chemical structure validation"}),e.jsx("li",{children:"‚Ä¢ Customizable styling options"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"‚Ä¢ Interactive 3D molecule rotation"}),e.jsx("li",{children:"‚Ä¢ Multiple rendering styles (stick, ball & stick, surface)"}),e.jsx("li",{children:"‚Ä¢ Export to GLB format for 3D printing"}),e.jsx("li",{children:"‚Ä¢ Real-time conformer generation"})]})})]})]})},Te=(t,r,o=!1)=>{let s=(typeof t=="string"?t:"").replace(/[^A-Za-z0-9._-]/g,"_");if(o){const l=Date.now();s=`${s}_${l}`}return`${s}.${r}`},Fe=(t,r)=>{let o="";try{typeof URL.createObjectURL=="function"&&(o=URL.createObjectURL(t))}catch{o=""}const n=document.createElement("a");n.href=o||"#",n.download=r||"",n.style.display="none",document.body.appendChild(n);try{n.click()}finally{document.body.removeChild(n)}o&&typeof URL.revokeObjectURL=="function"&&setTimeout(()=>URL.revokeObjectURL(o),100)},qe=async(t,r,o)=>{if(!t||typeof t.toBlob!="function")return!1;try{return new Promise(n=>{t.toBlob(s=>{if(s){const l=Te(r,"png",!0);Fe(s,l),n(!0)}else n(!1)},"image/png",o)})}catch(n){return console.error("PNG export error:",n),!1}},Pr=async(t,r)=>{if(!t)return!1;try{let o;typeof t=="string"?o=t:o=new XMLSerializer().serializeToString(t);const n=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
${o}`,s=new Blob([n],{type:"image/svg+xml"}),l=Te(r,"svg",!1);return Fe(s,l),!0}catch(o){return console.error("SVG export error:",o),!1}},Ir=async(t,r)=>{try{const o=new Blob([t],{type:"model/gltf+json"}),n=Te(r,"gltf",!0);return Fe(o,n),!0}catch(o){return console.error("GLTF export error:",o),!1}},Le=async()=>{try{if(window.RDKit&&window.RDKit.get_mol)return window.RDKit;if(!window.initRDKitModule){const t=["https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js","https://cdn.jsdelivr.net/npm/@rdkit/rdkit/dist/RDKit_minimal.js","https://unpkg.com/@rdkit/rdkit@2024.3.1/dist/RDKit_minimal.js"];let r=!1;for(const o of t)try{console.log(`MoleculeViewer: Attempting to load RDKit from: ${o}`);const n=document.createElement("script");n.src=o,n.crossOrigin="anonymous",document.head.appendChild(n),await new Promise((s,l)=>{n.onload=()=>{console.log(`MoleculeViewer: Successfully loaded RDKit from: ${o}`),s()},n.onerror=i=>{console.warn(`MoleculeViewer: Failed to load RDKit from ${o}:`,i),document.head.removeChild(n),l(i)},setTimeout(()=>{n.parentNode&&document.head.removeChild(n),l(new Error("RDKit loading timeout"))},5e3)}),r=!0;break}catch{console.warn(`MoleculeViewer: Failed to load from ${o}, trying next...`);continue}if(!r)return console.warn("MoleculeViewer: All RDKit CDN sources failed, will use fallback renderer"),null}if(window.initRDKitModule){console.log("MoleculeViewer: Initializing RDKit module...");const t=await window.initRDKitModule();return console.log("MoleculeViewer: RDKit initialized successfully"),t}return console.warn("MoleculeViewer: RDKit module not available after script load"),null}catch(t){return console.warn("MoleculeViewer: RDKit initialization failed:",t),null}},Tr=()=>({SmilesDrawer:!0,RDKit:!0,RDKitjs:!0,Kekule:!0,Kekulejs:!0,"3Dmol":!0,"3Dmoljs":!0,NGL:!0,Molstar:!0,SimpleSVG:!0}),pt=Xe.forwardRef(({smiles:t,mode:r,renderer:o,onExport:n},s)=>{const l=a.useRef(null),i=a.useRef(null),c=a.useRef(!0),[m,x]=a.useState(!0),[d,y]=a.useState(null),[k,P]=a.useState(null),[I,b]=a.useState(""),[h]=a.useState(Tr());console.log("=== MoleculeViewer: Component rendered ==="),console.log("Props received:",{smiles:(t==null?void 0:t.substring(0,50))+"...",mode:r,renderer:o}),console.log("Current state:",{isLoading:m,hasError:!!d,hasSvgContent:!!I});const N=a.useCallback(()=>{if(console.log("=== MoleculeViewer: cleanupViewer called ==="),i.current){try{const p=i.current;switch(p.type){case"3dmol":if(p.viewer&&typeof p.viewer.clear=="function")try{p.viewer.clear(),console.log("3Dmol viewer cleared successfully")}catch(f){console.warn("Error clearing 3Dmol viewer:",f)}if(p.element&&p.element.parentNode)try{p.element.innerHTML="",console.log("3Dmol container cleared")}catch(f){console.warn("Error clearing 3Dmol container:",f)}break;case"ngl":if(p.stage&&typeof p.stage.dispose=="function")try{p.stage.dispose(),console.log("NGL stage disposed successfully")}catch(f){console.warn("Error disposing NGL stage:",f)}if(p.element&&p.element.parentNode)try{p.element.innerHTML="",console.log("NGL container cleared")}catch(f){console.warn("Error clearing NGL container:",f)}break;case"molstar":if(p.plugin&&typeof p.plugin.dispose=="function")try{p.plugin.dispose(),console.log("Molstar plugin disposed successfully")}catch(f){console.warn("Error disposing Molstar plugin:",f)}if(p.element&&p.element.parentNode)try{p.element.innerHTML="",console.log("Molstar container cleared")}catch(f){console.warn("Error clearing Molstar container:",f)}break;default:typeof p.destroy=="function"?p.destroy():typeof p.dispose=="function"&&p.dispose()}}catch(p){console.warn("Error cleaning up viewer:",p)}i.current=null}c.current&&b("")},[]);a.useEffect(()=>(c.current=!0,()=>{console.log("=== MoleculeViewer: Component unmounting ==="),c.current=!1,N()}),[]);const C=a.useCallback(async p=>{console.log("=== MoleculeViewer: renderWithSimpleSVG called ==="),console.log("SMILES for SVG rendering:",p);try{console.log("Using Simple SVG fallback renderer for:",p);const f=Math.max(3,Math.min(p.length,12)),g=120;console.log("Creating molecule structure with",f,"atoms");const S=(w,R)=>R==="C"||R==="c"?"#2d3748":R==="O"||R==="o"?"#e53e3e":R==="N"||R==="n"?"#3182ce":R==="S"||R==="s"?"#d69e2e":w%2===0?"#4299e1":"#48bb78";let u="";for(let w=0;w<f;w++){const R=w/f*2*Math.PI,J=Math.cos(R)*g,A=Math.sin(R)*g,Q=p[w%p.length]||"C";if(w<f-1){const re=(w+1)/f*2*Math.PI,oe=Math.cos(re)*g,j=Math.sin(re)*g;u+=`<line x1="${J}" y1="${A}" x2="${oe}" y2="${j}" stroke="#4a5568" stroke-width="3" stroke-linecap="round" />`}u+=`<circle cx="${J}" cy="${A}" r="18" fill="${S(w,Q)}" stroke="#ffffff" stroke-width="2" />`,u+=`<text x="${J}" y="${A+5}" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff">${Q.toUpperCase()}</text>`}if(f>2&&/[0-9]/.test(p)){const R=(f-1)/f*2*Math.PI;u+=`<line x1="${Math.cos(0)*g}" y1="${Math.sin(0)*g}" x2="${Math.cos(R)*g}" y2="${Math.sin(R)*g}" stroke="#4a5568" stroke-width="3" stroke-linecap="round" />`,console.log("Ring closure added")}console.log("Molecule structure added to SVG");const v=`
        <svg width="800" height="600" viewBox="0 0 800 600" style="background-color: #f8fafc; border: 2px solid #e2e8f0; border-radius: 8px;">
          <defs>
            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
              <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f1f5f9" stroke-width="1"/>
            </pattern>
          </defs>
          <rect width="100%" height="100%" fill="url(#grid)"/>
          <g transform="translate(400, 300)">
            ${u}
          </g>
          <text x="400" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2d3748">Molecule: ${p}</text>
          <text x="400" y="560" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#718096">Simple SVG Renderer (Fallback)</text>
        </svg>
      `;return console.log("Setting SVG content via React state..."),c.current&&(b(v),i.current={svg:v,type:"svg"}),console.log("Simple SVG rendering completed successfully"),!0}catch(f){return console.error("Simple SVG renderer error:",f),!1}},[]),E=a.useCallback(()=>{if(!l.current)return{width:800,height:400};const p=l.current.getBoundingClientRect(),f=Math.max(p.width-40,400),g=Math.max(p.height-40,300);return{width:Math.min(f,900),height:Math.min(g,700)}},[]),L=a.useCallback(async p=>{console.log("=== MoleculeViewer: renderWithRDKit called ==="),console.log("SMILES for RDKit rendering:",p),console.log("Container ref available:",!!l.current);try{const f=await Le();if(!f)return console.warn("RDKit not available, using fallback"),!1;if(!c.current)return console.warn("Component unmounted during RDKit initialization"),!1;const g=f.get_mol(p);if(!g)return console.warn("Invalid molecule for RDKit"),!1;const{width:S,height:u}=E();console.log(`RDKit: Using responsive dimensions ${S}x${u}`);const w=g.get_svg(S,u).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%;"');return c.current&&(b(w),i.current={mol:g,svg:w,type:"svg"}),g.delete(),console.log("RDKit rendering completed successfully"),!0}catch(f){return console.error("RDKit error:",f),!1}},[E]),O=a.useCallback(async p=>{console.log("=== MoleculeViewer: renderWithSmilesDrawer called ===");try{const f=await Le();if(!f)return console.warn("RDKit not available for SmilesDrawer fallback"),!1;if(!c.current)return console.warn("Component unmounted during SmilesDrawer initialization"),!1;const g=f.get_mol(p);if(!g)return console.warn("Invalid molecule for SmilesDrawer"),!1;const{width:S,height:u}=E();console.log(`SmilesDrawer: Using responsive dimensions ${S}x${u}`);const w=g.get_svg(S,u).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: linear-gradient(45deg, #e0f2fe 0%, #b3e5fc 100%); border: 3px solid #0277bd; border-radius: 15px; padding: 20px; box-shadow: 0 8px 16px rgba(2, 119, 189, 0.3);"').replace(/stroke="#000000"/g,'stroke="#1565c0" stroke-width="3"').replace(/fill="#000000"/g,'fill="#0d47a1"');return c.current&&(b(w),i.current={mol:g,svg:w,type:"svg",renderer:"SmilesDrawer"}),g.delete(),console.log("SmilesDrawer rendering completed successfully"),!0}catch(f){return console.error("SmilesDrawer error:",f),!1}},[E]),H=a.useCallback(async p=>{console.log("=== MoleculeViewer: renderWithKekule called ===");try{const f=await Le();if(!f)return console.warn("RDKit not available for Kekule fallback"),!1;if(!c.current)return console.warn("Component unmounted during Kekule initialization"),!1;const g=f.get_mol(p);if(!g)return console.warn("Invalid molecule for Kekule"),!1;const{width:S,height:u}=E();console.log(`Kekule: Using responsive dimensions ${S}x${u}`);const w=g.get_svg(S,u).replace("<svg",'<svg preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border: 3px solid #8e24aa; border-radius: 20px; padding: 25px; box-shadow: 0 10px 20px rgba(142, 36, 170, 0.4);"').replace(/stroke="#000000"/g,'stroke="#6a1b9a" stroke-width="4"').replace(/fill="#000000"/g,'fill="#4a148c"').replace(/stroke-width="2"/g,'stroke-width="5"');return c.current&&(b(w),i.current={mol:g,svg:w,type:"svg",renderer:"Kekule.js"}),g.delete(),console.log("Kekule rendering completed successfully"),!0}catch(f){return console.error("Kekule error:",f),!1}},[E]),T=a.useCallback(async(p,f)=>{console.log("=== MoleculeViewer: renderWithMolstar called ===");try{if(!c.current)return console.warn("Component unmounted during Molstar initialization"),!1;const g=window.molstar||window.Molstar||window.MolstarViewer;if(!g){console.warn("Molstar not loaded, falling back to placeholder");const v=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">Mol* Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return c.current&&b(v),!1}const S=`molstar-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Molstar: Generated container ID:",S);const u=`<div id="${S}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("Molstar: Created container HTML:",u),c.current&&(b(u),setTimeout(async()=>{if(!c.current){console.log("Molstar: Component unmounted during timeout");return}console.log("Molstar: Looking for DOM element with ID:",S);const v=document.getElementById(S);if(console.log("Molstar: Found DOM element:",v),!v){console.error("Molstar container not found in DOM");return}try{console.log("Molstar: Creating plugin with element:",v),console.log("Molstar: Available API:",g),console.log("Molstar: API keys:",Object.keys(g||{}));let w;if(g.createPlugin)w=await g.createPlugin(v,{layoutIsExpanded:!1,layoutShowControls:!1,layoutShowRemoteState:!1,layoutShowSequence:!0,layoutShowLog:!1,layoutShowLeftPanel:!0,viewportShowExpand:!0,viewportShowSelectionMode:!1,viewportShowAnimation:!1,pdbProvider:"rcsb",emdbProvider:"rcsb"});else if(g.Viewer&&g.Viewer.create)w=await g.Viewer.create(v,{layoutIsExpanded:!1,layoutShowControls:!1});else if(g.create)w=await g.create(v,{layoutIsExpanded:!1,layoutShowControls:!1});else throw new Error("No valid Molstar API method found");if(console.log("Molstar: Plugin created successfully:",w),console.log("Molstar: Plugin methods:",Object.getOwnPropertyNames(w)),console.log("Molstar: Plugin prototype methods:",Object.getOwnPropertyNames(Object.getPrototypeOf(w))),f&&f.molblock){console.log("Molstar: Loading molecule from molblock SDF data"),console.log("Molstar: Molblock type:",typeof f.molblock),console.log("Molstar: Molblock length:",f.molblock.length);try{console.log("Molstar: Available plugin methods:",Object.keys(w)),w.dataTransaction&&typeof w.dataTransaction=="function"?(console.log("Molstar: Using dataTransaction method"),await R(w)):w.loadStructureFromData&&typeof w.loadStructureFromData=="function"?(console.log("Molstar: Using loadStructureFromData method"),await w.loadStructureFromData(f.molblock,"sdf",!1)):w.loadStructureFromString&&typeof w.loadStructureFromString=="function"?(console.log("Molstar: Using loadStructureFromString method"),await w.loadStructureFromString(f.molblock,"sdf")):w.load&&typeof w.load=="function"?(console.log("Molstar: Using load method"),await w.load({data:f.molblock,format:"sdf"})):(console.warn("Molstar: No known loading method found, falling back"),await J(w)),console.log("Molstar: Successfully loaded molecule from SDF data")}catch(A){console.error("Molstar: Error loading SDF data:",A),await J(w)}}else console.log("Molstar: No molblock found, trying SMILES fallback"),await J(w);async function R(A){const Q=new Blob([f.molblock],{type:"chemical/x-mdl-sdfile"}),re=URL.createObjectURL(Q);await A.dataTransaction(async()=>{const oe=await A.builders.data.download({url:re,isBinary:!1},{state:{isGhost:!1}}),j=await A.builders.structure.parseTrajectory(oe,"sdf"),M=await A.builders.structure.createModel(j),z=await A.builders.structure.createStructure(M);await A.builders.structure.representation.addRepresentation(z,{type:"ball-and-stick",colorTheme:{name:"element-symbol"},sizeTheme:{name:"physical"}}),await A.builders.structure.representation.addRepresentation(z,{type:"spacefill",colorTheme:{name:"element-symbol"},sizeTheme:{name:"physical"}})}),URL.revokeObjectURL(re),A.managers&&A.managers.camera&&A.managers.camera.focusLoci(A.managers.structure.hierarchy.current.structures)}async function J(A){try{console.log("Molstar: Creating SMILES information display");const Q=`
                  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 24px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; max-width: 500px;">
                      <div style="font-size: 3.5rem; margin-bottom: 20px; color: #60a5fa;">üß¨</div>
                      <h3 style="font-size: 1.8rem; margin-bottom: 16px; color: #f1f5f9; font-weight: bold;">Mol* Molecular Viewer</h3>
                      <p style="font-size: 1rem; margin-bottom: 20px; color: #cbd5e1; line-height: 1.5;">Advanced 3D molecular visualization powered by Molstar</p>
                      
                      <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                        <h4 style="color: #e2e8f0; margin-bottom: 12px; font-size: 1.1rem;">Molecular Information</h4>
                        <div style="font-family: monospace; font-size: 0.9rem; line-height: 1.6;">
                          <p style="margin: 8px 0; color: #f8fafc;"><strong>SMILES:</strong> <span style="color: #60a5fa;">${p}</span></p>
                          ${f&&f.molblock?'<p style="margin: 8px 0; color: #f8fafc;"><strong>Format:</strong> <span style="color: #34d399;">SDF/Molblock</span></p>':""}
                          ${f&&f.molblock?`<p style="margin: 8px 0; color: #f8fafc;"><strong>Lines:</strong> <span style="color: #fbbf24;">${f.molblock.split("\\n").length}</span></p>`:""}
                          ${f&&f.json&&f.json.atoms?`<p style="margin: 8px 0; color: #f8fafc;"><strong>Atoms:</strong> <span style="color: #f87171;">${f.json.atoms.length||"N/A"}</span></p>`:""}
                        </div>
                      </div>
                      
                      <div style="background: rgba(96, 165, 250, 0.1); padding: 16px; border-radius: 8px; border: 1px solid rgba(96, 165, 250, 0.2);">
                        <p style="font-size: 0.9rem; color: #93c5fd; margin: 0; line-height: 1.4;">
                          <strong>üîß Integration Status:</strong><br/>
                          Mol* plugin loaded successfully. Advanced 3D rendering features are being configured.
                        </p>
                      </div>
                      
                      <div style="margin-top: 16px; font-size: 0.8rem; color: #64748b;">
                        Plugin: <span style="color: #94a3b8;">${A.constructor.name||"Molstar"}</span> | 
                        API: <span style="color: #94a3b8;">${Object.keys(A).length} methods</span>
                      </div>
                    </div>
                  </div>
                `;c.current&&b(Q)}catch(Q){console.warn("Molstar: SMILES fallback failed:",Q)}}i.current={type:"molstar",plugin:w,element:v,renderer:"Mol*"},console.log("Molstar: 3D molecule rendered successfully")}catch(w){if(console.error("Molstar plugin creation error:",w),c.current){const R=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #64748b;">
                  <div style="text-align: center; padding: 20px; max-width: 400px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">üß¨</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px; color: #f1f5f9;">Mol* Viewer</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px; color: #cbd5e1;">Molecular Structure Information</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 16px; border-radius: 6px; font-family: monospace; margin-bottom: 16px;">
                      <p style="margin: 0; font-size: 0.9rem; color: #e2e8f0;">SMILES: ${p}</p>
                      ${f&&f.molblock?`<p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #94a3b8;">Molblock: ${f.molblock.split("\\n").length} lines</p>`:""}
                      ${f&&f.json&&f.json.atoms?`<p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #94a3b8;">Atoms: ${f.json.atoms.length||"N/A"}</p>`:""}
                    </div>
                    <p style="font-size: 0.8rem; color: #94a3b8;">Mol* integration in progress</p>
                    <p style="font-size: 0.75rem; color: #64748b; margin-top: 8px;">${w.message}</p>
                  </div>
                </div>
              `;b(R)}}},200)),console.log("Mol* rendering completed successfully"),!0}catch(g){if(console.error("Mol* error:",g),c.current){const S=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">Mol* Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize Mol*</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${g.message}</p>
              </div>
            </div>
          </div>
        `;b(S)}return!1}},[]),D=a.useCallback(async(p,f)=>{console.log("=== MoleculeViewer: renderWith3Dmol called ===");try{if(!c.current)return console.warn("Component unmounted during 3Dmol initialization"),!1;if(typeof window.$3Dmol>"u"){console.warn("3Dmol.js not loaded, falling back to placeholder");const u=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return c.current&&b(u),!1}const g=`mol3d-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("3Dmol: Generated container ID:",g);const S=`<div id="${g}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("3Dmol: Created container HTML:",S),c.current&&(b(S),setTimeout(()=>{if(!c.current){console.log("3Dmol: Component unmounted during timeout");return}console.log("3Dmol: Looking for DOM element with ID:",g);const u=document.getElementById(g);if(console.log("3Dmol: Found DOM element:",u),!u){console.error("3Dmol container not found in DOM");return}try{console.log("3Dmol: Creating viewer with element:",u);const v=window.$3Dmol.createViewer(u,{defaultcolors:window.$3Dmol.rasmolElementColors});console.log("3Dmol: Viewer created successfully:",v),f&&f.molblock?(console.log("3Dmol: Adding molecule from molblock SDF data"),console.log("3Dmol: Molblock type:",typeof f.molblock),console.log("3Dmol: Molblock length:",f.molblock.length),v.addModel(f.molblock,"sdf"),console.log("3Dmol: Successfully added molecule from SDF data")):f&&typeof f=="string"?(console.log("3Dmol: Adding molecule from string data"),v.addModel(f,"sdf"),console.log("3Dmol: Added molecule from string SDF data")):(console.log("3Dmol: No molblock found, trying SMILES fallback"),v.addModel(p,"smiles"),console.log("3Dmol: Added molecule from SMILES")),v.setStyle({},{stick:{radius:.15,colorscheme:"default"},sphere:{radius:.4,colorscheme:"default"}}),console.log("3Dmol: Applied molecular styling");const w=v.getModel(0).selectedAtoms({}).length;console.log("3Dmol: Number of atoms in model:",w),v.zoomTo(),v.center(),v.rotate(20,{x:1,y:0,z:0}),v.rotate(30,{x:0,y:1,z:0}),console.log("3Dmol: Applied view transformations"),v.render(),console.log("3Dmol: Initial render completed"),setTimeout(()=>{c.current&&v&&(v.render(),console.log("3Dmol: Secondary render completed"))},100),i.current={type:"3dmol",viewer:v,element:u,renderer:"3Dmol.js"};const R=u.querySelector("canvas");if(R){console.log("3Dmol: Canvas found:",R),console.log("3Dmol: Canvas dimensions:",R.width,"x",R.height),console.log("3Dmol: Canvas style before fix:",R.style.cssText),R.style.position="relative",R.style.top="0px",R.style.left="0px",R.style.width="100%",R.style.height="100%",R.style.maxWidth="100%",R.style.maxHeight="100%",console.log("3Dmol: Canvas style after fix:",R.style.cssText);try{R.getContext("webgl")||R.getContext("experimental-webgl")?console.log("3Dmol: WebGL context successfully created"):console.warn("3Dmol: WebGL context not available")}catch(J){console.warn("3Dmol: WebGL context error:",J)}}console.log("3Dmol.js: 3D molecule rendered successfully")}catch(v){if(console.error("3Dmol viewer creation error:",v),c.current){const w=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
                  <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 16px;">‚ùå</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Error</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to create 3D viewer</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                      <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                      <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${v.message}</p>
                    </div>
                  </div>
                </div>
              `;b(w)}}},100)),console.log("3Dmol.js rendering completed successfully"),!0}catch(g){if(console.error("3Dmol.js error:",g),c.current){const S=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">3Dmol.js Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize 3Dmol.js</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${g.message}</p>
              </div>
            </div>
          </div>
        `;b(S)}return!1}},[]),_=a.useCallback(async(p,f)=>{console.log("=== MoleculeViewer: renderWithNGL called ===");try{if(!c.current)return console.warn("Component unmounted during NGL initialization"),!1;if(typeof window.NGL>"u"){console.warn("NGL not loaded, falling back to placeholder");const u=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px solid #f59e0b;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Loading...</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">3D library not yet available</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Please refresh if 3D doesn't load</p>
              </div>
            </div>
          </div>
        `;return c.current&&b(u),!1}const g=`ngl-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("NGL: Generated container ID:",g);const S=`<div id="${g}" style="width: 100%; height: 384px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;return console.log("NGL: Created container HTML:",S),c.current&&(b(S),setTimeout(()=>{if(!c.current){console.log("NGL: Component unmounted during timeout");return}console.log("NGL: Looking for DOM element with ID:",g);const u=document.getElementById(g);if(console.log("NGL: Found DOM element:",u),!u){console.error("NGL container not found in DOM");return}try{let v=function(R){try{const J=R.addComponentFromObject({name:"molecule",structure:{type:"text",data:`SMILES: ${p}

This is a molecular structure viewer.
For full 3D visualization, SDF data is required.`}});console.log("NGL: Created text fallback representation")}catch(J){console.warn("NGL: Text fallback also failed:",J)}};console.log("NGL: Creating stage with element:",u);const w=new window.NGL.Stage(u,{backgroundColor:"black",quality:"medium",sampleLevel:1});if(console.log("NGL: Stage created successfully:",w),f&&f.molblock){console.log("NGL: Adding molecule from molblock SDF data"),console.log("NGL: Molblock type:",typeof f.molblock),console.log("NGL: Molblock length:",f.molblock.length);const R=new Blob([f.molblock],{type:"chemical/x-mdl-sdfile"}),J=new File([R],"molecule.sdf",{type:"chemical/x-mdl-sdfile"});w.loadFile(J,{ext:"sdf"}).then(A=>{console.log("NGL: Successfully loaded molecule from SDF data"),A.addRepresentation("ball+stick",{colorScheme:"element",quality:"medium",bondScale:.3,bondSpacing:.75}),A.addRepresentation("spacefill",{colorScheme:"element",opacity:.3,quality:"low"}),A.autoView(),console.log("NGL: Applied molecular styling and auto view")}).catch(A=>{console.error("NGL: Error loading SDF data:",A),v(w)})}else console.log("NGL: No molblock found, trying SMILES fallback"),v(w);i.current={type:"ngl",stage:w,element:u,renderer:"NGL"},console.log("NGL: 3D molecule rendered successfully")}catch(v){if(console.error("NGL stage creation error:",v),c.current){const w=`
                <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
                  <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 16px;">‚ùå</div>
                    <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Error</p>
                    <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to create NGL stage</p>
                    <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                      <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                      <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${v.message}</p>
                    </div>
                  </div>
                </div>
              `;b(w)}}},100)),console.log("NGL rendering completed successfully"),!0}catch(g){if(console.error("NGL error:",g),c.current){const S=`
          <div style="display: flex; align-items: center; justify-content: center; height: 384px; background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; border-radius: 8px; font-family: Arial, sans-serif; border: 2px dashed #ef4444;">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 4rem; margin-bottom: 16px;">‚ö†Ô∏è</div>
              <p style="font-size: 1.5rem; margin-bottom: 8px;">NGL Error</p>
              <p style="opacity: 0.9; font-size: 1rem; margin-bottom: 16px;">Failed to initialize NGL</p>
              <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 6px; font-family: monospace;">
                <p style="margin: 0; font-size: 0.85rem;">SMILES: ${p}</p>
                <p style="margin: 4px 0 0 0; font-size: 0.85rem;">Error: ${g.message}</p>
              </div>
            </div>
          </div>
        `;b(S)}return!1}},[]),B=a.useCallback(async()=>{if(!t||typeof t=="string"&&t.trim()===""){c.current&&(x(!1),y("No SMILES string provided"));return}let p=0;const f=5;for(;!l.current&&p<f;)console.log(`Waiting for container... retry ${p+1}`),await new Promise(g=>setTimeout(g,100)),p++;if(!l.current){console.error("Container ref never became available after retries"),c.current&&(x(!1),y("Container not available"));return}console.log(`Starting molecule rendering for: ${t} (mode: ${r}, renderer: ${o})`),c.current&&(x(!0),y(null),b("")),N();try{let g=!1,S=null;if(r==="3D")try{console.log("Generating 3D coordinates..."),S=await Rr(t),console.log("3D coordinates generated successfully"),console.log("Generated molData type:",typeof S),console.log("Generated molData keys:",Object.keys(S)),console.log("Molblock preview (first 100 chars):",S.molblock.substring(0,100)),console.log("Has real 3D coordinates:",S.has3D),console.log("Atom count:",S.atomCount)}catch(u){console.warn("Failed to generate 3D coordinates:",u)}switch(console.log(`Attempting to render with ${o}...`),o){case"SmilesDrawer":g=await O(t);break;case"RDKit.js":g=await L(t);break;case"Kekule.js":g=await H(t);break;case"3Dmol.js":g=await D(t,S);break;case"NGL":g=await _(t,S);break;case"Mol*":g=await T(t,S);break;default:console.log(`Unknown renderer ${o}, trying RDKit`),g=await L(t)}if(!l.current){console.warn("Container ref became null during rendering, component may have unmounted");return}if(!g&&["SmilesDrawer","Kekule.js"].includes(o)?(console.warn(`${o} failed, trying RDKit fallback`),g=await L(t)):!g&&["3Dmol.js","NGL"].includes(o)&&(console.warn(`${o} failed, trying Mol* fallback`),g=await T(t,S)),!l.current){console.warn("Container ref became null during fallback rendering");return}if(g||(console.warn("All advanced renderers failed, using simple SVG fallback"),g=await C(t)),!l.current){console.warn("Container ref became null during error handling");return}if(g)console.log("Molecule rendered successfully");else if(console.error("All rendering methods failed, showing error message"),c.current){const u=`
            <svg width="800" height="600" viewBox="0 0 800 600" style="background: #fee2e2; border: 2px solid #fecaca; border-radius: 8px;">
              <text x="400" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="4rem" fill="#dc2626">‚ö†Ô∏è</text>
              <text x="400" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="1.125rem" font-weight="600" fill="#dc2626">Rendering Failed</text>
              <text x="400" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="0.875rem" fill="#dc2626">Unable to render molecule</text>
              <text x="400" y="350" text-anchor="middle" font-family="monospace" font-size="0.75rem" fill="#dc2626">SMILES: ${t}</text>
              <text x="400" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="0.75rem" fill="#7f1d1d">Please check SMILES format and try again</text>
            </svg>
          `;b(u),i.current={type:"error"},y("Failed to render molecule with any available renderer")}c.current&&P(S)}catch(g){console.error("Critical rendering error:",g),c.current&&y(`Error rendering molecule: ${g.message}`);try{l.current&&await C(t)&&console.log("Emergency fallback rendering succeeded")}catch(S){console.error("Even fallback rendering failed:",S)}}finally{c.current&&x(!1)}},[t,r,o,N,L,T,C]);a.useEffect(()=>{console.log("=== MoleculeViewer: useEffect triggered ==="),console.log("Triggering renderMolecule with:",{smiles:(t==null?void 0:t.substring(0,50))+"...",mode:r,renderer:o}),console.log("Container ref current:",!!l.current),B()},[t,r,o,B]),a.useEffect(()=>N,[N]);const Y=a.useCallback(async()=>{if(!l.current)return console.warn("Container not found for PNG export"),!1;const p=l.current.querySelector("svg");if(p)try{const g=document.createElement("canvas"),S=g.getContext("2d"),u=new Image;let v,w;const R=p.getAttribute("viewBox");if(R){const[,,re,oe]=R.split(" ").map(Number);v=re,w=oe}else v=parseFloat(p.getAttribute("width"))||800,w=parseFloat(p.getAttribute("height"))||600;v=Math.max(400,Math.min(v,2e3)),w=Math.max(300,Math.min(w,2e3)),console.log(`PNG Export: Using dimensions ${v}x${w}`);const J=new XMLSerializer().serializeToString(p),A=new Blob([J],{type:"image/svg+xml;charset=utf-8"}),Q=URL.createObjectURL(A);return new Promise(re=>{u.onload=async()=>{try{g.width=v,g.height=w,S.fillStyle="white",S.fillRect(0,0,v,w),S.drawImage(u,0,0,v,w);const oe=await qe(g,t);URL.revokeObjectURL(Q),re(oe)}catch(oe){console.error("PNG export error:",oe),URL.revokeObjectURL(Q),re(!1)}},u.onerror=()=>{console.error("Failed to load SVG for PNG export"),URL.revokeObjectURL(Q),re(!1)},u.src=Q})}catch(g){return console.error("PNG export error:",g),!1}const f=l.current.querySelector("canvas");if(f)try{return await qe(f,t)}catch(g){return console.error("Canvas PNG export error:",g),!1}return console.warn("No exportable content found (SVG or Canvas)"),!1},[t]),V=a.useCallback(async()=>{if(!l.current)return console.warn("Container not found for SVG export"),!1;const p=l.current.querySelector("svg");if(p)try{return await Pr(p,t)}catch(f){return console.error("SVG export error:",f),!1}return console.warn("No SVG content found for export"),!1},[t]),U=a.useCallback(async()=>{if(r!=="3D")return console.warn("GLTF export only available in 3D mode"),!1;try{const p={asset:{version:"2.0",generator:"Lipid Viewer - Molecular Visualization Tool",copyright:"Generated molecular structure"},scene:0,scenes:[{name:"Molecular Scene",nodes:[0]}],nodes:[{name:`Molecule_${t}`,extras:{molecularData:{smiles:t,formula:"Generated from SMILES",molblock:(k==null?void 0:k.molblock)||"No 3D coordinates available",has3D:(k==null?void 0:k.has3D)||!1,atomCount:(k==null?void 0:k.atomCount)||"Unknown",generatedBy:"Lipid Viewer",exportTime:new Date().toISOString()}}}],extensionsUsed:[],extensionsRequired:[],extras:{description:"Molecular structure exported from Lipid Viewer",format:"GLTF 2.0 with molecular metadata",software:"Lipid Viewer",smiles:t}};k&&k.has3D&&(p.meshes=[{name:"MolecularMesh",primitives:[{mode:1,attributes:{},extras:{note:"Actual molecular geometry in molblock format",molblock:k.molblock}}]}],p.nodes[0].mesh=0);const f=JSON.stringify(p,null,2);return await Ir(f,t)}catch(p){return console.error("GLTF export error:",p),!1}},[t,r,o,k]);return a.useEffect(()=>{n&&n({png:Y,svg:V,gltf:U})},[n,Y,V,U]),e.jsxs("div",{className:`molecule-viewer ${r==="2D"?"molecule-2d":"molecule-3d"} p-4`,"data-testid":"molecule-viewer",children:[e.jsx("div",{ref:l,className:"w-full h-96 flex items-center justify-center border border-gray-300 rounded-lg bg-white",style:{minHeight:"400px"},children:m?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading molecule..."})]}):I?e.jsx("div",{dangerouslySetInnerHTML:{__html:I},style:{width:"100%",height:"100%"}}):d?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"‚ö†Ô∏è"}),e.jsx("p",{className:"text-red-600 font-semibold",children:"Error rendering molecule"}),e.jsx("p",{className:"text-red-500 text-sm mt-2",children:d})]}):null}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Mode:"})," ",r," | ",e.jsx("strong",{children:"Renderer:"})," ",o," | ",e.jsx("strong",{children:"SMILES:"})," ",t]}),o&&!h[o.replace(".","").replace("*","star")]&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Note: ",o," not fully available, showing fallback display"]})]})]})}),xt=({mode:t,onZoomIn:r,onZoomOut:o,onResetView:n,onExportPNG:s,onExportSVG:l,onExportGLTF:i,isLoaded:c=!1})=>c?e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"View Controls"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Navigation"}),e.jsxs("button",{onClick:r,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Zoom In (or use + key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Zoom In"})]}),e.jsxs("button",{onClick:o,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Zoom Out (or use - key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18 12H6"})}),e.jsx("span",{children:"Zoom Out"})]}),e.jsxs("button",{onClick:n,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Reset View (or use Space key)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Reset View"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Export"}),e.jsxs("button",{onClick:s,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as PNG image",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Export PNG"})]}),e.jsxs("button",{onClick:l,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as SVG vector",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Export SVG"})]}),t==="3D"&&e.jsxs("button",{onClick:i,className:"control-button w-full text-sm flex items-center justify-center space-x-2",title:"Export as GLTF 3D model",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("span",{children:"Export GLTF"})]})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Keyboard Shortcuts"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zoom In:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"+"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zoom Out:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Reset View:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Space"})]}),t==="3D"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rotate:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Mouse Drag"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pan:"}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:"Shift + Drag"})]})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Current Mode:"})," ",t==="2D"?"2D Structure View":"3D Molecular View",t==="3D"&&" - Use mouse to rotate, scroll to zoom"]})})]}):null;function Fr(){const[t,r]=a.useState(""),[o,n]=a.useState("2D"),[s,l]=a.useState("SmilesDrawer"),[i,c]=a.useState(!1),[m,x]=a.useState(!1),[d,y]=a.useState(null);console.log("=== App.jsx: Component rendered ==="),console.log("Current state:",{currentSMILES:t,mode:o,renderer:s,isValidSMILES:i,isMoleculeLoaded:m}),a.useEffect(()=>{console.log("=== App.jsx: currentSMILES changed ==="),console.log("New currentSMILES value:",t),console.log("Will render MoleculeViewer:",!!t)},[t]),a.useRef(null);const k=a.useRef(1),P=a.useCallback(D=>{console.log("=== App.jsx: handleModeChange called ==="),console.log("Mode changed from",o,"to",D),n(D),l(D==="2D"?"SmilesDrawer":"3Dmol.js")},[o]),I=a.useCallback(D=>{console.log("=== App.jsx: handleRendererChange called ==="),console.log("Renderer changed from",s,"to",D),l(D)},[s]),b=a.useCallback((D,_)=>{c(_),!_&&D.trim()&&ne.error("Invalid SMILES string",{duration:3e3,position:"top-center"})},[]),h=a.useCallback(D=>{if(console.log("=== App.jsx: handleSMILESSubmit called ==="),console.log("Received SMILES:",D),console.log("Current state before update:",{currentSMILES:t,mode:o,renderer:s}),!D.trim()){ne.error("Please enter a SMILES string",{duration:4e3,position:"top-center"});return}r(D),x(!0),console.log("SMILES state updated to:",D),console.log("isMoleculeLoaded set to true"),ne.success(`Loading molecule: ${D}`),i||ne.error("Warning: SMILES may be invalid, but attempting to render",{duration:5e3,position:"top-center"})},[i,t,o,s]),N=a.useCallback(D=>{y(D)},[]),C=a.useCallback(()=>{k.current=Math.min(k.current*1.2,5),ne.success(`Zoom: ${Math.round(k.current*100)}%`,{duration:1e3,position:"bottom-right"})},[]),E=a.useCallback(()=>{k.current=Math.max(k.current/1.2,.2),ne.success(`Zoom: ${Math.round(k.current*100)}%`,{duration:1e3,position:"bottom-right"})},[]),L=a.useCallback(()=>{k.current=1,ne.success("View reset",{duration:1e3,position:"bottom-right"})},[]),O=a.useCallback(async()=>{d!=null&&d.png&&ne.promise(d.png(),{loading:"Exporting PNG...",success:"PNG exported successfully!",error:"Failed to export PNG"})},[d]),H=a.useCallback(async()=>{d!=null&&d.svg&&ne.promise(d.svg(),{loading:"Exporting SVG...",success:"SVG exported successfully!",error:"Failed to export SVG"})},[d]),T=a.useCallback(async()=>{d!=null&&d.gltf&&ne.promise(d.gltf(),{loading:"Exporting GLTF...",success:"GLTF exported successfully!",error:"Failed to export GLTF"})},[d]);return a.useEffect(()=>{const D=_=>{if(!(_.target.tagName==="INPUT"||_.target.tagName==="TEXTAREA"))switch(_.key){case"+":case"=":_.preventDefault(),C();break;case"-":case"_":_.preventDefault(),E();break;case" ":_.preventDefault(),L();break;case"2":(_.ctrlKey||_.metaKey)&&(_.preventDefault(),P("2D"));break;case"3":(_.ctrlKey||_.metaKey)&&(_.preventDefault(),P("3D"));break}};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[C,E,L,P]),a.useEffect(()=>{t||x(!1)},[t]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(wt,{}),e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Lipid Viewer"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Interactive 2D/3D molecular visualization tool"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mode: ",e.jsx("span",{className:"font-semibold",children:o})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Renderer: ",e.jsx("span",{className:"font-semibold",children:s})]}),e.jsx(mt,{to:"/dock",className:"ml-4 inline-flex items-center px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 text-sm",children:"Docking"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(gt,{onSubmit:h,onValidation:b,isValid:i}),e.jsx(ht,{mode:o,renderer:s,onModeChange:P,onRendererChange:I}),t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Molecule Visualization"}),e.jsx(pt,{smiles:t,mode:o,renderer:s,onExport:N})]}),m&&e.jsx(xt,{mode:o,onZoomIn:C,onZoomOut:E,onResetView:L,onExportPNG:O,onExportSVG:H,onExportGLTF:T,isLoaded:m}),!t&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Welcome to Lipid Viewer"}),e.jsxs("div",{className:"text-blue-700 space-y-2",children:[e.jsx("p",{children:"‚Ä¢ Enter a SMILES string above to visualize molecular structures"}),e.jsx("p",{children:"‚Ä¢ Choose between 2D and 3D visualization modes"}),e.jsx("p",{children:"‚Ä¢ Select different rendering engines for optimal display"}),e.jsx("p",{children:"‚Ä¢ Export your visualizations as PNG, SVG, or GLTF files"}),e.jsx("p",{children:"‚Ä¢ Use keyboard shortcuts: +/- for zoom, Space to reset view"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-800 mb-2",children:"üöß Framework Preparation"}),e.jsx("p",{className:"text-yellow-700 text-sm",children:"Electrostatic surface visualization feature is prepared for future implementation. The current framework supports multiple rendering engines and can be extended to include surface rendering capabilities."})]})]})}),e.jsx("footer",{className:"bg-white border-t mt-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Powered by"," ",e.jsx("span",{className:"font-semibold",children:"SmilesDrawer"}),","," ",e.jsx("span",{className:"font-semibold",children:"RDKit.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"Kekule.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"3Dmol.js"}),","," ",e.jsx("span",{className:"font-semibold",children:"Mol*"}),", and"," ",e.jsx("span",{className:"font-semibold",children:"NGL"})]}),e.jsx("p",{className:"mt-1",children:"Built with React 18, Vite, and Tailwind CSS"})]})})})]})}function Ar({ligandSmiles:t,receptorPdbId:r,className:o="",...n}){console.log("üöÄ DockingMoleculeViewer: Component rendered with props:",{ligandSmiles:t,receptorPdbId:r});const s=a.useRef(null),l=a.useRef(null),[i,c]=a.useState(!0),[m,x]=a.useState(null),[d,y]=a.useState("");a.useEffect(()=>{if(!s.current)return;const b=async()=>{c(!0),x(null);try{if(typeof window.$3Dmol>"u"){x("3Dmol.js library not available"),c(!1);return}const h=`docking-viewer-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,N=`<div id="${h}" style="width: 100%; height: 400px; min-height: 400px; border-radius: 8px; background: #000; position: relative; overflow: hidden;"></div>`;console.log("üì¶ Creating container with ID:",h),console.log("üìè Container HTML:",N),y(N),setTimeout(async()=>{const C=document.getElementById(h);if(!C){x("Could not create 3D container"),c(!1);return}const E=C.getBoundingClientRect();if(console.log("üìê Container dimensions:",{width:E.width,height:E.height,top:E.top,left:E.left,bottom:E.bottom,right:E.right}),E.width===0||E.height===0){console.warn("‚ùå Container has zero dimensions, retrying...",E),setTimeout(()=>b(),200);return}else console.log("‚úÖ Container has valid dimensions");try{console.log("üß¨ DockingMoleculeViewer: Starting protein+ligand visualization");const L=window.$3Dmol.createViewer(C,{defaultcolors:window.$3Dmol.rasmolElementColors,antialias:!1,preserveDrawingBuffer:!0});if(!L)throw new Error("Failed to create 3Dmol viewer");l.current=L,console.log("‚úÖ 3Dmol viewer created successfully");let O=-1,H=-1;r&&(O=await k(L,r)),t&&(H=await P(L,t)),I(L,O,H);try{console.log("üéØ Starting render process..."),console.log("üîç Viewer state:",{hasViewer:!!L,modelCount:L.getModels?L.getModels().length:"unknown",element:C,elementDimensions:C.getBoundingClientRect()});try{const T=L.getModels?L.getModels():[];console.log("üìä Models in viewer:",T.length),T.forEach((D,_)=>{try{const B=D.selectedAtoms?D.selectedAtoms({}):[];console.log(`   Model ${_}: ${B.length} atoms`)}catch{console.log(`   Model ${_}: Could not count atoms`)}})}catch(T){console.warn("‚ö†Ô∏è Could not check models:",T)}console.log("üéØ Step 1: zoomTo()"),L.zoomTo(),console.log("‚úÖ zoomTo completed"),console.log("üéØ Step 2: center()"),L.center(),console.log("‚úÖ center completed"),console.log("üéØ Step 3: render()"),L.render(),console.log("‚úÖ Initial render completed"),setTimeout(()=>{const T=C.querySelector("canvas");if(T){console.log("üñºÔ∏è Canvas found:",{width:T.width,height:T.height,clientWidth:T.clientWidth,clientHeight:T.clientHeight,style:T.style.cssText});try{const D=T.getContext("webgl")||T.getContext("experimental-webgl");D?console.log("üéÆ WebGL context found:",{vendor:D.getParameter(D.VENDOR),renderer:D.getParameter(D.RENDERER),version:D.getParameter(D.VERSION),maxTextureSize:D.getParameter(D.MAX_TEXTURE_SIZE),viewportDims:D.getParameter(D.VIEWPORT)}):console.error("‚ùå No WebGL context available!")}catch(D){console.error("‚ùå WebGL context check failed:",D)}}else console.error("‚ùå No canvas found in element!");if(l.current)try{console.log("üéØ Secondary render..."),l.current.render(),console.log("‚úÖ Secondary render completed")}catch(D){console.warn("‚ö†Ô∏è Secondary render failed:",D)}},500)}catch(T){console.error("‚ùå Render failed:",T),x(`Rendering failed: ${T.message}`)}c(!1)}catch(L){console.error("Error creating docking visualization:",L),x(L.message),c(!1)}},300)}catch(h){console.error("Error initializing docking viewer:",h),x(h.message),c(!1)}};return b(),()=>{if(l.current)try{l.current.clear()}catch(h){console.warn("Error during cleanup:",h)}}},[t,r]);const k=async(b,h)=>{try{console.log(`Loading protein ${h}...`);const N=`https://files.rcsb.org/download/${h.toUpperCase()}.pdb`,C=await fetch(N);if(!C.ok)throw new Error(`Failed to fetch protein ${h}: ${C.statusText}`);const E=await C.text();b.addModel(E,"pdb");const L=0;return console.log(`Protein ${h} loaded successfully as model ${L}`),L}catch(N){return console.error("Error loading protein:",N),-1}},P=async(b,h)=>{try{console.log(`Loading ligand from SMILES: ${h}`);try{const N=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:h,num_conformers:1})});if(N.ok){const C=await N.json();b.addModel(C.sdf,"sdf");const E=1;return console.log(`Ligand loaded from backend successfully as model ${E}`),E}}catch(N){console.warn("Backend ligand preparation failed, using fallback:",N)}try{b.addModel(h,"smiles");const N=1;return console.log(`Ligand loaded via SMILES fallback as model ${N}`),N}catch(N){return console.error("Failed to load ligand via SMILES:",N),-1}}catch(N){return console.error("Error loading ligand:",N),-1}},I=(b,h,N)=>{try{if(console.log(`Applying styling - Protein: ${h}, Ligand: ${N}`),h>=0){console.log(`üß¨ Styling protein model ${h}`),b.setStyle({model:h},{cartoon:{color:"spectrum",opacity:.8}}),console.log("‚úÖ Applied protein cartoon styling");try{b.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.15,color:"lightblue"},{model:h}),console.log("‚úÖ Applied protein surface")}catch(C){console.warn("‚ö†Ô∏è Could not add protein surface:",C)}}if(N>=0){console.log(`üíä Styling ligand model ${N}`),b.setStyle({model:N},{stick:{colorscheme:"greenCarbon",radius:.4,opacity:1},sphere:{colorscheme:"greenCarbon",radius:.3,opacity:.9}}),console.log("‚úÖ Applied ligand stick+sphere styling");try{b.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.4,color:"yellow"},{model:N}),console.log("‚úÖ Applied ligand glow surface")}catch(C){console.warn("‚ö†Ô∏è Could not add ligand surface:",C)}}if(h<0&&N<0){console.warn("Model indices not available, applying fallback styling");try{b.setStyle({model:0},{cartoon:{color:"spectrum",opacity:.8}}),b.setStyle({model:1},{stick:{colorscheme:"greenCarbon",radius:.3},sphere:{colorscheme:"greenCarbon",radius:.25,opacity:.8}}),console.log("Applied fallback styling: model 0 as protein, model 1 as ligand")}catch(C){console.warn("Fallback styling failed:",C)}}}catch(C){console.error("Error applying molecular styling:",C),b.setStyle({},{stick:{radius:.2},sphere:{radius:.3}})}};return m?e.jsx("div",{className:`flex items-center justify-center h-96 bg-red-50 border border-red-200 rounded-lg ${o}`,children:e.jsxs("div",{className:"text-center text-red-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Visualization Error"}),e.jsx("div",{className:"text-sm",children:m})]})}):e.jsxs("div",{className:`relative ${o}`,children:[e.jsx("div",{ref:s,className:"w-full h-96",dangerouslySetInnerHTML:{__html:d}}),i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-75 rounded-lg",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),e.jsx("p",{children:"Loading docking visualization..."}),e.jsxs("p",{className:"text-sm opacity-75 mt-1",children:[r&&`Protein: ${r}`,r&&t&&" + ",t&&`Ligand: ${t.substring(0,20)}...`]})]})}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black bg-opacity-75 text-white rounded px-3 py-2 text-sm",children:[e.jsxs("div",{children:["üß¨ ",r?`Protein: ${r}`:"No protein"]}),e.jsxs("div",{children:["üíä ",t?"Ligand loaded":"No ligand"]})]})]})}function Or({ligandSmiles:t,receptorPdbId:r,poses:o=[],selectedPose:n=0,visiblePoses:s=new Set([0]),onFocusBindingSite:l,onResetView:i,className:c="",...m}){console.log("üöÄ Enhanced3DViewer: Initializing with:",{ligandSmiles:t,receptorPdbId:r,poses:o.length,selectedPose:n,visiblePoses:Array.from(s)});const x=a.useRef(null),d=a.useRef(null),[y,k]=a.useState(!0),[P,I]=a.useState(null),[b,h]=a.useState({protein:-1,ligand:-1}),[N,C]=a.useState("cartoon"),[E,L]=a.useState("stick"),[O,H]=a.useState("spectrum"),[T,D]=a.useState("#1a1a1a"),[_,B]=a.useState(!1),[Y,V]=a.useState(!1),U=[{value:"cartoon",label:"Cartoon",description:"Secondary structure representation"},{value:"ribbon",label:"Ribbon",description:"Smooth ribbon through backbone"},{value:"backbone",label:"Backbone",description:"Backbone trace"},{value:"surface",label:"Surface",description:"Molecular surface"},{value:"wireframe",label:"Wireframe",description:"Wire model"}],p=[{value:"stick",label:"Stick",description:"Stick representation"},{value:"sphere",label:"Sphere",description:"Space-filling spheres"},{value:"ball-stick",label:"Ball & Stick",description:"Combined spheres and sticks"},{value:"line",label:"Line",description:"Simple line representation"}],f=[{value:"spectrum",label:"Spectrum",description:"Rainbow colors by chain"},{value:"chainid",label:"Chain ID",description:"Different colors per chain"},{value:"element",label:"Element",description:"Color by atomic element"},{value:"hydrophobicity",label:"Hydrophobicity",description:"Hydrophobic/hydrophilic regions"},{value:"secondary",label:"Secondary Structure",description:"Color by secondary structure"}],g=[{value:"#1a1a1a",label:"Dark Gray",color:"#1a1a1a"},{value:"#000000",label:"Black",color:"#000000"},{value:"#ffffff",label:"White",color:"#ffffff"},{value:"#2c3e50",label:"Dark Blue",color:"#2c3e50"},{value:"#34495e",label:"Slate",color:"#34495e"}];a.useEffect(()=>!x.current||!t||!r?void 0:((async()=>{k(!0),I(null);try{if(typeof window.$3Dmol>"u")throw new Error("3Dmol.js library not loaded. Please ensure the script is included.");if(d.current)try{d.current.clear()}catch(G){console.warn("Error clearing existing viewer:",G)}const M=x.current;if(!M)throw new Error("Container not found");M.style.width="100%",M.style.height="500px",M.style.minHeight="500px",M.style.position="relative",M.style.backgroundColor=T,await new Promise(G=>setTimeout(G,100));const z={backgroundColor:T,antialias:!0,alpha:!0,preserveDrawingBuffer:!0};console.log("üéÆ Creating 3Dmol viewer with config:",z);const $=window.$3Dmol.createViewer(M,z);if(!$)throw new Error("Failed to create 3Dmol viewer");d.current=$,console.log("‚úÖ 3Dmol viewer created successfully");const W=await S($,r),F=await v($,t,o);h({protein:W,ligand:F[0],ligandPoses:F}),w($,W,F),await A($),k(!1),console.log("üéâ Enhanced3DViewer initialization complete")}catch(M){console.error("‚ùå Enhanced3DViewer initialization failed:",M),I(M.message),k(!1)}})(),()=>{if(d.current)try{d.current.clear(),d.current=null}catch(M){console.warn("Error during cleanup:",M)}}),[t,r]),a.useEffect(()=>{d.current&&b.protein>=0&&(console.log("üîÑ Updating visualization for pose changes:",{selectedPose:n,visiblePoses:Array.from(s)}),w(d.current,b.protein,b.ligandPoses||[b.ligand]),A(d.current))},[n,s,b]),a.useEffect(()=>{d.current&&b.protein>=0&&(w(d.current,b.protein,b.ligandPoses||[b.ligand]),A(d.current))},[N,E,O,_,Y,b]),a.useEffect(()=>{d.current&&(d.current.setBackgroundColor(T),d.current.render()),x.current&&(x.current.style.backgroundColor=T)},[T]);const S=async(j,M)=>{try{console.log(`üß¨ Loading protein ${M}...`);const z=`https://files.rcsb.org/download/${M.toUpperCase()}.pdb`,$=await fetch(z);if(!$.ok)throw new Error(`Failed to fetch protein ${M}: ${$.statusText}`);const W=await $.text();return j.addModel(W,"pdb"),console.log(`‚úÖ Protein ${M} loaded successfully`),0}catch(z){throw console.error("‚ùå Error loading protein:",z),z}},u=async(j,M)=>{try{console.log(`üíä Loading ligand from SMILES: ${M}`);try{const z=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:M})});if(z.ok){const $=await z.json();if($.sdf_content)return j.addModel($.sdf_content,"sdf"),console.log("‚úÖ Ligand loaded from backend"),1}}catch(z){console.warn("Backend ligand preparation failed:",z)}return j.addModel(M,"smiles"),console.log("‚úÖ Ligand loaded via SMILES fallback"),1}catch(z){throw console.error("‚ùå Error loading ligand:",z),z}},v=async(j,M,z)=>{try{if(console.log(`üíä Loading ${z.length} pose ligands at their binding coordinates for SMILES: ${M}`),!z||z.length===0)return[await u(j,M)];const $=[];let W=null;try{const F=await fetch("/api/ligand/prepare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:M})});if(F.ok){const G=await F.json();G.sdf_content&&(W=G.sdf_content,console.log("‚úÖ Base ligand SDF obtained from backend"))}}catch(F){console.warn("‚ö†Ô∏è Could not get ligand SDF from backend:",F)}for(let F=0;F<z.length;F++){const G=z[F];try{let ee=!1;if(W){j.addModel(W,"sdf");const me=F+1;if(G.center_x!==void 0&&G.center_y!==void 0&&G.center_z!==void 0){const Z=j.getModels()[me];if(Z){const te=Z.getCentroid(),le=G.center_x-te.x,ae=G.center_y-te.y,ie=G.center_z-te.z;Z.translate(le,ae,ie),console.log(`‚úÖ Pose ${G.mode} positioned at binding site (${G.center_x}, ${G.center_y}, ${G.center_z})`),console.log(`üìç Translation applied: (${le.toFixed(3)}, ${ae.toFixed(3)}, ${ie.toFixed(3)})`)}}$.push(me),ee=!0}ee||(console.warn(`‚ö†Ô∏è Using SMILES fallback for pose ${G.mode}`),j.addModel(M,"smiles"),$.push(F+1))}catch(ee){console.error(`‚ùå Failed to load pose ${G.mode}:`,ee)}}return console.log(`üéØ Successfully loaded ${$.length} poses at their binding coordinates`),console.log(`üìä Model indices: [${$.join(", ")}]`),$}catch($){return console.error("‚ùå Error loading pose ligands at coordinates:",$),[await u(j,t)]}},w=(j,M,z)=>{try{if(console.log(`üé® Applying visualization styles - Protein: ${N}, Ligand: ${E}, Colors: ${O}`),console.log(`üéØ Pose info - Selected: ${n}, Visible: [${Array.from(s).join(", ")}]`),j.setStyle({},{}),j.removeAllSurfaces(),j.removeAllLabels(),M>=0){const $=R(N,O);if(j.setStyle({model:M},$),console.log("‚úÖ Protein styling applied"),_)try{j.addSurface(window.$3Dmol.SurfaceType.VDW,{opacity:.2,color:"lightblue"},{model:M}),console.log("‚úÖ Protein surface added")}catch(W){console.warn("‚ö†Ô∏è Could not add protein surface:",W)}}if(z&&z.length>0&&o.length>0)o.forEach(($,W)=>{const F=z[W],G=s.has(W),ee=W===n;if(F!==void 0&&F>=0)if(G){const me=J(E,ee,W);if(j.setStyle({model:F},me),console.log(`‚úÖ Pose ${$.mode} (model ${F}) styled - Selected: ${ee}`),Y)try{const K=j.getModel(F);if(K){const Z=ee?`Pose ${$.mode} (${$.affinity} kcal/mol) - SELECTED`:`Pose ${$.mode} (${$.affinity} kcal/mol)`;j.addLabel(Z,{position:K.getCentroid(),fontSize:ee?14:12,fontColor:ee?"yellow":"white",backgroundColor:ee?"red":"black",backgroundOpacity:ee?.9:.7})}}catch(K){console.warn(`‚ö†Ô∏è Could not add label for pose ${$.mode}:`,K)}}else j.setStyle({model:F},{}),console.log(`üôà Pose ${$.mode} (model ${F}) hidden`)}),console.log(`‚úÖ Applied styling to ${z.length} pose models`);else if(z&&z.length>0){const $=z[0];if($!==void 0&&$>=0){const W=J(E,!0,0);if(j.setStyle({model:$},W),console.log("‚úÖ Single ligand model styled"),Y)try{const F=j.getModel($);F&&(j.addLabel("Ligand",{position:F.getCentroid(),fontSize:12,fontColor:"yellow",backgroundColor:"black",backgroundOpacity:.7}),console.log("‚úÖ Single ligand label added"))}catch(F){console.warn("‚ö†Ô∏è Could not add ligand label:",F)}}}}catch($){console.error("‚ùå Error applying visualization style:",$)}},R=(j,M)=>{const z={};switch(j){case"cartoon":z.cartoon={color:M,opacity:.8,thickness:.4};break;case"ribbon":z.ribbon={color:M,opacity:.8,thickness:.4};break;case"backbone":z.line={color:M,opacity:.8,linewidth:3};break;case"surface":z.surface={color:M,opacity:.7};break;case"wireframe":z.line={color:M,opacity:.6,linewidth:1};break;default:z.cartoon={color:M,opacity:.8}}return z},J=(j,M=!0,z=0)=>{const $={};let W="greenCarbon",F=M?1:.6,G=M?1:.8;if(o.length>1){const ee=["greenCarbon","redCarbon","blueCarbon","yellowCarbon","purpleCarbon","orangeCarbon"];W=ee[z%ee.length]}switch(j){case"stick":$.stick={colorscheme:W,radius:.3*G,opacity:F};break;case"sphere":$.sphere={colorscheme:W,radius:.4*G,opacity:F*.9};break;case"ball-stick":$.stick={colorscheme:W,radius:.2*G,opacity:F},$.sphere={colorscheme:W,radius:.3*G,opacity:F*.9};break;case"line":$.line={colorscheme:W,linewidth:3*G,opacity:F};break;default:$.stick={colorscheme:W,radius:.3*G,opacity:F}}return $},A=async j=>{try{console.log("üéØ Starting viewer render..."),j.zoomTo(),j.center(),j.render(),await new Promise(M=>setTimeout(M,100)),j.render(),console.log("‚úÖ Viewer rendering complete")}catch(M){throw console.error("‚ùå Viewer rendering failed:",M),M}},Q=()=>{d.current&&(console.log("üîÑ Resetting view..."),d.current.zoomTo(),d.current.center(),d.current.render(),i&&i())},re=()=>{if(d.current&&o.length>0){console.log("üéØ Focusing on binding site...");const j=o[n];if(j){const M=b.ligandPoses?b.ligandPoses[n]:b.ligand;if(M!==void 0&&M>=0)console.log(`üìç Focusing on pose ${j.mode} (model ${M}) at binding site`),d.current.zoomTo({model:M},1e3),d.current.render(),console.log(`üéØ Camera focused on pose ${j.mode} at coordinates (${j.center_x}, ${j.center_y}, ${j.center_z})`);else if(j.center_x!==void 0&&j.center_y!==void 0&&j.center_z!==void 0){const z={x:j.center_x,y:j.center_y,z:j.center_z};console.log("üìç Centering on pose coordinates directly:",z),d.current.zoomTo({center:z,zoom:2}),d.current.render()}l&&l(j)}}else d.current&&b.ligand!==void 0&&b.ligand>=0&&(console.log("üéØ Focusing on ligand (no pose data)..."),d.current.zoomTo({model:b.ligand},1e3),d.current.render(),l&&l())},oe=()=>{if(d.current)try{const j=d.current.pngURI(),M=document.createElement("a");M.download=`molecular-docking-${Date.now()}.png`,M.href=j,M.click()}catch(j){console.error("Error saving image:",j)}};return P?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Visualization Error"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:P}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Reload Page"})]}):e.jsxs("div",{className:`space-y-4 ${c}`,children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Visualization Controls"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Protein Style"}),e.jsx("select",{value:N,onChange:j=>C(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:U.map(j=>e.jsx("option",{value:j.value,title:j.description,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ligand Style"}),e.jsx("select",{value:E,onChange:j=>L(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:p.map(j=>e.jsx("option",{value:j.value,title:j.description,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color Scheme"}),e.jsx("select",{value:O,onChange:j=>H(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y,children:f.map(j=>e.jsx("option",{value:j.value,title:j.description,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Background"}),e.jsx("div",{className:"flex space-x-1",children:g.map(j=>e.jsx("button",{onClick:()=>D(j.value),className:`w-8 h-8 rounded border-2 ${T===j.value?"border-blue-500":"border-gray-300"}`,style:{backgroundColor:j.color},title:j.label,disabled:y},j.value))})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-2 border-t border-gray-200",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:j=>B(j.target.checked),disabled:y,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{children:"Show Surface"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:j=>V(j.target.checked),disabled:y,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{children:"Show Labels"})]}),e.jsx("button",{onClick:re,disabled:y||o.length===0,className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700 disabled:opacity-50",children:"Focus Binding Site"}),e.jsx("button",{onClick:Q,disabled:y,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:"Reset View"}),e.jsx("button",{onClick:oe,disabled:y,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:"Save Image"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[y&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"}),e.jsx("p",{className:"text-gray-700",children:"Loading molecular structures..."})]})}),e.jsx("div",{ref:x,className:"w-full h-[500px] min-h-[500px] relative",style:{backgroundColor:T}})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Protein: ",r.toUpperCase()," | Ligand: ",t.slice(0,50),t.length>50?"...":""]}),e.jsxs("p",{children:["Models loaded: Protein (",b.protein>=0?"‚úì":"‚úó","), Ligand (",b.ligand>=0?"‚úì":"‚úó",")"]}),o.length>0&&e.jsxs("p",{children:["Poses: ",o.length," total | Selected: ",n+1," | Visible: ",s.size]})]})]})}function Gr({ligandSmiles:t,receptorPdbId:r,dockingResults:o,mode:n="3D",renderer:s="3Dmol.js",className:l=""}){const[i,c]=a.useState(0),[m,x]=a.useState(new Set([0])),[d,y]=a.useState("affinity"),[k,P]=a.useState(!0),[I,b]=a.useState(!1),[h,N]=a.useState(!0),C=a.useRef(null),E={affinity:{name:"Binding Affinity",getColor:(V,U,p)=>{const f=Math.abs(V.affinity),g=Math.max(...p.map(R=>Math.abs(R.affinity))),S=Math.min(...p.map(R=>Math.abs(R.affinity))),u=(f-S)/(g-S),v=Math.floor(255*u),w=Math.floor(255*(1-u));return`rgb(${v}, ${w}, 0)`},description:"Green = Better affinity, Red = Worse affinity"},rmsd:{name:"RMSD",getColor:(V,U,p)=>{const f=V.rmsd_lb,g=Math.max(...p.map(J=>J.rmsd_lb)),S=Math.min(...p.map(J=>J.rmsd_lb)),u=(f-S)/(g-S),v=Math.floor(255*u),w=Math.floor(255*u),R=Math.floor(255*(1-u));return`rgb(${v}, ${w}, ${R})`},description:"Blue = Low RMSD, Yellow = High RMSD"},rainbow:{name:"Pose Order",getColor:(V,U,p)=>`hsl(${U/p.length*300}, 70%, 50%)`,description:"Different colors for each pose"}},L=(o==null?void 0:o.poses)||[],O=[...L].sort((V,U)=>V.affinity-U.affinity),H=V=>{c(V),x(new Set([V]))},T=V=>{const U=new Set(m);U.has(V)?U.delete(V):U.add(V),x(U)},D=()=>{x(new Set(L.map((V,U)=>U)))},_=()=>{x(new Set)},B=V=>{if(console.log("üéØ DockingVisualization: Focus on binding site requested",V),b(!0),L.length>0){const U=V||L[i];U&&console.log("üìç Focusing on pose:",U)}},Y=()=>{console.log("üîÑ DockingVisualization: Reset camera view requested"),b(!1)};return e.jsx("div",{className:`docking-visualization ${l}`,children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"3D Molecular Visualization"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Viewer Mode:"}),e.jsx("button",{onClick:()=>N(!h),className:`px-3 py-1 text-sm rounded transition-colors ${h?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:h?"Enhanced":"Basic"})]})]}),e.jsxs("div",{ref:C,className:"w-full bg-black rounded-lg border-2 border-gray-300 relative overflow-hidden",children:[h?e.jsx(Or,{ligandSmiles:t,receptorPdbId:r,poses:L,selectedPose:i,visiblePoses:m,onFocusBindingSite:B,onResetView:Y,className:"w-full"},`enhanced-viewer-${t}-${r}`):e.jsx("div",{className:"h-96",children:e.jsx(Ar,{ligandSmiles:t,receptorPdbId:r,className:"w-full h-full"},`basic-viewer-${t}-${r}`)}),!h&&e.jsxs("div",{className:"absolute bottom-4 left-4 bg-black bg-opacity-75 text-white rounded px-3 py-2 text-sm",children:[e.jsxs("div",{children:["Ligand: ",t||"N/A"]}),e.jsxs("div",{children:["Receptor: ",r||"N/A"]}),e.jsxs("div",{children:["Visible poses: ",m.size," of ",L.length]})]}),!h&&e.jsxs("div",{className:"absolute top-4 right-4 space-y-2",children:[e.jsx("button",{onClick:B,className:`px-3 py-1 text-xs rounded ${I?"bg-blue-600 text-white":"bg-white text-gray-700"} shadow`,children:"Focus Site"}),e.jsx("button",{onClick:Y,className:"block px-3 py-1 text-xs bg-white text-gray-700 rounded shadow",children:"Reset View"})]}),!h&&k&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-3 max-w-xs",children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Color Scheme: ",E[d].name]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:E[d].description}),e.jsx("div",{className:"flex items-center space-x-2 text-xs",children:e.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600",children:"‚úï"})})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Poses"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:D,className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Show All"}),e.jsx("button",{onClick:_,className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"Hide All"})]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:O.map((V,U)=>{const p=L.findIndex(u=>u.mode===V.mode),f=i===p,g=m.has(p),S=E[d].getColor(V,p,L);return e.jsxs("div",{className:`flex items-center p-2 rounded border ${f?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full border mr-3",style:{backgroundColor:S}}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>H(p),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Mode ",V.mode]}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:[V.affinity," kcal/mol"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["RMSD: ",V.rmsd_lb," - ",V.rmsd_ub," √Ö"]})]}),e.jsx("button",{onClick:()=>T(p),className:`ml-2 px-2 py-1 text-xs rounded ${g?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:g?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"})]},V.mode)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Visualization"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color Scheme"}),e.jsx("select",{value:d,onChange:V=>y(V.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:Object.entries(E).map(([V,U])=>e.jsx("option",{value:V,children:U.name},V))})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:V=>P(V.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Show Legend"})]})}),!h&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Camera"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:B,className:"w-full px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Focus on Binding Site"}),e.jsx("button",{onClick:Y,className:"w-full px-3 py-2 text-sm bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reset View"})]})]}),(o==null?void 0:o.summary)&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Summary"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Best: ",o.summary.best_affinity," kcal/mol"]}),e.jsxs("div",{children:["Average: ",o.summary.mean_affinity," kcal/mol"]}),e.jsxs("div",{children:["Time: ",o.summary.calculation_time,"s"]})]})]})]})]})]})})}function Br({onAdvancedDocking:t,isLoading:r,disabled:o,currentParams:n,receptorPdbId:s}){var S;const[l,i]=a.useState(!1),[c,m]=a.useState(""),[x,d]=a.useState(""),[y,k]=a.useState(""),[P,I]=a.useState(""),[b,h]=a.useState([]),[N,C]=a.useState([]),[E,L]=a.useState(""),[O,H]=a.useState(!1),[T,D]=a.useState(!1),[_,B]=a.useState({exhaustiveness:8,num_modes:9,energy_range:3,cpu_threads:1,seed:0,local_only:!1,randomize_only:!1});a.useEffect(()=>{Y()},[]),a.useEffect(()=>{s&&O&&V()},[s,O]);const Y=async()=>{try{const u=await fetch("/api/templates");if(u.ok){const v=await u.json();h(v.templates||[])}}catch(u){console.error("Failed to load templates:",u)}},V=async()=>{if(s)try{const u=await fetch(`/api/pockets/${s}`);if(u.ok){const v=await u.json();C(v.pockets||[])}}catch(u){console.error("Failed to load pockets:",u)}},U=u=>{I(u);const v=b.find(w=>w.template_id===u);v&&(B({..._,...v.default_params}),m(v.name),d(v.description),v.advanced_params&&(H(v.advanced_params.use_pocket_detection||!1),D(v.advanced_params.use_gnina_rescoring||!1)))},p=u=>{L(u);const v=N.find(w=>w.pocket_id===u);if(v&&t){const w={...n,center_x:v.center_x,center_y:v.center_y,center_z:v.center_z,size_x:v.radius*2,size_y:v.radius*2,size_z:v.radius*2};t(w,!0)}},f=()=>{if(!t)return;const u={...n,..._,job_name:c,job_description:x,tags:y.split(",").map(v=>v.trim()).filter(v=>v),template_id:P,use_pocket_detection:O,use_gnina_rescoring:T};t(u,!1)},g=async()=>{if(s)try{const u=await fetch("/api/pockets/detect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:s})});if(u.ok){const v=await u.json();C(v.pockets||[])}else throw new Error("Failed to detect pockets")}catch(u){console.error("Pocket detection failed:",u)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Advanced Docking"}),e.jsx("button",{onClick:()=>i(!l),className:"text-sm text-blue-600 hover:text-blue-700",children:l?"Hide Advanced":"Show Advanced"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Job Name"}),e.jsx("input",{type:"text",value:c,onChange:u=>m(u.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"Optional job name",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:x,onChange:u=>d(u.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:2,placeholder:"Optional job description",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:y,onChange:u=>k(u.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"e.g., fragment, high-throughput, kinase",disabled:r})]})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Job Template"}),e.jsxs("select",{value:P,onChange:u=>U(u.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:r,children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),b.map(u=>e.jsxs("option",{value:u.template_id,children:[u.name," - ",u.description]},u.template_id))]}),P&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Used ",((S=b.find(u=>u.template_id===P))==null?void 0:S.usage_count)||0," times"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Advanced Features"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:u=>H(u.target.checked),className:"mr-2",disabled:r}),e.jsxs("span",{className:"text-sm",children:["Use automatic pocket detection",e.jsx("span",{className:"text-gray-500 ml-1",children:"(fpocket algorithm)"})]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:u=>D(u.target.checked),className:"mr-2",disabled:r}),e.jsxs("span",{className:"text-sm",children:["Use GNINA rescoring",e.jsx("span",{className:"text-gray-500 ml-1",children:"(CNN-based scoring)"})]})]})]})]}),O&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Detected Pockets"}),e.jsx("button",{onClick:g,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",disabled:r||!s,children:"Detect Pockets"})]}),N.length>0?e.jsx("div",{className:"max-h-40 overflow-y-auto space-y-2",children:N.map((u,v)=>e.jsxs("div",{className:`p-3 border rounded cursor-pointer ${E===u.pocket_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>p(u.pocket_id),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Pocket ",v+1]}),e.jsxs("span",{className:"text-sm text-green-600",children:["Druggability: ",(u.druggability_score*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Center: (",u.center_x.toFixed(1),", ",u.center_y.toFixed(1),", ",u.center_z.toFixed(1),") | Volume: ",u.volume.toFixed(0)," ≈≤"]})]},u.pocket_id))}):e.jsx("p",{className:"text-sm text-gray-500",children:s?'Click "Detect Pockets" to find binding sites':"Load a protein first to detect pockets"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Docking Parameters"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exhaustiveness"}),e.jsx("input",{type:"number",value:_.exhaustiveness,onChange:u=>B({..._,exhaustiveness:parseInt(u.target.value)}),min:"1",max:"32",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1-32, higher = more thorough"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Modes"}),e.jsx("input",{type:"number",value:_.num_modes,onChange:u=>B({..._,num_modes:parseInt(u.target.value)}),min:"1",max:"50",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Number of binding modes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Energy Range (kcal/mol)"}),e.jsx("input",{type:"number",value:_.energy_range,onChange:u=>B({..._,energy_range:parseFloat(u.target.value)}),min:"1",max:"10",step:"0.1",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum energy difference"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Random Seed"}),e.jsx("input",{type:"number",value:_.seed,onChange:u=>B({..._,seed:parseInt(u.target.value)}),min:"0",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",disabled:r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"0 = random, >0 = reproducible"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:_.local_only,onChange:u=>B({..._,local_only:u.target.checked}),className:"mr-2",disabled:r}),e.jsx("span",{className:"text-sm",children:"Local search only (no global search)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:_.randomize_only,onChange:u=>B({..._,randomize_only:u.target.checked}),className:"mr-2",disabled:r}),e.jsx("span",{className:"text-sm",children:"Randomize ligand only (no docking)"})]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("button",{onClick:f,disabled:r||o,className:"w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:r?"Running Advanced Docking...":"Run Advanced Docking"}),(O||T)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 text-center",children:["Estimated time: ",T?"5-10":"3-6"," minutes",O&&" (includes pocket detection)"]})]})]})}const ge="/api";class we{static async estimateBindingSite(r,o=null){const n=await fetch(`${ge}/binding-site/estimate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:r,ligand_smiles:o})});if(!n.ok){const s=await n.text();throw new Error(`Failed to estimate binding site: ${s}`)}return n.json()}static async getProteinInfo(r){const o=await fetch(`${ge}/pdb/${r}/info`);if(!o.ok){const n=await o.text();throw new Error(`Failed to get protein info: ${n}`)}return o.json()}static async prepareLigand(r){const o=await fetch(`${ge}/ligand/prepare`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:r})});if(!o.ok){const n=await o.text();throw new Error(`Failed to prepare ligand: ${n}`)}return o.json()}static async prepareReceptor(r){const o=await fetch(`${ge}/receptor/prepare`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdb_id:r})});if(!o.ok){const n=await o.text();throw new Error(`Failed to prepare receptor: ${n}`)}return o.json()}static async runDocking(r){const o=await fetch(`${ge}/dock/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){const n=await o.text();throw new Error(`Failed to start docking: ${n}`)}return o.json()}static async getDockingStatus(r){const o=await fetch(`${ge}/dock/status/${r}`);if(!o.ok){const n=await o.text();throw new Error(`Failed to get docking status: ${n}`)}return o.json()}static async listDockingJobs(){const r=await fetch(`${ge}/dock/jobs`);if(!r.ok){const o=await r.text();throw new Error(`Failed to list docking jobs: ${o}`)}return r.json()}static async pollDockingJob(r,o=null,n=2e3){return new Promise((s,l)=>{const i=setInterval(async()=>{try{const c=await this.getDockingStatus(r);o&&o(c),c.status==="completed"?(clearInterval(i),s(c)):(c.status==="failed"||c.status==="cancelled")&&(clearInterval(i),l(new Error(c.error_message||`Docking job ${c.status}`)))}catch(c){clearInterval(i),l(c)}},n);setTimeout(()=>{clearInterval(i),l(new Error("Docking job timeout"))},3e5)})}}class Ur{constructor(){this.lastHealthCheck=null,this.checkInterval=3e4}async checkBackendHealth(){try{const r=await fetch("/api/healthz",{method:"GET",headers:{"Content-Type":"application/json"},timeout:5e3}),o=r.ok,n={isConnected:o,timestamp:Date.now()};return o||(n.error=`Server responded with status ${r.status}: ${r.statusText}`),this.lastHealthCheck=n,n}catch(r){const o={isConnected:!1,timestamp:Date.now(),error:r.message||"Connection failed"};return this.lastHealthCheck=o,o}}getLastHealthCheck(){return this.lastHealthCheck}isLastCheckValid(){return this.lastHealthCheck?Date.now()-this.lastHealthCheck.timestamp<this.checkInterval:!1}startPeriodicChecks(r,o=this.checkInterval){this.stopPeriodicChecks(),this.periodicCheckTimer=setInterval(async()=>{const n=await this.checkBackendHealth();r&&r(n)},o)}stopPeriodicChecks(){this.periodicCheckTimer&&(clearInterval(this.periodicCheckTimer),this.periodicCheckTimer=null)}}function Kr(){var Q,re,oe,j,M,z,$,W,F,G,ee,me;const[t,r]=a.useState(""),[o,n]=a.useState("3D"),[s,l]=a.useState("3Dmol.js"),[i,c]=a.useState(!1),[m,x]=a.useState(!1),[d,y]=a.useState(null),[k,P]=a.useState("1CRN"),[I,b]=a.useState(null),[h,N]=a.useState(!1),[C,E]=a.useState({center_x:0,center_y:0,center_z:0,size_x:20,size_y:20,size_z:20}),[L,O]=a.useState(null),[H,T]=a.useState(null),[D,_]=a.useState(!1),[B,Y]=a.useState("ligand"),[V,U]=a.useState(!0),[p]=a.useState(()=>new Ur),f=a.useRef(null),g=a.useRef(null),S=a.useRef(null),u=a.useRef(null),v=a.useRef(null),w=a.useRef(null);a.useEffect(()=>{(async()=>{const Z=await p.checkBackendHealth();U(Z.isConnected),Z.isConnected?q.dismiss("backend-connection-error"):q.error("Backend server is not responding. Please ensure the Django server is running on port 8000.",{duration:6e3,id:"backend-connection-error"})})()},[p]);const R=async()=>{if(!k||k.length!==4){q.error("Please enter a valid 4-character PDB ID");return}if(!(await p.checkBackendHealth()).isConnected){U(!1),q.error("Cannot connect to backend server. Please ensure the Django server is running on port 8000.",{duration:8e3,id:"backend-connection-error"});return}U(!0),_(!0);try{const Z=await we.getProteinInfo(k);b(Z);const te=await we.estimateBindingSite(k,t||null);E(te),f.current&&(f.current.value=te.center_x),g.current&&(g.current.value=te.center_y),S.current&&(S.current.value=te.center_z),u.current&&(u.current.value=te.size_x),v.current&&(v.current.value=te.size_y),w.current&&(w.current.value=te.size_z),N(!0),q.success(`Loaded protein ${k}: ${Z.title||"Unknown"}`),q.dismiss("backend-connection-error")}catch(Z){console.error("Failed to load protein:",Z),Z.message.includes("Failed to fetch")||Z.message.includes("ERR_CONNECTION_REFUSED")?(U(!1),q.error("Backend server connection lost. Please restart the Django server on port 8000.",{duration:8e3,id:"backend-connection-error"})):q.error(`Failed to load protein: ${Z.message}`)}finally{_(!1)}},J=async()=>{var Z,te,le,ae,ie,ye;if(!t){q.error("Please enter a SMILES string for the ligand");return}if(!h){q.error("Please load a protein first");return}const K={ligand_smiles:t,receptor_pdb_id:k,center_x:parseFloat(((Z=f.current)==null?void 0:Z.value)||0),center_y:parseFloat(((te=g.current)==null?void 0:te.value)||0),center_z:parseFloat(((le=S.current)==null?void 0:le.value)||0),size_x:parseFloat(((ae=u.current)==null?void 0:ae.value)||20),size_y:parseFloat(((ie=v.current)==null?void 0:ie.value)||20),size_z:parseFloat(((ye=w.current)==null?void 0:ye.value)||20),exhaustiveness:8,num_modes:9};_(!0),T(null);try{const se=await we.runDocking(K);O(se),q.success(`Docking job started: ${se.job_id}`);const ce=await we.pollDockingJob(se.job_id,fe=>{O(fe),fe.status==="running"&&q.loading("Docking calculation in progress...",{id:"docking-progress"})});T(ce.results),Y("docking"),q.success("Docking completed successfully!",{id:"docking-progress"})}catch(se){console.error("Docking failed:",se),q.error(`Docking failed: ${se.message}`,{id:"docking-progress"})}finally{_(!1)}},A=async(K,Z=!1)=>{var te,le,ae,ie,ye,se;if(Z){f.current&&(f.current.value=K.center_x),g.current&&(g.current.value=K.center_y),S.current&&(S.current.value=K.center_z),u.current&&(u.current.value=K.size_x),v.current&&(v.current.value=K.size_y),w.current&&(w.current.value=K.size_z);return}if(!t){q.error("Please enter a SMILES string for the ligand");return}if(!h){q.error("Please load a protein first");return}_(!0),T(null);try{const ce=await fetch("/api/dock/advanced/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ligand_smiles:t,receptor_pdb_id:k,center_x:parseFloat(((te=f.current)==null?void 0:te.value)||0),center_y:parseFloat(((le=g.current)==null?void 0:le.value)||0),center_z:parseFloat(((ae=S.current)==null?void 0:ae.value)||0),size_x:parseFloat(((ie=u.current)==null?void 0:ie.value)||20),size_y:parseFloat(((ye=v.current)==null?void 0:ye.value)||20),size_z:parseFloat(((se=w.current)==null?void 0:se.value)||20),...K})});if(!ce.ok)throw new Error(`Advanced docking failed: ${ce.statusText}`);const fe=await ce.json();O(fe),q.success(`Advanced docking job started: ${fe.job_name||fe.job_id}`);const bt=await we.pollDockingJob(fe.job_id,Ae=>{O(Ae),Ae.status==="running"&&q.loading("Advanced docking in progress...",{id:"advanced-docking-progress"})});T(bt.results),Y("docking"),q.success("Advanced docking completed successfully!",{id:"advanced-docking-progress"})}catch(ce){console.error("Advanced docking failed:",ce),q.error(`Advanced docking failed: ${ce.message}`,{id:"advanced-docking-progress"})}finally{_(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Docking"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Protein-Ligand docking with all Lipid Viewer capabilities"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${V?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:`text-sm ${V?"text-green-700":"text-red-700"}`,children:["Backend ",V?"Connected":"Disconnected"]})]}),e.jsx(mt,{to:"/",className:"text-blue-600 hover:underline",children:"Back to Lipid Viewer"})]})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6 py-3",children:[e.jsx("button",{onClick:()=>Y("ligand"),className:`py-2 px-1 border-b-2 font-medium text-sm ${B==="ligand"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Ligand Viewer"}),e.jsxs("button",{onClick:()=>Y("docking"),className:`py-2 px-1 border-b-2 font-medium text-sm ${B==="docking"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,disabled:!H,children:["Docking Results",H&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[((Q=H.poses)==null?void 0:Q.length)||0," poses"]})]}),e.jsxs("button",{onClick:()=>Y("advanced"),className:`py-2 px-1 border-b-2 font-medium text-sm ${B==="advanced"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Advanced",e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Expert"})]})]})}),e.jsxs("div",{className:"p-6",children:[B==="ligand"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Ligand Visualization"}),e.jsx(gt,{onSubmit:K=>{r(K),x(!0)},onValidation:(K,Z)=>c(Z),isValid:i}),e.jsx("div",{className:"mt-4",children:e.jsx(ht,{mode:o,renderer:s,onModeChange:n,onRendererChange:l})}),t&&B==="ligand"&&e.jsx("div",{className:"mt-4",children:e.jsx(pt,{smiles:t,mode:o,renderer:s,onExport:y},`ligand-viewer-${B}`)}),m&&e.jsx("div",{className:"mt-4",children:e.jsx(xt,{mode:o,onZoomIn:()=>{},onZoomOut:()=>{},onResetView:()=>{},onExportPNG:()=>d==null?void 0:d.png(),onExportSVG:()=>d==null?void 0:d.svg(),onExportGLTF:()=>d==null?void 0:d.gltf(),isLoaded:m})})]}),B==="docking"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Docking Visualization"}),H&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Best Score: ",(re=H.summary)==null?void 0:re.best_affinity," kcal/mol"]})]}),H&&B==="docking"?e.jsx(Gr,{ligandSmiles:t,receptorPdbId:k,dockingResults:H,mode:"3D",renderer:"3Dmol.js",className:"w-full"},`docking-viewer-${B}`):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"No Docking Results"}),e.jsx("div",{className:"text-sm",children:"Run a docking calculation to see results here"})]})]}),B==="advanced"&&e.jsx(Br,{onAdvancedDocking:A,isLoading:D,disabled:!t||!h,currentParams:{center_x:parseFloat(((oe=f.current)==null?void 0:oe.value)||0),center_y:parseFloat(((j=g.current)==null?void 0:j.value)||0),center_z:parseFloat(((M=S.current)==null?void 0:M.value)||0),size_x:parseFloat(((z=u.current)==null?void 0:z.value)||20),size_y:parseFloat((($=v.current)==null?void 0:$.value)||20),size_z:parseFloat(((W=w.current)==null?void 0:W.value)||20)},receptorPdbId:k})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Protein Loader"}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PDB ID"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{value:k,onChange:K=>P(K.target.value.toUpperCase()),className:"flex-1 border rounded px-3 py-2",placeholder:"e.g., 1CRN",disabled:D}),e.jsx("button",{onClick:R,disabled:D,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Loading...":"Load"})]}),I&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 rounded",children:[e.jsx("p",{className:"text-sm text-green-800",children:e.jsx("strong",{children:I.title||"Unknown protein"})}),I.molecular_weight&&e.jsxs("p",{className:"text-xs text-green-600",children:["MW: ",I.molecular_weight," Da"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Backend: /api/pdb/","{pdbId}","/info"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Docking Controls"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center X"}),e.jsx("input",{ref:f,className:"w-full border rounded px-2 py-1",defaultValue:C.center_x,type:"number",step:"0.1",disabled:D})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center Y"}),e.jsx("input",{ref:g,className:"w-full border rounded px-2 py-1",defaultValue:C.center_y,type:"number",step:"0.1",disabled:D})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Center Z"}),e.jsx("input",{ref:S,className:"w-full border rounded px-2 py-1",defaultValue:C.center_z,type:"number",step:"0.1",disabled:D})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size X"}),e.jsx("input",{ref:u,className:"w-full border rounded px-2 py-1",defaultValue:C.size_x,type:"number",step:"0.1",min:"1",disabled:D})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size Y"}),e.jsx("input",{ref:v,className:"w-full border rounded px-2 py-1",defaultValue:C.size_y,type:"number",step:"0.1",min:"1",disabled:D})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Size Z"}),e.jsx("input",{ref:w,className:"w-full border rounded px-2 py-1",defaultValue:C.size_z,type:"number",step:"0.1",min:"1",disabled:D})]})]}),e.jsx("button",{onClick:J,disabled:D||!h||!t,className:"mt-4 w-full px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Running...":"Run Docking"}),L&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:["Job: ",L.job_id?L.job_id.substring(0,8):"N/A","..."]}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Status: ",L.status]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Results"}),H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Summary"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Best Affinity: ",(F=H.summary)==null?void 0:F.best_affinity," kcal/mol"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Poses: ",(G=H.summary)==null?void 0:G.num_poses]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Time: ",(ee=H.summary)==null?void 0:ee.calculation_time,"s"]})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Top Poses"}),(me=H.poses)==null?void 0:me.slice(0,5).map((K,Z)=>e.jsxs("div",{className:"p-2 border rounded mb-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Mode ",K.mode]}),e.jsxs("span",{className:"text-green-600 font-bold",children:[K.affinity," kcal/mol"]})]}),e.jsxs("div",{className:"text-gray-500 mt-1",children:["RMSD: ",K.rmsd_lb," - ",K.rmsd_ub," √Ö"]}),e.jsxs("div",{className:"text-gray-500",children:["Center: (",K.center_x,", ",K.center_y,", ",K.center_z,")"]})]},Z))]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"No results yet."})]})]})]})})]})}console.log("=== main.jsx: Starting React application ===");Re.createRoot(document.getElementById("root")).render(e.jsx(Xe.StrictMode,{children:e.jsx(Cr,{children:e.jsxs(yr,{children:[e.jsx(_e,{path:"/",element:e.jsx(Fr,{})}),e.jsx(_e,{path:"/dock",element:e.jsx(Kr,{})})]})})}));console.log("=== main.jsx: React application rendered ===");
